{"config":{"lang":["ja"],"separator":"[\\s\\-\u3000\u3001\u3002\uff0c\uff0e]+","pipeline":["stemmer"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"BackcastPro \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8","text":"<p>BackcastPro\u306f\u3001\u30c8\u30ec\u30fc\u30c7\u30a3\u30f3\u30b0\u6226\u7565\u306e\u305f\u3081\u306ePython\u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3059\u3002 **\u30ea\u30d7\u30ec\u30a4\u578b\u30b7\u30df\u30e5\u30ec\u30fc\u30bf\u30fc**\u3067\u30011\u30d0\u30fc\u305a\u3064\u6642\u9593\u3092\u9032\u3081\u306a\u304c\u3089\u30c1\u30e3\u30fc\u30c8\u3068\u58f2\u8cb7\u3092\u53ef\u8996\u5316\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"#_1","title":"\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u4e00\u89a7","text":""},{"location":"#_2","title":"\u30e6\u30fc\u30b6\u30fc\u5411\u3051\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8","text":"<ul> <li>\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb - \u57fa\u672c\u7684\u306a\u4f7f\u3044\u65b9\u3092\u5b66\u3076</li> <li>\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0 - \u3088\u304f\u3042\u308b\u554f\u984c\u3068\u89e3\u6c7a\u65b9\u6cd5</li> </ul>"},{"location":"#_3","title":"\u958b\u767a\u8005\u5411\u3051\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8","text":"<ul> <li>\u958b\u767a\u8005\u30ac\u30a4\u30c9 - \u958b\u767a\u306b\u53c2\u52a0\u3059\u308b\u305f\u3081\u306e\u60c5\u5831</li> <li>\u7d04\u5b9a\u30ed\u30b8\u30c3\u30af\u5206\u6790\u30ec\u30dd\u30fc\u30c8 - \u58f2\u8cb7\u7d04\u5b9a\u6642\u306e\u4fa1\u683c\u6c7a\u5b9a\u30ed\u30b8\u30c3\u30af\u8a73\u7d30</li> <li>Docker Job\u306b\u3088\u308b\u682a\u4fa1\u30c7\u30fc\u30bf\u66f4\u65b0 - DockerHub + NAS \u3067\u306e\u591c\u9593\u30c7\u30fc\u30bf\u66f4\u65b0\u306e\u4ed5\u7d44\u307f</li> <li>\u8a2d\u8a08\u5224\u65ad\u8a18\u9332 - \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u5909\u66f4\u306e\u7d4c\u7def</li> <li>NautilusTrader \u79fb\u884c\u8a08\u753b - \u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u30a8\u30f3\u30b8\u30f3\u306e\u79fb\u884c\u8a73\u7d30</li> <li>PyPI\u3078\u306e\u30c7\u30d7\u30ed\u30a4\u65b9\u6cd5 - \u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u914d\u5e03\u65b9\u6cd5</li> </ul>"},{"location":"#_4","title":"\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9","text":"<ul> <li>\u30b5\u30f3\u30d7\u30eb\u96c6 - \u5b9f\u7528\u7684\u306a\u6226\u7565\u306e\u4f8b</li> <li>marimo\u30ea\u30d7\u30ec\u30a4\u30b7\u30df\u30e5\u30ec\u30fc\u30bf\u30fc - \u30b9\u30e9\u30a4\u30c0\u30fc\u3067\u6642\u9593\u64cd\u4f5c</li> <li>SMA\u30af\u30ed\u30b9\u6226\u7565\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3 - \u79fb\u52d5\u5e73\u5747\u8a08\u7b97</li> </ul>"},{"location":"#_5","title":"\u30af\u30a4\u30c3\u30af\u30b9\u30bf\u30fc\u30c8","text":"<pre><code>import yfinance as yf\nfrom BackcastPro import Backtest\n\n# \u30c7\u30fc\u30bf\u3092\u53d6\u5f97\ncode = '7203.T'  # \u30c8\u30e8\u30bf\uff08\u6771\u8a3c\uff09\ndf = yf.download(code, period='1y')\n\n# \u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u3092\u521d\u671f\u5316\nbt = Backtest(data={code: df}, cash=10000)\n\n# \u6226\u7565\u95a2\u6570\u3092\u5b9a\u7fa9\ndef my_strategy(bt):\n    if bt.position == 0:\n        bt.buy(tag=\"entry\")\n\n# \u4e00\u62ec\u5b9f\u884c\nbt.set_strategy(my_strategy)\nresults = bt.run()\nprint(results)\n</code></pre>"},{"location":"#_6","title":"\u4e3b\u306a\u6a5f\u80fd","text":"<ul> <li>\u30ea\u30d7\u30ec\u30a4\u578b\u30b7\u30df\u30e5\u30ec\u30fc\u30bf\u30fc: <code>step()</code> \u30671\u30d0\u30fc\u305a\u3064\u9032\u3081\u306a\u304c\u3089\u72b6\u614b\u78ba\u8a8d</li> <li>\u30b7\u30f3\u30d7\u30eb\u306a\u6226\u7565\u5b9f\u88c5: \u95a2\u6570\u30d9\u30fc\u30b9\u3067 <code>buy()</code> / <code>sell()</code> \u3092\u547c\u3076\u3060\u3051</li> <li>\u7d71\u8a08\u306e\u81ea\u52d5\u8a08\u7b97: \u4ee3\u8868\u7684\u306a\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u6307\u6a19\u3092\u540c\u68b1</li> <li>\u30ea\u30b9\u30af\u7ba1\u7406: <code>sl</code> \u3068 <code>tp</code> \u306b\u6a19\u6e96\u5bfe\u5fdc</li> <li>marimo\u9023\u643a: \u30b9\u30e9\u30a4\u30c0\u30fc\u3067\u6642\u9593\u3092\u64cd\u4f5c\u3057\u306a\u304c\u3089\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u53ef\u8996\u5316</li> </ul> <pre><code>flowchart TD\n    A[\"\u30c7\u30fc\u30bf\u6e96\u5099\"] --&gt; B[\"Backtest \u521d\u671f\u5316\"]\n    B --&gt; C[\"start() \u958b\u59cb\"]\n    C --&gt; D[\"strategy(bt) \u6226\u7565\u5b9f\u884c\"]\n    D --&gt; E[\"step() 1\u30d0\u30fc\u9032\u3081\u308b\"]\n    E --&gt; F{\"is_finished?\"}\n    F --&gt;|No| D\n    F --&gt;|Yes| G[\"finalize() \u7d71\u8a08\u8a08\u7b97\"]\n    G --&gt; H[\"\u7d50\u679c pd.Series\"]</code></pre>"},{"location":"#api","title":"API \u6982\u8981","text":""},{"location":"#_7","title":"\u30e1\u30bd\u30c3\u30c9","text":"\u30e1\u30bd\u30c3\u30c9 \u8aac\u660e <code>start()</code> \u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u958b\u59cb <code>step()</code> 1\u30d0\u30fc\u9032\u3081\u308b <code>reset()</code> \u6700\u521d\u304b\u3089\u3084\u308a\u76f4\u3057 <code>goto(step, strategy)</code> \u6307\u5b9a\u4f4d\u7f6e\u307e\u3067\u9032\u3081\u308b <code>buy(code, size, tag, ...)</code> \u8cb7\u3044\u6ce8\u6587 <code>sell(code, size, tag, ...)</code> \u58f2\u308a\u6ce8\u6587 <code>finalize()</code> \u7d71\u8a08\u8a08\u7b97 <code>set_strategy(func)</code> \u6226\u7565\u95a2\u6570\u3092\u8a2d\u5b9a <code>run()</code> \u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u3092\u6700\u5f8c\u307e\u3067\u5b9f\u884c <code>get_state_snapshot()</code> \u73fe\u5728\u72b6\u614b\u3092\u8f9e\u66f8\u3067\u53d6\u5f97 <code>add_trade_callback(func)</code> \u53d6\u5f15\u30a4\u30d9\u30f3\u30c8\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u767b\u9332"},{"location":"#_8","title":"\u30d7\u30ed\u30d1\u30c6\u30a3","text":"\u30d7\u30ed\u30d1\u30c6\u30a3 \u8aac\u660e <code>data</code> \u73fe\u5728\u6642\u70b9\u307e\u3067\u306e\u30c7\u30fc\u30bf <code>position</code> \u30dd\u30b8\u30b7\u30e7\u30f3\u30b5\u30a4\u30ba\uff08\u5168\u9298\u67c4\u5408\u8a08\uff09 <code>position_of(code)</code> \u6307\u5b9a\u9298\u67c4\u306e\u30dd\u30b8\u30b7\u30e7\u30f3 <code>equity</code> \u73fe\u5728\u306e\u8cc7\u7523 <code>cash</code> \u73fe\u5728\u306e\u73fe\u91d1 <code>current_time</code> \u73fe\u5728\u306e\u65e5\u6642 <code>step_index</code> \u73fe\u5728\u306e\u30b9\u30c6\u30c3\u30d7\u30a4\u30f3\u30c7\u30c3\u30af\u30b9 <code>progress</code> \u9032\u6357\u7387\uff080.0\u301c1.0\uff09 <code>is_finished</code> \u5b8c\u4e86\u30d5\u30e9\u30b0 <code>trades</code> \u30a2\u30af\u30c6\u30a3\u30d6\u306a\u53d6\u5f15 <code>closed_trades</code> \u6c7a\u6e08\u6e08\u307f\u53d6\u5f15 <code>orders</code> \u672a\u7d04\u5b9a\u306e\u6ce8\u6587"},{"location":"#_9","title":"\u30b5\u30dd\u30fc\u30c8","text":"<ul> <li>GitHub Issues: \u30d0\u30b0\u5831\u544a\u3084\u6a5f\u80fd\u8981\u6c42</li> <li>Discord: \u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u3067\u306e\u8cea\u554f</li> <li>\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8: \u8a73\u7d30\u306a\u4f7f\u7528\u65b9\u6cd5\u306e\u78ba\u8a8d</li> </ul>"},{"location":"#_10","title":"\u30e9\u30a4\u30bb\u30f3\u30b9","text":"<p>MIT License - \u8a73\u7d30\u306fLICENSE\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p>"},{"location":"cloud-run-updater/","title":"Docker Job\u306b\u3088\u308b\u682a\u4fa1\u30c7\u30fc\u30bf\u66f4\u65b0","text":"<p>BackcastPro\u306f\u3001\u591c\u9593\u306bDocker\u30b3\u30f3\u30c6\u30ca\u3092\u4f7f\u7528\u3057\u3066\u682a\u4fa1\u30c7\u30fc\u30bf\u3092\u81ea\u52d5\u66f4\u65b0\u3059\u308b\u4ed5\u7d44\u307f\u3092\u5099\u3048\u3066\u3044\u307e\u3059\u3002 Docker\u30a4\u30e1\u30fc\u30b8\u306fGitHub Actions\u3067\u81ea\u52d5\u7684\u306bDockerHub\u3078push\u3055\u308c\u3001Synology NAS\u306eDocker\u3067\u5b9a\u671f\u5b9f\u884c\u3057\u307e\u3059\u3002</p>"},{"location":"cloud-run-updater/#_1","title":"\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3","text":"<p>\u30c7\u30fc\u30bf\u306e\u66f4\u65b0\u30d7\u30ed\u30bb\u30b9\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3067\u3059\uff1a</p> <ol> <li>GitHub Actions\u304c <code>main</code> \u30d6\u30e9\u30f3\u30c1\u3078\u306e push \u6642\u306b Docker \u30a4\u30e1\u30fc\u30b8\u3092 DockerHub (<code>backcast/cloud-job</code>) \u3078 push \u3057\u307e\u3059\u3002</li> <li>Synology NAS \u306e\u30bf\u30b9\u30af\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u304c\u6bce\u6669\u5b9a\u523b\u306b Docker\u30b3\u30f3\u30c6\u30ca \u3092\u30c8\u30ea\u30ac\u30fc\u3057\u307e\u3059\u3002</li> <li>\u30b3\u30f3\u30c6\u30ca (<code>update_stocks_price.py</code>) \u304c\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002</li> <li>J-Quants API\u306a\u3069\u304b\u3089\u6700\u65b0\u306e\u682a\u4fa1\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002</li> <li>\u53d6\u5f97\u3057\u305f\u30c7\u30fc\u30bf\u3092DuckDB\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u30de\u30a6\u30f3\u30c8\u3055\u308c\u305f\u30dc\u30ea\u30e5\u30fc\u30e0\uff08<code>STOCKDATA_CACHE_DIR</code>\uff09\u306b\u76f4\u63a5\u4fdd\u5b58\u3057\u307e\u3059\u3002</li> </ol> <pre><code>graph LR\n    G[GitHub Actions] --&gt;|push| H[DockerHub backcast/cloud-job]\n    A[NAS \u30bf\u30b9\u30af\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9] --&gt;|docker run| B[Docker \u30b3\u30f3\u30c6\u30ca]\n    H -.-&gt;|docker pull| B\n    B --&gt;|\u30c7\u30fc\u30bf\u53d6\u5f97| C[J-Quants / Tachibana / Stooq]\n    B --&gt;|DuckDB\u4fdd\u5b58| D[\u30de\u30a6\u30f3\u30c8\u30dc\u30ea\u30e5\u30fc\u30e0 /cache]</code></pre>"},{"location":"cloud-run-updater/#_2","title":"\u69cb\u6210\u8981\u7d20","text":""},{"location":"cloud-run-updater/#docker-backcastcloud-job","title":"Docker \u30a4\u30e1\u30fc\u30b8 (<code>backcast/cloud-job</code>)","text":"<ul> <li>DockerHub: <code>backcast/cloud-job</code></li> <li>\u30bd\u30fc\u30b9: <code>cloud-job/</code></li> <li>Dockerfile: <code>cloud-job/Dockerfile</code></li> <li>GitHub Action: <code>.github/workflows/publish-dockerhub.yml</code></li> <li>\u5f79\u5272: \u30c7\u30fc\u30bf\u306e\u53d6\u5f97\u3001\u52a0\u5de5\u3001DuckDB\u30d5\u30a1\u30a4\u30eb\u3078\u306e\u4fdd\u5b58</li> <li>\u30c7\u30fc\u30bf\u4fdd\u5b58\u5148: \u74b0\u5883\u5909\u6570 <code>STOCKDATA_CACHE_DIR</code>\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: <code>/cache</code>\uff09\u3067\u6307\u5b9a\u3055\u308c\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea</li> </ul>"},{"location":"cloud-run-updater/#_3","title":"\u5fc5\u8981\u306a\u74b0\u5883\u5909\u6570\u30fb\u30b7\u30fc\u30af\u30ec\u30c3\u30c8","text":"\u74b0\u5883\u5909\u6570 \u7528\u9014 <code>JQUANTS_API_KEY</code> J-Quants API\u8a8d\u8a3c <code>eAPI_URL</code> \u7acb\u82b1\u8a3c\u5238 e-\u652f\u5e97 API\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8 <code>eAPI_USER_ID</code> \u7acb\u82b1\u8a3c\u5238 \u30e6\u30fc\u30b6\u30fcID <code>eAPI_PASSWORD</code> \u7acb\u82b1\u8a3c\u5238 \u30d1\u30b9\u30ef\u30fc\u30c9"},{"location":"cloud-run-updater/#docker","title":"Docker \u30a4\u30e1\u30fc\u30b8\u306e\u53d6\u5f97","text":"<p>DockerHub \u304b\u3089\u6700\u65b0\u30a4\u30e1\u30fc\u30b8\u3092 pull \u3057\u307e\u3059\uff1a</p> <pre><code>docker pull backcast/cloud-job:latest\n</code></pre>"},{"location":"cloud-run-updater/#_4","title":"\u30ed\u30fc\u30ab\u30eb\u3067\u30d3\u30eb\u30c9\u3059\u308b\u5834\u5408","text":"<pre><code>docker build -f cloud-job/Dockerfile -t backcast/cloud-job .\n</code></pre>"},{"location":"cloud-run-updater/#_5","title":"\u5b9f\u884c\u65b9\u6cd5","text":""},{"location":"cloud-run-updater/#_6","title":"\u7279\u5b9a\u9298\u67c4\u3067\u52d5\u4f5c\u78ba\u8a8d","text":"<pre><code>docker run -v /path/to/duckdb:/cache \\\n  -e JQUANTS_API_KEY=xxx \\\n  -e eAPI_URL=xxx \\\n  -e eAPI_USER_ID=xxx \\\n  -e eAPI_PASSWORD=xxx \\\n  backcast/cloud-job --codes 7203 --days 3\n</code></pre>"},{"location":"cloud-run-updater/#_7","title":"\u5168\u9298\u67c4\u3092\u66f4\u65b0","text":"<pre><code>docker run -v /path/to/duckdb:/cache \\\n  -e JQUANTS_API_KEY=xxx \\\n  -e eAPI_URL=xxx \\\n  -e eAPI_USER_ID=xxx \\\n  -e eAPI_PASSWORD=xxx \\\n  backcast/cloud-job --days 7\n</code></pre>"},{"location":"cloud-run-updater/#cli","title":"CLI\u5f15\u6570","text":"\u5f15\u6570 \u30c7\u30d5\u30a9\u30eb\u30c8 \u8aac\u660e <code>--codes</code> \u306a\u3057\uff08\u5168\u9298\u67c4\uff09 \u51e6\u7406\u5bfe\u8c61\u306e\u9298\u67c4\u30b3\u30fc\u30c9\uff08\u30ab\u30f3\u30de\u533a\u5207\u308a\uff09 <code>--days</code> 7 \u53d6\u5f97\u3059\u308b\u904e\u53bb\u65e5\u6570"},{"location":"cloud-run-updater/#_8","title":"\u5b9a\u671f\u5b9f\u884c\u306e\u8a2d\u5b9a","text":""},{"location":"cloud-run-updater/#synology-nas","title":"Synology NAS\uff08\u30bf\u30b9\u30af\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\uff09","text":"<p>Synology DSM \u306e \u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u30d1\u30cd\u30eb &gt; \u30bf\u30b9\u30af\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9 \u3067\u4ee5\u4e0b\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u767b\u9332\u3057\u3066\u304f\u3060\u3055\u3044\uff1a</p> <pre><code>docker pull backcast/cloud-job:latest\ndocker run --rm -v /volume1/docker/backcast/cache:/cache \\\n  -e JQUANTS_API_KEY=xxx \\\n  -e eAPI_URL=xxx \\\n  -e eAPI_USER_ID=xxx \\\n  -e eAPI_PASSWORD=xxx \\\n  backcast/cloud-job --days 7\n</code></pre>"},{"location":"cloud-run-updater/#cronlinuxmac","title":"cron\uff08Linux/Mac\uff09","text":"<pre><code># \u6bce\u65e5 19:30 \u306b\u5b9f\u884c\n30 19 * * 1-5 docker run --rm -v /path/to/duckdb:/cache -e JQUANTS_API_KEY=xxx -e eAPI_URL=xxx -e eAPI_USER_ID=xxx -e eAPI_PASSWORD=xxx backcast/cloud-job --days 7\n</code></pre>"},{"location":"cloud-run-updater/#windows","title":"\u30bf\u30b9\u30af\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\uff08Windows\uff09","text":"<p>PowerShell\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3057\u3001\u30bf\u30b9\u30af\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u306b\u767b\u9332\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p>"},{"location":"cloud-run-updater/#_9","title":"\u904b\u7528\u30fb\u76e3\u8996","text":""},{"location":"cloud-run-updater/#_10","title":"\u30ed\u30b0\u78ba\u8a8d","text":"<p>\u30ed\u30b0\u306f\u30b3\u30f3\u30bd\u30fc\u30eb\uff08stdout\uff09\u306b\u51fa\u529b\u3055\u308c\u307e\u3059\u3002</p> <pre><code># \u30b3\u30f3\u30c6\u30ca\u306e\u30ed\u30b0\u3092\u78ba\u8a8d\ndocker logs &lt;container_id&gt;\n</code></pre>"},{"location":"cloud-run-updater/#_11","title":"\u30c7\u30fc\u30bf\u78ba\u8a8d","text":"<p>\u66f4\u65b0\u3055\u308c\u305f\u30c7\u30fc\u30bf\u306f\u3001\u30de\u30a6\u30f3\u30c8\u3055\u308c\u305f\u30dc\u30ea\u30e5\u30fc\u30e0\u5185\u306eDuckDB\u30d5\u30a1\u30a4\u30eb\u3092\u76f4\u63a5\u78ba\u8a8d\u3059\u308b\u3053\u3068\u3067\u691c\u8a3c\u3067\u304d\u307e\u3059\u3002</p> <pre><code># \u30dc\u30ea\u30e5\u30fc\u30e0\u5185\u306eDuckDB\u30d5\u30a1\u30a4\u30eb\u3092\u78ba\u8a8d\nls /path/to/duckdb/stocks_daily/\n# \u4f8b: 7203.duckdb, 8306.duckdb, ...\n</code></pre>"},{"location":"cloud-run-updater/#_12","title":"\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0","text":""},{"location":"cloud-run-updater/#import","title":"\u30b3\u30f3\u30c6\u30ca\u304cimport\u30a8\u30e9\u30fc\u3067\u5931\u6557\u3059\u308b","text":"<p>Dockerfile \u306e <code>PYTHONPATH</code> \u304c <code>/app/src</code> \u306b\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002<code>trading_data</code> \u3068 <code>BackcastPro</code> \u30d1\u30c3\u30b1\u30fc\u30b8\u306f <code>/app/src/</code> \u914d\u4e0b\u306b\u30b3\u30d4\u30fc\u3055\u308c\u308b\u305f\u3081\u3001\u3053\u306e\u8a2d\u5b9a\u304c\u306a\u3044\u3068 <code>ModuleNotFoundError</code> \u306b\u306a\u308a\u307e\u3059\u3002</p>"},{"location":"design-decisions/","title":"\u8a2d\u8a08\u5224\u65ad\u8a18\u9332 (Design Decisions)","text":"<p>\u3053\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067\u306f\u3001BackcastPro\u958b\u767a\u306b\u304a\u3051\u308b\u91cd\u8981\u306a\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u4e0a\u306e\u6c7a\u5b9a\u3068\u305d\u306e\u80cc\u666f\uff08Context\uff09\u3001\u304a\u3088\u3073\u5909\u66f4\u5185\u5bb9\u3092\u8a18\u9332\u3057\u307e\u3059\u3002</p>"},{"location":"design-decisions/#_1","title":"\u76ee\u6b21","text":"<ol> <li>FTP\u5ec3\u6b62\u3068Google Drive\u3078\u306e\u5b8c\u5168\u79fb\u884c</li> <li>\u682a\u4fa1\u30c7\u30fc\u30bf\u66f4\u65b0\u306eCloud Run Job\u5316</li> <li>Dockerfile\u306eENTRYPOINT\u5316</li> <li>Google Drive\u5ec3\u6b62\u3068\u81ea\u5b85NAS\uff08FTPS\uff09\u3078\u306e\u79fb\u884c</li> <li>Cloud Run Proxy\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5ec3\u6b62\u3068Docker\u30dc\u30ea\u30e5\u30fc\u30e0\u30de\u30a6\u30f3\u30c8\u3078\u306e\u79fb\u884c</li> <li>Cloud Run Job\u5ec3\u6b62\u3068Synology NAS Docker + DockerHub\u3078\u306e\u79fb\u884c</li> <li>FTPS\u5ec3\u6b62\u3068\u30ed\u30fc\u30ab\u30eb\u30d5\u30a1\u30a4\u30eb\u914d\u4fe1\u3078\u306e\u79fb\u884c</li> </ol>"},{"location":"design-decisions/#ftpgoogle-drive","title":"FTP\u5ec3\u6b62\u3068Google Drive\u3078\u306e\u5b8c\u5168\u79fb\u884c","text":"<p>Date: 2026-02-09 Status: Implemented Superseded\uff08Google Drive\u5ec3\u6b62\u3068\u81ea\u5b85NAS\uff08FTPS\uff09\u3078\u306e\u79fb\u884c\u306b\u3088\u308a\u7f6e\u63db\uff09</p>"},{"location":"design-decisions/#context","title":"Context","text":"<p>BackcastPro\u306e\u30c7\u30fc\u30bf\u53d6\u5f97\u306f\u3001\u5f53\u521d\u4ee5\u4e0b\u306e3\u6bb5\u30d5\u30a9\u30fc\u30eb\u30d0\u30c3\u30af\u69cb\u6210\u3067\u3057\u305f\uff1a 1. Google Drive (Cloud Run API\u7d4c\u7531) 2. FTP\u30b5\u30fc\u30d0\u30fc 3. \u30ed\u30fc\u30ab\u30eb\u3067\u306e\u65b0\u898f\u4f5c\u6210</p> <p>\u3057\u304b\u3057\u3001FTP\u30b5\u30fc\u30d0\u30fc\u306e\u904b\u7528\u30b3\u30b9\u30c8\u3068\u8907\u96d1\u3055\u304c\u8ab2\u984c\u3068\u306a\u308a\u3001Google Drive (Cloud Run API) \u306e\u4fe1\u983c\u6027\u304c\u5411\u4e0a\u3057\u305f\u305f\u3081\u3001FTP\u3092\u5ec3\u6b62\u3057\u3066\u69cb\u6210\u3092\u7c21\u7d20\u5316\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002</p>"},{"location":"design-decisions/#decision","title":"Decision","text":"<ul> <li>FTP\u95a2\u9023\u30b3\u30fc\u30c9\u306e\u5b8c\u5168\u524a\u9664: <code>ftp_client.py</code> \u304a\u3088\u3073\u95a2\u9023\u3059\u308b\u30c6\u30b9\u30c8\u3001\u8a2d\u5b9a\u3092\u524a\u9664\u3002</li> <li>Google Drive\u3078\u306e\u4e00\u672c\u5316: \u30c7\u30fc\u30bf\u53d6\u5f97\u304a\u3088\u3073\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306e\u30ed\u30b8\u30c3\u30af\u3092 Google Drive (Cloud Run API) \u306e\u307f\u306b\u5909\u66f4\u3002</li> <li>\u30d5\u30a9\u30fc\u30eb\u30d0\u30c3\u30af\u306e\u7c21\u7d20\u5316: \u30ed\u30fc\u30ab\u30eb\u30ad\u30e3\u30c3\u30b7\u30e5\u306b\u306a\u3051\u308c\u3070 Cloud Run API \u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3001\u305d\u308c\u3082\u306a\u3051\u308c\u3070\u65b0\u898f\u4f5c\u6210\u3001\u3068\u3044\u30462\u6bb5\u968e\uff08\u5b9f\u8cea1\u6bb5\u968e\uff0b\u6551\u6e08\uff09\u306b\u5909\u66f4\u3002</li> </ul>"},{"location":"design-decisions/#consequences","title":"Consequences","text":"<ul> <li>\u30e1\u30ea\u30c3\u30c8:<ul> <li>\u30b3\u30fc\u30c9\u30d9\u30fc\u30b9\u306e\u524a\u6e1b\u3068\u4fdd\u5b88\u6027\u306e\u5411\u4e0a\u3002</li> <li><code>.env</code> \u3084 GitHub Secrets \u306e\u8a2d\u5b9a\u9805\u76ee\u6e1b\u5c11\u306b\u3088\u308b\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u306e\u7c21\u7d20\u5316\u3002</li> <li>\u5916\u90e8\u4f9d\u5b58\u30b5\u30fc\u30d3\u30b9\u306e\u524a\u6e1b\u3002</li> </ul> </li> <li>\u30c7\u30e1\u30ea\u30c3\u30c8:<ul> <li>FTP\u30b5\u30fc\u30d0\u30fc\u3068\u3044\u3046\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u624b\u6bb5\u304c\u306a\u304f\u306a\u308b\uff08\u305f\u3060\u3057Google Drive\u306e\u4fe1\u983c\u6027\u3067\u30ab\u30d0\u30fc\u53ef\u80fd\u3068\u5224\u65ad\uff09\u3002</li> </ul> </li> </ul>"},{"location":"design-decisions/#cloud-run-job","title":"\u682a\u4fa1\u30c7\u30fc\u30bf\u66f4\u65b0\u306eCloud Run Job\u5316","text":"<p>Date: 2026-02-09 Status: Implemented Superseded\uff08\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u7d4c\u8def\u306fCloud Run Proxy\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5ec3\u6b62\u3068Docker\u30dc\u30ea\u30e5\u30fc\u30e0\u30de\u30a6\u30f3\u30c8\u3078\u306e\u79fb\u884c\u306b\u3088\u308a\u5909\u66f4\u3002\u5b9f\u884c\u74b0\u5883\u306fCloud Run Job\u5ec3\u6b62\u3068Synology NAS Docker + DockerHub\u3078\u306e\u79fb\u884c\u306b\u3088\u308a\u5909\u66f4\uff09</p>"},{"location":"design-decisions/#context_1","title":"Context","text":"<p>\u682a\u4fa1\u30c7\u30fc\u30bf\u306e\u66f4\u65b0\u51e6\u7406\uff08<code>update_stocks_price.py</code>\uff09\u306f\u3001\u8907\u6570\u306e\u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\uff08Tachibana, Stooq, J-Quants\uff09\u304b\u3089\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3057\u3001\u52a0\u5de5\u3057\u3066\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u30d0\u30c3\u30c1\u51e6\u7406\u3067\u3059\u3002\u3053\u308c\u3092\u5b89\u5b9a\u3057\u3066\u591c\u9593\u306b\u5b9a\u671f\u5b9f\u884c\u3059\u308b\u57fa\u76e4\u304c\u5fc5\u8981\u3067\u3057\u305f\u3002</p>"},{"location":"design-decisions/#decision_1","title":"Decision","text":"<ul> <li>Cloud Run Job\u306e\u63a1\u7528: \u30b5\u30fc\u30d0\u30fc\u30ec\u30b9\u3067\u9577\u6642\u9593\u306e\u30d0\u30c3\u30c1\u51e6\u7406\u304c\u53ef\u80fd\u306a Cloud Run Job \u3092\u63a1\u7528\u3002</li> <li>\u30b3\u30f3\u30c6\u30ca\u5316: <code>cloud-job/Dockerfile</code> \u3092\u4f5c\u6210\u3057\u3001\u5b9f\u884c\u74b0\u5883\u3092\u30b3\u30f3\u30c6\u30ca\u5316\u3002</li> <li>Cloud Scheduler\u306b\u3088\u308b\u30c8\u30ea\u30ac\u30fc: \u6bce\u6669\u5b9a\u523b\u306b Job \u3092\u5b9f\u884c\u3059\u308b\u3088\u3046\u8a2d\u5b9a\u3002</li> <li>\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u7d4c\u8def\u306e\u6700\u9069\u5316:<ul> <li>\u5f53\u521d\u6848 (<code>shimmering-roaming-pillow.md</code>): Google Drive API \u3092\u76f4\u63a5\u53e9\u304f <code>GDriveUploader</code> \u3092\u65b0\u898f\u4f5c\u6210\u3059\u308b\u6848\u3002</li> <li>\u63a1\u7528\u6848 (<code>typed-wiggling-cocoa.md</code>): \u65e2\u5b58\u306e Cloud Run Proxy \u30b5\u30fc\u30d3\u30b9\u306b <code>POST</code> \u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3092\u8ffd\u52a0\u3057\u3001Job \u304b\u3089\u306f HTTP POST \u3059\u308b\u3060\u3051\u306e\u69cb\u6210\u306b\u5909\u66f4\u3002\u3053\u308c\u306b\u3088\u308a Job \u5074\u306e\u4f9d\u5b58\u95a2\u4fc2\uff08Google API Client Library\uff09\u3068\u8a8d\u8a3c\u8a2d\u5b9a\uff08\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8JSON\uff09\u3092\u524a\u6e1b\u3057\u3001\u69cb\u6210\u3092\u5927\u5e45\u306b\u7c21\u7d20\u5316\u3002</li> </ul> </li> </ul>"},{"location":"design-decisions/#consequences_1","title":"Consequences","text":"<ul> <li>\u30e1\u30ea\u30c3\u30c8:<ul> <li>\u30b5\u30fc\u30d0\u30fc\u7ba1\u7406\u4e0d\u8981\u3067\u5b89\u5b9a\u3057\u305f\u5b9a\u671f\u5b9f\u884c\u304c\u53ef\u80fd\u3002</li> <li>Job \u5074\u306e\u5b9f\u88c5\u304c\u975e\u5e38\u306b\u8efd\u91cf\uff08<code>requests</code> \u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u307f\u3067\u5b8c\u7d50\uff09\u3002</li> <li>Cloud Run Proxy \u306b\u30ed\u30b8\u30c3\u30af\u3092\u96c6\u7d04\u3067\u304d\u305f\u305f\u3081\u3001\u8a8d\u8a3c\u3084\u6a29\u9650\u7ba1\u7406\u304c\u4e00\u5143\u5316\u3055\u308c\u305f\u3002</li> </ul> </li> </ul>"},{"location":"design-decisions/#dockerfileentrypoint","title":"Dockerfile\u306eENTRYPOINT\u5316","text":"<p>Date: 2026-02-09 Status: Implemented</p>"},{"location":"design-decisions/#context_2","title":"Context","text":"<p>Cloud Run Job <code>update-stocks-price</code> \u304c <code>--args</code> \u4ed8\u304d\u3067\u5b9f\u884c\u3059\u308b\u3068\u3001exit code 1 \u3067\u5373\u5ea7\u306b\u5931\u6557\u3059\u308b\u554f\u984c\u304c\u767a\u751f\u3002\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30ed\u30b0\uff08stdout/stderr\uff09\u304c\u4e00\u5207\u51fa\u529b\u3055\u308c\u305a\u3001\u30b7\u30b9\u30c6\u30e0\u30ed\u30b0\u306b\u306f\u300cApplication exec likely failed\u300d\u3068\u3060\u3051\u8a18\u9332\u3055\u308c\u3066\u3044\u305f\u3002</p> <p>\u539f\u56e0\u306f Docker \u306e <code>CMD</code> \u3068 <code>ENTRYPOINT</code> \u306e\u4ed5\u69d8\u306e\u9055\u3044\uff1a</p> <ul> <li><code>CMD [\"python\", \"script.py\"]</code> \u306e\u5834\u5408\u3001Cloud Run Job \u306e <code>args</code> \u30d5\u30a3\u30fc\u30eb\u30c9\uff08Kubernetes \u306e <code>args</code>\uff09\u306f CMD \u3092**\u5b8c\u5168\u306b\u7f6e\u63db**\u3059\u308b\u3002\u3064\u307e\u308a <code>--args=\"--codes,7203\"</code> \u3092\u6e21\u3059\u3068\u3001\u30b3\u30f3\u30c6\u30ca\u306f <code>--codes</code> \u3092\u5b9f\u884c\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u5b9f\u884c\u3057\u3088\u3046\u3068\u3059\u308b\u3002</li> <li><code>ENTRYPOINT [\"python\", \"script.py\"]</code> \u306e\u5834\u5408\u3001<code>args</code> \u306f ENTRYPOINT \u306e\u5f8c\u308d\u306b**\u5f15\u6570\u3068\u3057\u3066\u8ffd\u52a0**\u3055\u308c\u308b\u3002</li> </ul>"},{"location":"design-decisions/#decision_2","title":"Decision","text":"<p><code>cloud-job/Dockerfile</code> \u306e\u6700\u7d42\u884c\u3092 <code>CMD</code> \u304b\u3089 <code>ENTRYPOINT</code> \u306b\u5909\u66f4\u3002</p> <pre><code># \u5909\u66f4\u524d\nCMD [\"python\", \"/app/update_stocks_price.py\"]\n\n# \u5909\u66f4\u5f8c\nENTRYPOINT [\"python\", \"/app/update_stocks_price.py\"]\n</code></pre>"},{"location":"design-decisions/#consequences_2","title":"Consequences","text":"<ul> <li>\u30e1\u30ea\u30c3\u30c8:<ul> <li><code>--args</code> \u304c\u6b63\u3057\u304f Python \u30b9\u30af\u30ea\u30d7\u30c8\u306e\u5f15\u6570\u3068\u3057\u3066\u6e21\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3002</li> <li><code>--args=\"--codes,7203,--days,3\"</code> \u304c\u6b63\u5e38\u306b\u52d5\u4f5c\u3059\u308b\u3053\u3068\u3092\u78ba\u8a8d\u6e08\u307f\u3002</li> </ul> </li> <li>\u6ce8\u610f\u70b9:<ul> <li><code>ENTRYPOINT</code> \u3092\u4f7f\u3046\u5834\u5408\u3001<code>docker run</code> \u3067\u30b3\u30de\u30f3\u30c9\u3092\u4e0a\u66f8\u304d\u3059\u308b\u306b\u306f <code>--entrypoint</code> \u30d5\u30e9\u30b0\u304c\u5fc5\u8981\u306b\u306a\u308b\uff08\u30c7\u30d0\u30c3\u30b0\u6642\u306b <code>bash</code> \u3067\u30b3\u30f3\u30c6\u30ca\u306b\u5165\u308b\u5834\u5408\u306a\u3069\uff09\u3002</li> </ul> </li> </ul>"},{"location":"design-decisions/#google-drivenasftps","title":"Google Drive\u5ec3\u6b62\u3068\u81ea\u5b85NAS\uff08FTPS\uff09\u3078\u306e\u79fb\u884c","text":"<p>Date: 2026-02-10 Status: Implemented Superseded\uff08FTPS\u5ec3\u6b62\u3068\u30ed\u30fc\u30ab\u30eb\u30d5\u30a1\u30a4\u30eb\u914d\u4fe1\u3078\u306e\u79fb\u884c\u306b\u3088\u308a\u7f6e\u63db\uff09</p>"},{"location":"design-decisions/#context_3","title":"Context","text":"<p>FTP\u5ec3\u6b62\u3068Google Drive\u3078\u306e\u5b8c\u5168\u79fb\u884c\u3067 Google Drive \u306b\u4e00\u672c\u5316\u3057\u305f\u304c\u3001Google Drive API \u306e\u5236\u7d04\uff08\u30ec\u30fc\u30c8\u5236\u9650\u3001API\u547c\u3073\u51fa\u3057\u306e\u8907\u96d1\u3055\u3001\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u7ba1\u7406\uff09\u304c\u904b\u7528\u4e0a\u306e\u8ab2\u984c\u3068\u306a\u3063\u305f\u3002\u81ea\u5b85\u306b NAS\uff08Synology DS218\uff09\u304c\u7a3c\u50cd\u3057\u3066\u304a\u308a\u3001FTPS \u30b5\u30fc\u30d0\u30fc\u304c\u5229\u7528\u53ef\u80fd\u3067\u3042\u3063\u305f\u305f\u3081\u3001\u30b9\u30c8\u30ec\u30fc\u30b8\u3092 NAS \u306b\u79fb\u884c\u3059\u308b\u3053\u3068\u3092\u6c7a\u5b9a\u3002</p>"},{"location":"design-decisions/#decision_3","title":"Decision","text":"<ul> <li>Cloud Run Proxy \u306e\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3092 Google Drive API \u2192 FTPS \u306b\u5909\u66f4: <code>cloud-run/main.py</code> \u306e <code>GoogleDriveProxy</code> \u30af\u30e9\u30b9\u3092 <code>NASFtpsProxy</code> \u30af\u30e9\u30b9\u306b\u7f6e\u63db\u3002</li> <li>\u30d7\u30ed\u30c8\u30b3\u30eb\u9078\u5b9a: FTPS\uff08rsync \u3067\u306f\u306a\u304f\uff09: Cloud Run \u306e\u30ea\u30af\u30a8\u30b9\u30c8-\u30ec\u30b9\u30dd\u30f3\u30b9\u30e2\u30c7\u30eb\u3068\u306e\u89aa\u548c\u6027\u304b\u3089 FTPS \u3092\u63a1\u7528\u3002rsync \u306f\u30d0\u30c3\u30c1\u540c\u671f\u5411\u304d\u3067\u3001\u30aa\u30f3\u30c7\u30de\u30f3\u30c9\u306e\u500b\u5225\u30d5\u30a1\u30a4\u30eb\u914d\u4fe1\u306b\u306f\u4e0d\u5411\u304d\u3002</li> <li>HTTP API \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306f\u7dad\u6301: <code>GET /jp/&lt;path:file_path&gt;</code> \u3068 <code>POST /jp/&lt;path:file_path&gt;</code> \u306f\u305d\u306e\u307e\u307e\u3002\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\uff08<code>CloudRunClient</code>, <code>update_stocks_price.py</code>\uff09\u306e\u5909\u66f4\u306f\u4e0d\u8981\u3002</li> <li>NAT \u8d8a\u3048\u5bfe\u5fdc: <code>_NatFriendlyFTP_TLS</code> \u30af\u30e9\u30b9\u3067 PASV \u30ec\u30b9\u30dd\u30f3\u30b9\u306e\u30db\u30b9\u30c8\u3092\u5236\u5fa1\u63a5\u7d9a\u306e\u30db\u30b9\u30c8\u306b\u5dee\u3057\u66ff\u3048\u3002</li> <li>\u30ea\u30af\u30a8\u30b9\u30c8\u3054\u3068\u306e\u63a5\u7d9a\u78ba\u7acb: Cloud Run \u30b3\u30f3\u30c6\u30ca\u306f\u30d5\u30ea\u30fc\u30ba/\u30ea\u30b5\u30a4\u30af\u30eb\u3055\u308c\u308b\u305f\u3081\u3001\u63a5\u7d9a\u30d7\u30fc\u30eb\u306f\u4f7f\u308f\u305a\u6bce\u30ea\u30af\u30a8\u30b9\u30c8\u3067 FTPS \u63a5\u7d9a\u3092\u78ba\u7acb\u30fb\u5207\u65ad\u3002</li> <li>Google \u4f9d\u5b58\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u5b8c\u5168\u524a\u9664: <code>google-api-python-client</code>, <code>google-auth</code> \u3092 <code>requirements.txt</code> \u304b\u3089\u524a\u9664\u3002<code>ftplib</code>/<code>ssl</code> \u306f Python \u6a19\u6e96\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u305f\u3081\u8ffd\u52a0\u4f9d\u5b58\u306a\u3057\u3002</li> </ul>"},{"location":"design-decisions/#consequences_3","title":"Consequences","text":"<ul> <li>\u30e1\u30ea\u30c3\u30c8:<ul> <li>Google Drive API \u306e\u30ec\u30fc\u30c8\u5236\u9650\u30fb\u8907\u96d1\u3055\u304b\u3089\u89e3\u653e\u3002</li> <li>Docker \u30a4\u30e1\u30fc\u30b8\u30b5\u30a4\u30ba\u306e\u524a\u6e1b\uff08Google API Client \u306e\u4f9d\u5b58\u3092\u9664\u53bb\uff09\u3002</li> <li>\u30b9\u30c8\u30ec\u30fc\u30b8\u5bb9\u91cf\u304c NAS \u306e\u30c7\u30a3\u30b9\u30af\u5bb9\u91cf\u306b\u4f9d\u5b58\u3057\u3001Google Drive \u306e\u5bb9\u91cf\u5236\u9650\u306a\u3057\u3002</li> <li>\u30b3\u30fc\u30c9\u306e\u5927\u5e45\u306a\u7c21\u7d20\u5316\uff08\u30d5\u30a9\u30eb\u30c0ID\u691c\u7d22\u304c\u4e0d\u8981\u3001\u30d1\u30b9\u30d9\u30fc\u30b9\u306e\u76f4\u63a5\u30a2\u30af\u30bb\u30b9\uff09\u3002</li> </ul> </li> <li>\u30c7\u30e1\u30ea\u30c3\u30c8:<ul> <li>\u81ea\u5b85\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30fbNAS \u306e\u7a3c\u50cd\u7387\u306b\u4f9d\u5b58\uff08Google Drive \u306e 99.9%+ SLA \u3068\u6bd4\u8f03\uff09\u3002</li> <li>NAS \u306e\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u516c\u958b\u304c\u5fc5\u8981\uff08FTPS \u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u3001DDNS\uff09\u3002</li> </ul> </li> </ul>"},{"location":"design-decisions/#cloud-run-proxydocker","title":"Cloud Run Proxy\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5ec3\u6b62\u3068Docker\u30dc\u30ea\u30e5\u30fc\u30e0\u30de\u30a6\u30f3\u30c8\u3078\u306e\u79fb\u884c","text":"<p>Date: 2026-02-10 Status: Implemented</p>"},{"location":"design-decisions/#context_4","title":"Context","text":"<p><code>update_stocks_price.py</code>\uff08Cloud Run Job\uff09\u306f\u3001\u682a\u4fa1\u30c7\u30fc\u30bf\u3092DuckDB\u306b\u4fdd\u5b58\u3057\u305f\u5f8c\u3001<code>CloudRunClient</code> \u3092\u4f7f\u3063\u3066 Cloud Run Proxy \u7d4c\u7531\u3067 NAS \u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u3066\u3044\u305f\u3002\u3057\u304b\u3057\u3001Cloud Run Proxy \u3092\u4e2d\u7d99\u3059\u308b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306f\u8907\u96d1\u3055\u306e\u539f\u56e0\u3067\u3042\u308a\u3001Docker\u30dc\u30ea\u30e5\u30fc\u30e0\u30de\u30a6\u30f3\u30c8\u3067\u76f4\u63a5DuckDB\u30d5\u30a1\u30a4\u30eb\u306b\u66f8\u304d\u8fbc\u3080\u65b9\u304c\u30b7\u30f3\u30d7\u30eb\u3067\u4fe1\u983c\u6027\u304c\u9ad8\u3044\u3002</p>"},{"location":"design-decisions/#decision_4","title":"Decision","text":"<ul> <li><code>upload_to_cloud()</code> \u95a2\u6570\u306e\u524a\u9664: Cloud Run Proxy \u3078\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u51e6\u7406\u3092\u5b8c\u5168\u306b\u524a\u9664\u3002</li> <li><code>--dry-run</code> \u5f15\u6570\u306e\u524a\u9664: \u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3092\u30b9\u30ad\u30c3\u30d7\u3059\u308b\u76ee\u7684\u306e\u30d5\u30e9\u30b0\u3060\u3063\u305f\u305f\u3081\u3001\u4e0d\u8981\u306b\u3002</li> <li>Docker\u30dc\u30ea\u30e5\u30fc\u30e0\u30de\u30a6\u30f3\u30c8\u65b9\u5f0f\u306b\u5909\u66f4: <code>Dockerfile</code> \u306b <code>ENV STOCKDATA_CACHE_DIR=/cache</code> \u3092\u8ffd\u52a0\u3002\u30b3\u30f3\u30c6\u30ca\u5b9f\u884c\u6642\u306b <code>-v /host/path:/cache</code> \u3067\u30de\u30a6\u30f3\u30c8\u3059\u308b\u3053\u3068\u3067\u3001DuckDB\u30d5\u30a1\u30a4\u30eb\u3092\u30db\u30b9\u30c8\u5074\u306b\u6c38\u7d9a\u5316\u3002</li> <li><code>UpdateSummary</code> \u306e\u7c21\u7d20\u5316: <code>uploaded</code> / <code>upload_failed</code> \u30d5\u30a3\u30fc\u30eb\u30c9\u3092\u524a\u9664\u3002</li> </ul>"},{"location":"design-decisions/#consequences_4","title":"Consequences","text":"<ul> <li>\u30e1\u30ea\u30c3\u30c8:<ul> <li>Cloud Run Proxy \u3078\u306e\u4f9d\u5b58\u304c\u306a\u304f\u306a\u308a\u3001Job \u304c\u81ea\u5df1\u5b8c\u7d50\u578b\u306b\u306a\u3063\u305f\u3002</li> <li><code>UPLOAD_API_KEY</code> \u3068 <code>BACKCASTPRO_NAS_PROXY_URL</code> \u304c Job \u306e\u74b0\u5883\u5909\u6570\u304b\u3089\u4e0d\u8981\u306b\u3002</li> <li>\u30b3\u30fc\u30c9\u306e\u5927\u5e45\u306a\u7c21\u7d20\u5316\uff08<code>upload_to_cloud</code> \u95a2\u657052\u884c + \u95a2\u9023\u30b3\u30fc\u30c9\u524a\u9664\uff09\u3002</li> <li>\u30ed\u30fc\u30ab\u30ebDocker\u74b0\u5883\u3067\u306e\u30c6\u30b9\u30c8\u304c\u5bb9\u6613\u306b\uff08<code>docker run -v</code> \u306e\u307f\u3067\u52d5\u4f5c\u78ba\u8a8d\u53ef\u80fd\uff09\u3002</li> </ul> </li> <li>\u6ce8\u610f\u70b9:<ul> <li>Cloud Run Job \u3067\u4f7f\u7528\u3059\u308b\u5834\u5408\u306f\u3001\u30dc\u30ea\u30e5\u30fc\u30e0\u30de\u30a6\u30f3\u30c8\uff08GCS FUSE\u7b49\uff09\u306e\u8a2d\u5b9a\u304c\u5225\u9014\u5fc5\u8981\u3002</li> </ul> </li> </ul>"},{"location":"design-decisions/#cloud-run-jobsynology-nas-docker-dockerhub","title":"Cloud Run Job\u5ec3\u6b62\u3068Synology NAS Docker + DockerHub\u3078\u306e\u79fb\u884c","text":"<p>Date: 2026-02-10 Status: Implemented</p>"},{"location":"design-decisions/#context_5","title":"Context","text":"<p><code>update_stocks_price.py</code> \u306f Google Cloud Run Job \u3067\u5b9a\u671f\u5b9f\u884c\u3057\u3066\u3044\u305f\u304c\u3001\u81ea\u5b85\u306b Synology NAS\uff08DS218\uff09\u304c\u7a3c\u50cd\u3057\u3066\u304a\u308a\u3001Docker \u5b9f\u884c\u74b0\u5883\u304c\u5229\u7528\u53ef\u80fd\u3002Cloud Run Job \u306e\u8ab2\u984c\uff08GCS FUSE \u30de\u30a6\u30f3\u30c8\u8a2d\u5b9a\u306e\u8907\u96d1\u3055\u3001Google Cloud \u306e\u30b3\u30b9\u30c8\uff09\u3092\u89e3\u6d88\u3059\u308b\u305f\u3081\u3001NAS \u306e Docker \u3067\u76f4\u63a5\u5b9f\u884c\u3059\u308b\u69cb\u6210\u306b\u79fb\u884c\u3059\u308b\u3002</p>"},{"location":"design-decisions/#decision_5","title":"Decision","text":"<ul> <li>\u5b9f\u884c\u74b0\u5883\u306e\u5909\u66f4: Google Cloud Run Job \u2192 Synology NAS \u306e Docker\u3002NAS \u306e\u30bf\u30b9\u30af\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u3067\u5b9a\u671f\u5b9f\u884c\u3002</li> <li>\u30a4\u30e1\u30fc\u30b8\u914d\u5e03\u306e\u5909\u66f4: Google Artifact Registry \u2192 DockerHub (<code>backcast/cloud-job</code>)\u3002</li> <li>CI/CD\u306e\u5909\u66f4: <code>cloudbuild-job.yaml</code>\uff08Cloud Build\uff09\u2192 <code>.github/workflows/publish-dockerhub.yml</code>\uff08GitHub Actions\uff09\u3002<code>main</code> \u30d6\u30e9\u30f3\u30c1\u3078\u306e push \u3067\u81ea\u52d5\u30d3\u30eb\u30c9\u30fbpush\u3002</li> <li>\u30dc\u30ea\u30e5\u30fc\u30e0\u30de\u30a6\u30f3\u30c8: NAS \u306e\u30ed\u30fc\u30ab\u30eb\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092 <code>-v /volume1/docker/backcast/cache:/cache</code> \u3067\u30de\u30a6\u30f3\u30c8\u3057\u3001DuckDB \u30d5\u30a1\u30a4\u30eb\u3092\u6c38\u7d9a\u5316\u3002</li> </ul>"},{"location":"design-decisions/#consequences_5","title":"Consequences","text":"<ul> <li>\u30e1\u30ea\u30c3\u30c8:<ul> <li>Google Cloud \u306e\u904b\u7528\u30b3\u30b9\u30c8\u524a\u6e1b\uff08Cloud Run Job\u3001Cloud Scheduler\u3001Artifact Registry\uff09\u3002</li> <li>GCS FUSE \u30de\u30a6\u30f3\u30c8\u8a2d\u5b9a\u304c\u4e0d\u8981\u306b\u306a\u308a\u3001\u69cb\u6210\u304c\u30b7\u30f3\u30d7\u30eb\u306b\u3002</li> <li>NAS \u306e\u30ed\u30fc\u30ab\u30eb\u30c7\u30a3\u30b9\u30af\u306b\u76f4\u63a5\u66f8\u304d\u8fbc\u3080\u305f\u3081\u3001\u30c7\u30fc\u30bf\u30a2\u30af\u30bb\u30b9\u304c\u9ad8\u901f\u3002</li> <li>GitHub Actions + DockerHub \u3068\u3044\u3046\u30aa\u30fc\u30d7\u30f3\u306a CI/CD \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306b\u7d71\u4e00\u3002</li> </ul> </li> <li>\u30c7\u30e1\u30ea\u30c3\u30c8:<ul> <li>NAS \u306e\u7a3c\u50cd\u7387\u30fb\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u74b0\u5883\u306b\u4f9d\u5b58\u3002</li> <li>DockerHub \u306e pull rate limit\uff08\u7121\u6599\u30d7\u30e9\u30f3: 100 pulls/6h\uff09\u306b\u6ce8\u610f\u304c\u5fc5\u8981\u3002</li> </ul> </li> </ul>"},{"location":"design-decisions/#ftps","title":"FTPS\u5ec3\u6b62\u3068\u30ed\u30fc\u30ab\u30eb\u30d5\u30a1\u30a4\u30eb\u914d\u4fe1\u3078\u306e\u79fb\u884c","text":"<p>Date: 2026-02-10 Status: Implemented</p>"},{"location":"design-decisions/#context_6","title":"Context","text":"<p>Google Drive\u5ec3\u6b62\u3068\u81ea\u5b85NAS\uff08FTPS\uff09\u3078\u306e\u79fb\u884c\u3067 Cloud Run Proxy \u306e\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3092 FTPS \u306b\u5909\u66f4\u3057\u305f\u304c\u3001FTPS \u63a5\u7d9a\u306e\u8907\u96d1\u3055\uff08NAT \u8d8a\u3048\u3001SSL\u3001per-request \u63a5\u7d9a\uff09\u304c\u4e0d\u8981\u306a\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u3067\u3042\u3063\u305f\u3002NAS \u4e0a\u306e Docker \u3067 Cloud Run Proxy \u3092\u5b9f\u884c\u3059\u308b\u5834\u5408\u3001\u30c7\u30fc\u30bf\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30dc\u30ea\u30e5\u30fc\u30e0\u30de\u30a6\u30f3\u30c8\u3059\u308c\u3070\u30ed\u30fc\u30ab\u30eb\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u76f4\u63a5\u914d\u4fe1\u3067\u304d\u3001FTPS \u3092\u7d4c\u7531\u3059\u308b\u5fc5\u8981\u304c\u306a\u3044\u3002</p>"},{"location":"design-decisions/#decision_6","title":"Decision","text":"<ul> <li>FTPS \u95a2\u9023\u30b3\u30fc\u30c9\u306e\u5b8c\u5168\u524a\u9664: <code>NASFtpsProxy</code> \u30af\u30e9\u30b9\u3001<code>_NatFriendlyFTP_TLS</code> \u30af\u30e9\u30b9\u3001<code>_get_proxy()</code> \u95a2\u6570\u3092\u524a\u9664\u3002<code>ftplib</code>\u3001<code>ssl</code> \u306e\u30a4\u30f3\u30dd\u30fc\u30c8\u3082\u524a\u9664\u3002</li> <li><code>flask.send_from_directory</code> \u306b\u3088\u308b\u30ed\u30fc\u30ab\u30eb\u30d5\u30a1\u30a4\u30eb\u914d\u4fe1: \u74b0\u5883\u5909\u6570 <code>DATA_DIR</code>\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: <code>/cache</code>\uff09\u3067\u6307\u5b9a\u3055\u308c\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u3092\u76f4\u63a5\u914d\u4fe1\u3002</li> <li>\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u9020: <code>{DATA_DIR}/jp/{file_path}</code>\uff08\u4f8b: <code>/cache/jp/stocks_daily/1234.duckdb</code>\uff09\u3002</li> <li>HTTP API \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306f\u7dad\u6301: <code>GET /jp/&lt;path:file_path&gt;</code> \u306f\u305d\u306e\u307e\u307e\u3002\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\uff08<code>CloudRunClient</code>\uff09\u306e\u5909\u66f4\u306f\u4e0d\u8981\u3002</li> <li><code>ALLOWED_PATHS</code> \u30db\u30ef\u30a4\u30c8\u30ea\u30b9\u30c8\u306f\u7dad\u6301: \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u306e\u305f\u3081\u30d1\u30b9\u691c\u8a3c\u306f\u7d99\u7d9a\u3002</li> </ul>"},{"location":"design-decisions/#consequences_6","title":"Consequences","text":"<ul> <li>\u30e1\u30ea\u30c3\u30c8:<ul> <li>\u30b3\u30fc\u30c9\u306e\u5927\u5e45\u306a\u7c21\u7d20\u5316\uff08165\u884c \u2192 53\u884c\uff09\u3002</li> <li>FTPS \u63a5\u7d9a\u306e\u8907\u96d1\u3055\uff08NAT \u8d8a\u3048\u3001SSL \u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3001per-request \u63a5\u7d9a\uff09\u3092\u6392\u9664\u3002</li> <li>FTP \u95a2\u9023\u306e\u74b0\u5883\u5909\u6570\uff08<code>FTPS_HOST</code>, <code>FTPS_PORT</code>, <code>FTPS_USERNAME</code>, <code>FTPS_PASSWORD</code> \u7b49\uff09\u304c\u4e0d\u8981\u306b\u3002</li> <li>NAS \u306e\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u516c\u958b\uff08FTPS \u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\uff09\u304c\u4e0d\u8981\u306b\u3002</li> <li>\u30dc\u30ea\u30e5\u30fc\u30e0\u30de\u30a6\u30f3\u30c8\uff08<code>-v /volume1/docker/backcast/cache:/cache</code>\uff09\u306e\u307f\u3067\u52d5\u4f5c\u3002</li> </ul> </li> <li>\u6ce8\u610f\u70b9:<ul> <li>Cloud Run \u3067\u4f7f\u7528\u3059\u308b\u5834\u5408\u306f GCS \u30d0\u30b1\u30c3\u30c8\u3084 NFS \u7b49\u306e\u30dc\u30ea\u30e5\u30fc\u30e0\u30de\u30a6\u30f3\u30c8\u8a2d\u5b9a\u304c\u5fc5\u8981\u3002</li> </ul> </li> </ul>"},{"location":"design-decisions/#_2","title":"\u30c7\u30d7\u30ed\u30a4","text":"<p>Docker \u3067\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u5834\u5408\u3001\u30c7\u30fc\u30bf\u304c\u4fdd\u5b58\u3055\u308c\u3066\u3044\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092 <code>/cache</code> \u306b\u30de\u30a6\u30f3\u30c8\u3059\u308c\u3070\u3001<code>DATA_DIR</code> \u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3067\u305d\u306e\u307e\u307e\u52d5\u4f5c\u3057\u307e\u3059\u3002</p> <pre><code>docker run -v /volume1/docker/backcast/cache:/cache -p 8080:8080 cloud-run\n</code></pre> <p>\u30de\u30a6\u30f3\u30c8\u5148\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u9020:</p> <pre><code>/cache/\n  jp/\n    stocks_daily/1234.duckdb\n    stocks_board/8306.duckdb\n    listed_info.duckdb\n</code></pre> <p>Cloud Run \u306b\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u5834\u5408\u306f\u3001GCS \u30d0\u30b1\u30c3\u30c8\u3084 NFS \u306a\u3069\u306e\u30dc\u30ea\u30e5\u30fc\u30e0\u3092 <code>/cache</code> \u306b\u30de\u30a6\u30f3\u30c8\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p>"},{"location":"developer-guide/","title":"\u958b\u767a\u8005\u5411\u3051\u30ac\u30a4\u30c9","text":"<p>BackcastPro\u306e\u958b\u767a\u306b\u53c2\u52a0\u3059\u308b\u305f\u3081\u306e\u30ac\u30a4\u30c9\u3067\u3059\u3002</p>"},{"location":"developer-guide/#_2","title":"\u76ee\u6b21","text":"<ul> <li>\u958b\u767a\u74b0\u5883\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7</li> <li>\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u69cb\u9020</li> <li>\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3</li> <li>\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u898f\u7d04</li> <li>\u30c6\u30b9\u30c8</li> <li>\u30b3\u30f3\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3</li> <li>\u30ea\u30ea\u30fc\u30b9\u30d7\u30ed\u30bb\u30b9</li> </ul>"},{"location":"developer-guide/#_3","title":"\u958b\u767a\u74b0\u5883\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7","text":""},{"location":"developer-guide/#_4","title":"\u5fc5\u8981\u306a\u30c4\u30fc\u30eb","text":"<ul> <li>Python 3.9+</li> <li>Git</li> <li>pip</li> <li>\u30c6\u30ad\u30b9\u30c8\u30a8\u30c7\u30a3\u30bf\uff08VS Code\u63a8\u5968\uff09</li> </ul>"},{"location":"developer-guide/#_5","title":"\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u624b\u9806","text":"<ol> <li> <p>\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u30af\u30ed\u30fc\u30f3 <pre><code>git clone https://github.com/botterYosuke/BackcastPro.git\ncd BackcastPro\n</code></pre></p> </li> <li> <p>\u4eee\u60f3\u74b0\u5883\u3092\u4f5c\u6210 <pre><code>python -m venv .venv\n.\\.venv\\Scripts\\Activate.ps1\n</code></pre></p> </li> <li> <p>\u4f9d\u5b58\u95a2\u4fc2\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb <pre><code>python -m pip install -e .\n</code></pre></p> </li> <li> <p>\u958b\u767a\u7528\u4f9d\u5b58\u95a2\u4fc2\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb <pre><code>python -m pip install pytest pytest-cov flask\n</code></pre></p> </li> </ol>"},{"location":"developer-guide/#vs-code","title":"VS Code\u8a2d\u5b9a","text":"<p><code>.vscode/settings.json</code>\u3092\u4f5c\u6210\uff1a</p> <pre><code>{\n    \"python.defaultInterpreterPath\": \".\\\\.venv\\\\Scripts\\\\python.exe\",\n    \"python.linting.enabled\": true,\n    \"python.linting.flake8Enabled\": true,\n    \"python.formatting.provider\": \"black\",\n    \"python.testing.pytestEnabled\": true,\n    \"python.testing.pytestArgs\": [\"tests\"]\n}\n</code></pre>"},{"location":"developer-guide/#_6","title":"\u74b0\u5883\u5909\u6570\u306e\u8a2d\u5b9a","text":"<p><code>.env</code>\u30d5\u30a1\u30a4\u30eb\u3092\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30eb\u30fc\u30c8\u306b\u4f5c\u6210\u3057\u3001\u4ee5\u4e0b\u306e\u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\uff08\u5fc5\u8981\u306b\u5fdc\u3058\u3066\uff09\uff1a</p> <pre><code># DuckDB\u30ad\u30e3\u30c3\u30b7\u30e5\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\nSTOCKDATA_CACHE_DIR=/path/to/your/duckdb/cache\n\n# Cloud Run \u30d5\u30a1\u30a4\u30eb\u30b5\u30fc\u30d0\u30fc\u306eURL\uff08DuckDB\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u7528\u3001\u30aa\u30d7\u30b7\u30e7\u30f3\uff09\nBACKCASTPRO_NAS_PROXY_URL=https://your-cloud-run-url.a.run.app\n</code></pre>"},{"location":"developer-guide/#_7","title":"\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u69cb\u9020","text":"<pre><code>BackcastPro/\n\u251c\u2500\u2500 src/\n\u2502   \u2514\u2500\u2500 BackcastPro/\n\u2502       \u251c\u2500\u2500 __init__.py          # \u30e1\u30a4\u30f3\u30d1\u30c3\u30b1\u30fc\u30b8\n\u2502       \u251c\u2500\u2500 backtest.py          # \u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u30a8\u30f3\u30b8\u30f3\n\u2502       \u251c\u2500\u2500 _broker.py           # \u30d6\u30ed\u30fc\u30ab\u30fc\u5b9f\u88c5\n\u2502       \u251c\u2500\u2500 _stats.py            # \u7d71\u8a08\u8a08\u7b97\n\u2502       \u251c\u2500\u2500 order.py             # \u6ce8\u6587\u30af\u30e9\u30b9\n\u2502       \u251c\u2500\u2500 position.py          # \u30dd\u30b8\u30b7\u30e7\u30f3\u30af\u30e9\u30b9\n\u2502       \u251c\u2500\u2500 trade.py             # \u30c8\u30ec\u30fc\u30c9\u30af\u30e9\u30b9\n\u2502       \u2514\u2500\u2500 api/                 # \u30c7\u30fc\u30bf\u53d6\u5f97API\n\u2502           \u251c\u2500\u2500 __init__.py\n\u2502           \u251c\u2500\u2500 stocks_price.py  # \u65e5\u8db3\u30c7\u30fc\u30bf\u53d6\u5f97\n\u2502           \u251c\u2500\u2500 stocks_board.py  # \u677f\u60c5\u5831\u53d6\u5f97\n\u2502           \u251c\u2500\u2500 stocks_info.py   # \u9298\u67c4\u60c5\u5831\u53d6\u5f97\n\u2502           \u251c\u2500\u2500 db_manager.py    # \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u7ba1\u7406\n\u2502           \u251c\u2500\u2500 db_stocks_daily.py\n\u2502           \u251c\u2500\u2500 db_stocks_board.py\n\u2502           \u251c\u2500\u2500 db_stocks_info.py\n\u2502           \u2514\u2500\u2500 cloud_run_client.py # Cloud Run \u30d5\u30a1\u30a4\u30eb\u30b5\u30fc\u30d0\u30fc\u7d4c\u7531\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c0\u30fc\n\u251c\u2500\u2500 cloud-job/                    # \u682a\u4fa1\u30c7\u30fc\u30bf\u66f4\u65b0\u30b8\u30e7\u30d6\n\u2502   \u251c\u2500\u2500 update_stocks_price.py   # \u66f4\u65b0\u30b9\u30af\u30ea\u30d7\u30c8\n\u2502   \u251c\u2500\u2500 Dockerfile               # \u30b3\u30f3\u30c6\u30ca\u5b9a\u7fa9\uff08DockerHub: backcast/cloud-job\uff09\n\u2502   \u251c\u2500\u2500 .env.example             # \u74b0\u5883\u5909\u6570\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\n\u2502   \u2514\u2500\u2500 requirements.txt         # \u4f9d\u5b58\u30d1\u30c3\u30b1\u30fc\u30b8\n\u251c\u2500\u2500 cloud-run/                    # \u30ed\u30fc\u30ab\u30eb\u30d5\u30a1\u30a4\u30eb\u914d\u4fe1\u30b5\u30fc\u30d0\u30fc\n\u2502   \u251c\u2500\u2500 main.py                  # \u30ed\u30fc\u30ab\u30eb\u30d5\u30a1\u30a4\u30eb\u2192HTTP\u914d\u4fe1\u5b9f\u88c5\n\u2502   \u251c\u2500\u2500 Dockerfile               # \u30b3\u30f3\u30c6\u30ca\u5b9a\u7fa9\n\u2502   \u2514\u2500\u2500 .env.example             # \u74b0\u5883\u5909\u6570\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\n\u251c\u2500\u2500 tests/                       # \u30c6\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\n\u251c\u2500\u2500 docs/                        # \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\n\u2502   \u2514\u2500\u2500 examples/                # \u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\n\u251c\u2500\u2500 pyproject.toml              # \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u8a2d\u5b9a\n\u2514\u2500\u2500 README.md                   # \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u8aac\u660e\n</code></pre>"},{"location":"developer-guide/#_8","title":"\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3","text":""},{"location":"developer-guide/#_9","title":"\u4e3b\u8981\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8","text":""},{"location":"developer-guide/#1-backtest","title":"1. Backtest\u30af\u30e9\u30b9","text":"<ul> <li>\u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u306e\u5b9f\u884c\u3092\u7ba1\u7406</li> <li>\u30c7\u30fc\u30bf\u3068\u6226\u7565\u95a2\u6570\u3092\u7d71\u5408</li> <li>\u30b9\u30c6\u30c3\u30d7\u5b9f\u884c\u30fb\u4e00\u62ec\u5b9f\u884c\u3092\u30b5\u30dd\u30fc\u30c8</li> <li>\u7d50\u679c\u306e\u8a08\u7b97\u3068\u8fd4\u5374</li> </ul>"},{"location":"developer-guide/#2-function-based-api","title":"2. \u6226\u7565\u95a2\u6570\uff08function-based API\uff09","text":"<ul> <li>\u30e6\u30fc\u30b6\u30fc\u304c\u5b9a\u7fa9\u3059\u308b\u6226\u7565\u30ed\u30b8\u30c3\u30af</li> <li><code>def my_strategy(bt): ...</code> \u5f62\u5f0f</li> <li><code>bt.buy()</code> / <code>bt.sell()</code> \u3067\u58f2\u8cb7\u6307\u793a</li> </ul>"},{"location":"developer-guide/#3-_broker","title":"3. _Broker\u30af\u30e9\u30b9","text":"<ul> <li>\u6ce8\u6587\u306e\u5b9f\u884c\u3068\u7ba1\u7406</li> <li>\u30dd\u30b8\u30b7\u30e7\u30f3\u3068\u30c8\u30ec\u30fc\u30c9\u306e\u8ffd\u8de1</li> <li>\u624b\u6570\u6599\u3068\u30b9\u30d7\u30ec\u30c3\u30c9\u306e\u8a08\u7b97</li> </ul>"},{"location":"developer-guide/#4-api","title":"4. API\u30e2\u30b8\u30e5\u30fc\u30eb","text":"<ul> <li>\u5916\u90e8API\u304b\u3089\u306e\u30c7\u30fc\u30bf\u53d6\u5f97</li> <li>DuckDB\u3092\u4f7f\u3063\u305f\u30ed\u30fc\u30ab\u30eb\u30ad\u30e3\u30c3\u30b7\u30e5</li> <li>\u65e5\u672c\u682a\u4fa1\u30fb\u677f\u60c5\u5831\u30fb\u9298\u67c4\u60c5\u5831\u306e\u53d6\u5f97</li> <li>\u30c7\u30fc\u30bf\u53d6\u5f97\u30d5\u30ed\u30fc:</li> <li>\u30ed\u30fc\u30ab\u30eb\u30ad\u30e3\u30c3\u30b7\u30e5\uff08DuckDB\uff09\u3092\u78ba\u8a8d</li> <li>\u306a\u3051\u308c\u3070Cloud Run \u30d5\u30a1\u30a4\u30eb\u30b5\u30fc\u30d0\u30fc\u7d4c\u7531\u3067\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9</li> <li>\u30c7\u30fc\u30bf\u66f4\u65b0: \u591c\u9593\u306bDocker\u30b3\u30f3\u30c6\u30ca\u304c\u5b9f\u884c\u3055\u308c\u3001\u30de\u30a6\u30f3\u30c8\u30dc\u30ea\u30e5\u30fc\u30e0\u4e0a\u306eDuckDB\u30d5\u30a1\u30a4\u30eb\u3092\u66f4\u65b0\uff08\u8a73\u7d30\u306fDocker Job\u306b\u3088\u308b\u682a\u4fa1\u30c7\u30fc\u30bf\u66f4\u65b0\u3092\u53c2\u7167\uff09</li> </ul>"},{"location":"developer-guide/#_10","title":"\u30c7\u30fc\u30bf\u30d5\u30ed\u30fc","text":"<pre><code>1. \u30c7\u30fc\u30bf\u53d6\u5f97\n   \u2193\n2. \u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u521d\u671f\u5316 (Backtest.__init__)\n   \u2193\n3. \u6226\u7565\u95a2\u6570\u8a2d\u5b9a (set_strategy)\n   \u2193\n4. \u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u958b\u59cb (start)\n   \u2193\n5. \u5404\u30b9\u30c6\u30c3\u30d7\u3067\u6226\u7565\u95a2\u6570\u5b9f\u884c (strategy(bt))\n   \u2193\n6. 1\u30d0\u30fc\u9032\u3081\u308b (step)\n   \u2193\n7. \u6ce8\u6587\u51e6\u7406 (_Broker.next)\n   \u2193\n8. \u7d71\u8a08\u8a08\u7b97 (finalize)\n   \u2193\n9. \u7d50\u679c\u8fd4\u5374 (pd.Series)\n</code></pre>"},{"location":"developer-guide/#_11","title":"\u30af\u30e9\u30b9\u56f3","text":"<pre><code>classDiagram\n    class Backtest {\n        +data: dict[str, DataFrame]\n        +set_strategy(func)\n        +start()\n        +step() bool\n        +goto(step, strategy)\n        +buy(**kwargs) Order\n        +sell(**kwargs) Order\n        +run() Series\n        +finalize() Series\n        +get_state_snapshot() dict\n    }\n\n    class _Broker {\n        +equity: float\n        +cash: float\n        +position: Position\n        +trades: List[Trade]\n        +next(current_time)\n        +new_order(**kwargs) Order\n    }\n\n    class Order {\n        +code: str\n        +size: float\n        +limit: float\n        +stop: float\n        +sl: float\n        +tp: float\n        +tag: object\n    }\n\n    class Position {\n        +size: float\n        +is_long: bool\n        +is_short: bool\n        +close()\n    }\n\n    class Trade {\n        +code: str\n        +entry_price: float\n        +exit_price: float\n        +entry_time: Timestamp\n        +exit_time: Timestamp\n        +pl: float\n        +close()\n    }\n\n    Backtest --&gt; _Broker\n    _Broker --&gt; Order\n    _Broker --&gt; Position\n    _Broker --&gt; Trade</code></pre>"},{"location":"developer-guide/#_12","title":"\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u898f\u7d04","text":""},{"location":"developer-guide/#python","title":"Python\u30b9\u30bf\u30a4\u30eb","text":"<ul> <li>**PEP 8**\u306b\u6e96\u62e0</li> <li>**Black**\u3067\u30d5\u30a9\u30fc\u30de\u30c3\u30c8</li> <li>**flake8**\u3067\u30ea\u30f3\u30c8</li> <li>**mypy**\u3067\u578b\u30c1\u30a7\u30c3\u30af</li> </ul>"},{"location":"developer-guide/#_13","title":"\u547d\u540d\u898f\u5247","text":"<ul> <li>\u30af\u30e9\u30b9\u540d: PascalCase (\u4f8b: <code>Backtest</code>, <code>_Broker</code>)</li> <li>\u95a2\u6570\u540d: snake_case (\u4f8b: <code>run</code>, <code>compute_stats</code>)</li> <li>\u5909\u6570\u540d: snake_case (\u4f8b: <code>data</code>, <code>step_index</code>)</li> <li>\u5b9a\u6570\u540d: UPPER_SNAKE_CASE (\u4f8b: <code>DEFAULT_CASH</code>)</li> </ul>"},{"location":"developer-guide/#_14","title":"\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8","text":"<ul> <li>**docstring**\u306fGoogle\u5f62\u5f0f\u3092\u4f7f\u7528</li> <li>**\u578b\u30d2\u30f3\u30c8**\u3092\u5fc5\u9808\u3068\u3059\u308b</li> <li>**\u30b3\u30e1\u30f3\u30c8**\u306f\u65e5\u672c\u8a9e\u3067\u8a18\u8ff0</li> </ul>"},{"location":"developer-guide/#_15","title":"\u4f8b","text":"<pre><code>def calculate_rsi(data: pd.DataFrame, period: int = 14) -&gt; pd.Series:\n    \"\"\"\n    RSI\uff08\u76f8\u5bfe\u529b\u6307\u6570\uff09\u3092\u8a08\u7b97\u3057\u307e\u3059\u3002\n\n    Args:\n        data: OHLCV\u30c7\u30fc\u30bf\u3092\u542b\u3080DataFrame\n        period: RSI\u306e\u8a08\u7b97\u671f\u9593\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: 14\uff09\n\n    Returns:\n        RSI\u5024\u3092\u542b\u3080Series\n\n    Raises:\n        ValueError: \u30c7\u30fc\u30bf\u304c\u7a7a\u306e\u5834\u5408\n    \"\"\"\n    if data.empty:\n        raise ValueError(\"\u30c7\u30fc\u30bf\u304c\u7a7a\u3067\u3059\")\n\n    # RSI\u8a08\u7b97\u30ed\u30b8\u30c3\u30af\n    delta = data['Close'].diff()\n    gain = delta.clip(lower=0.0)\n    loss = -delta.clip(upper=0.0)\n\n    avg_gain = gain.rolling(period, min_periods=period).mean()\n    avg_loss = loss.rolling(period, min_periods=period).mean()\n\n    rs = avg_gain / (avg_loss.replace(0, pd.NA))\n    return 100 - (100 / (1 + rs))\n</code></pre>"},{"location":"developer-guide/#_16","title":"\u30c6\u30b9\u30c8","text":""},{"location":"developer-guide/#_17","title":"\u30c6\u30b9\u30c8\u69cb\u9020","text":"<pre><code>tests/\n\u251c\u2500\u2500 test_backtest_api.py              # \u30d0\u30c3\u30af\u30c6\u30b9\u30c8API\u306e\u30c6\u30b9\u30c8\n\u251c\u2500\u2500 test_backtest_set_data.py         # \u30c7\u30fc\u30bf\u8a2d\u5b9a\u306e\u30c6\u30b9\u30c8\n\u251c\u2500\u2500 test_backtest_step_loop.py        # \u30b9\u30c6\u30c3\u30d7\u5b9f\u884c\u306e\u30c6\u30b9\u30c8\n\u251c\u2500\u2500 test_cloud_run_main.py            # Cloud Run API\u306e\u30c6\u30b9\u30c8\n\u251c\u2500\u2500 test_db_stocks_board.py           # \u677f\u60c5\u5831DB\u306e\u30c6\u30b9\u30c8\n\u251c\u2500\u2500 test_db_stocks_daily.py           # \u65e5\u8db3DB\u306e\u30c6\u30b9\u30c8\n\u251c\u2500\u2500 test_db_stocks_info.py            # \u9298\u67c4\u60c5\u5831DB\u306e\u30c6\u30b9\u30c8\n\u251c\u2500\u2500 test_e_api.py                     # \u7acb\u82b1\u8a3c\u5238e\u652f\u5e97API\u306e\u30c6\u30b9\u30c8\n\u251c\u2500\u2500 test_cloud_run_client.py           # Cloud Run API\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u30c6\u30b9\u30c8\n\u251c\u2500\u2500 test_j-quants.py                  # J-Quants API\u306e\u30c6\u30b9\u30c8\n\u251c\u2500\u2500 test_kabusap.py                   # kabu\u30b9\u30c6\u30fc\u30b7\u30e7\u30f3API\u306e\u30c6\u30b9\u30c8\n\u251c\u2500\u2500 test_order.py                     # \u6ce8\u6587\u30af\u30e9\u30b9\u306e\u30c6\u30b9\u30c8\n\u251c\u2500\u2500 test_position.py                  # \u30dd\u30b8\u30b7\u30e7\u30f3\u30af\u30e9\u30b9\u306e\u30c6\u30b9\u30c8\n\u251c\u2500\u2500 test_relative_size_option_c.py    # \u76f8\u5bfe\u30b5\u30a4\u30ba\u30aa\u30d7\u30b7\u30e7\u30f3\u306e\u30c6\u30b9\u30c8\n\u251c\u2500\u2500 test_stats.py                     # \u7d71\u8a08\u8a08\u7b97\u306e\u30c6\u30b9\u30c8\n\u251c\u2500\u2500 test_stocks_board_wrapper.py      # \u677f\u60c5\u5831\u30e9\u30c3\u30d1\u30fc\u306e\u30c6\u30b9\u30c8\n\u251c\u2500\u2500 test_stocks_info_wrapper.py       # \u9298\u67c4\u60c5\u5831\u30e9\u30c3\u30d1\u30fc\u306e\u30c6\u30b9\u30c8\n\u251c\u2500\u2500 test_stocks_price_wrapper.py      # \u682a\u4fa1\u60c5\u5831\u30e9\u30c3\u30d1\u30fc\u306e\u30c6\u30b9\u30c8\n\u251c\u2500\u2500 test_stooq.py                     # Stooq\u30c7\u30fc\u30bf\u53d6\u5f97\u306e\u30c6\u30b9\u30c8\n\u251c\u2500\u2500 test_trade.py                     # \u30c8\u30ec\u30fc\u30c9\u30af\u30e9\u30b9\u306e\u30c6\u30b9\u30c8\n\u251c\u2500\u2500 test_update_stocks_price.py       # \u30c7\u30fc\u30bf\u66f4\u65b0\u30b8\u30e7\u30d6\u306e\u30c6\u30b9\u30c8\n\u251c\u2500\u2500 test_util.py                      # \u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\u306e\u30c6\u30b9\u30c8\n\u251c\u2500\u2500 import_equities_trades.py         # \u682a\u5f0f\u53d6\u5f15\u30c7\u30fc\u30bf\u30a4\u30f3\u30dd\u30fc\u30c8\u30b9\u30af\u30ea\u30d7\u30c8\n\u2514\u2500\u2500 import_minute_bars.py             # \u5206\u8db3\u30c7\u30fc\u30bf\u30a4\u30f3\u30dd\u30fc\u30c8\u30b9\u30af\u30ea\u30d7\u30c8\n</code></pre>"},{"location":"developer-guide/#_18","title":"\u30c6\u30b9\u30c8\u306e\u5b9f\u884c","text":"<pre><code># \u5168\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\npython -m pytest\n\n# \u30ab\u30d0\u30ec\u30c3\u30b8\u4ed8\u304d\u3067\u5b9f\u884c\npython -m pytest --cov=BackcastPro\n\n# \u7279\u5b9a\u306e\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\npython -m pytest tests/test_backtest_api.py\n\n# \u8a73\u7d30\u306a\u51fa\u529b\u3067\u5b9f\u884c\npython -m pytest -v\n</code></pre>"},{"location":"developer-guide/#_19","title":"\u30c6\u30b9\u30c8\u306e\u66f8\u304d\u65b9","text":"<pre><code>import pytest\nimport pandas as pd\nfrom BackcastPro import Backtest\n\n\ndef test_strategy(bt):\n    \"\"\"\u30c6\u30b9\u30c8\u7528\u306e\u6226\u7565\u95a2\u6570\"\"\"\n    for code, df in bt.data.items():\n        if len(df) == 1 and bt.position_of(code) == 0:\n            bt.buy(code=code, tag=\"test_buy\")\n\n\ndef test_backtest_basic():\n    \"\"\"\u57fa\u672c\u7684\u306a\u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u306e\u30c6\u30b9\u30c8\"\"\"\n    # \u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u3092\u4f5c\u6210\n    data = pd.DataFrame({\n        'Open': [100, 101, 102],\n        'High': [105, 106, 107],\n        'Low': [99, 100, 101],\n        'Close': [104, 105, 106],\n        'Volume': [1000, 1100, 1200]\n    }, index=pd.date_range('2023-01-01', periods=3))\n\n    # \u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\n    bt = Backtest(data={'TEST': data}, cash=10000)\n    bt.set_strategy(test_strategy)\n    results = bt.run()\n\n    # \u7d50\u679c\u3092\u691c\u8a3c\n    assert results['Return [%]'] &gt;= 0\n    assert results['# Trades'] &gt;= 0\n\n\ndef test_step_execution():\n    \"\"\"\u30b9\u30c6\u30c3\u30d7\u5b9f\u884c\u306e\u30c6\u30b9\u30c8\"\"\"\n    data = pd.DataFrame({\n        'Open': [100, 101, 102],\n        'High': [105, 106, 107],\n        'Low': [99, 100, 101],\n        'Close': [104, 105, 106],\n        'Volume': [1000, 1100, 1200]\n    }, index=pd.date_range('2023-01-01', periods=3))\n\n    bt = Backtest(data={'TEST': data}, cash=10000)\n\n    count = 0\n    while not bt.is_finished:\n        test_strategy(bt)\n        bt.step()\n        count += 1\n\n    assert count == 3\n    assert bt.is_finished\n</code></pre>"},{"location":"developer-guide/#_20","title":"\u30d5\u30a3\u30af\u30b9\u30c1\u30e3\u306e\u4f7f\u7528","text":"<pre><code>@pytest.fixture\ndef sample_data():\n    \"\"\"\u30b5\u30f3\u30d7\u30eb\u30c7\u30fc\u30bf\u306e\u30d5\u30a3\u30af\u30b9\u30c1\u30e3\"\"\"\n    return pd.DataFrame({\n        'Open': [100, 101, 102, 103, 104],\n        'High': [105, 106, 107, 108, 109],\n        'Low': [99, 100, 101, 102, 103],\n        'Close': [104, 105, 106, 107, 108],\n        'Volume': [1000, 1100, 1200, 1300, 1400]\n    }, index=pd.date_range('2023-01-01', periods=5))\n\n\n@pytest.fixture\ndef simple_strategy():\n    \"\"\"\u30b7\u30f3\u30d7\u30eb\u306a\u6226\u7565\u95a2\u6570\u306e\u30d5\u30a3\u30af\u30b9\u30c1\u30e3\"\"\"\n    def strategy(bt):\n        for code, df in bt.data.items():\n            if len(df) == 1 and bt.position_of(code) == 0:\n                bt.buy(code=code)\n    return strategy\n\n\ndef test_with_fixtures(sample_data, simple_strategy):\n    \"\"\"\u30d5\u30a3\u30af\u30b9\u30c1\u30e3\u3092\u4f7f\u7528\u3057\u305f\u30c6\u30b9\u30c8\"\"\"\n    bt = Backtest(data={'TEST': sample_data}, cash=10000)\n    bt.set_strategy(simple_strategy)\n    results = bt.run()\n    assert results['Return [%]'] &gt;= 0\n</code></pre>"},{"location":"developer-guide/#_21","title":"\u30b3\u30f3\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3","text":""},{"location":"developer-guide/#_22","title":"\u30b3\u30f3\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u306e\u6d41\u308c","text":"<ol> <li>Issue\u3092\u4f5c\u6210 - \u30d0\u30b0\u5831\u544a\u3084\u6a5f\u80fd\u8981\u6c42</li> <li>Fork - \u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u30d5\u30a9\u30fc\u30af</li> <li>\u30d6\u30e9\u30f3\u30c1\u4f5c\u6210 - \u6a5f\u80fd\u30d6\u30e9\u30f3\u30c1\u3092\u4f5c\u6210</li> <li>\u958b\u767a - \u30b3\u30fc\u30c9\u3092\u5b9f\u88c5</li> <li>\u30c6\u30b9\u30c8 - \u30c6\u30b9\u30c8\u3092\u5b9f\u884c</li> <li>Pull Request - PR\u3092\u4f5c\u6210</li> <li>\u30ec\u30d3\u30e5\u30fc - \u30b3\u30fc\u30c9\u30ec\u30d3\u30e5\u30fc\u3092\u53d7\u3051\u308b</li> <li>\u30de\u30fc\u30b8 - \u30e1\u30a4\u30f3\u30d6\u30e9\u30f3\u30c1\u306b\u30de\u30fc\u30b8</li> </ol>"},{"location":"developer-guide/#_23","title":"\u30d6\u30e9\u30f3\u30c1\u547d\u540d\u898f\u5247","text":"<ul> <li><code>feature/\u6a5f\u80fd\u540d</code> - \u65b0\u6a5f\u80fd</li> <li><code>bugfix/\u30d0\u30b0\u540d</code> - \u30d0\u30b0\u4fee\u6b63</li> <li><code>docs/\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u540d</code> - \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u66f4\u65b0</li> <li><code>refactor/\u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\u540d</code> - \u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0</li> </ul>"},{"location":"developer-guide/#_24","title":"\u30b3\u30df\u30c3\u30c8\u30e1\u30c3\u30bb\u30fc\u30b8","text":"<pre><code>&lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;\n\n&lt;body&gt;\n\n&lt;footer&gt;\n</code></pre> <p>\u4f8b: <pre><code>feat(backtest): \u30d7\u30ed\u30b0\u30ec\u30b9\u30d0\u30fc\u3092\u8ffd\u52a0\n\n\u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u5b9f\u884c\u4e2d\u306b\u30d7\u30ed\u30b0\u30ec\u30b9\u30d0\u30fc\u3092\u8868\u793a\u3059\u308b\u6a5f\u80fd\u3092\u8ffd\u52a0\u3002\ntqdm\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u7528\u3057\u3066\u5b9f\u88c5\u3002\n\nCloses #123\n</code></pre></p>"},{"location":"developer-guide/#pull-request","title":"Pull Request","text":"<p>PR\u3092\u4f5c\u6210\u3059\u308b\u969b\u306f\u4ee5\u4e0b\u3092\u542b\u3081\u3066\u304f\u3060\u3055\u3044\uff1a</p> <ol> <li>\u5909\u66f4\u5185\u5bb9\u306e\u8aac\u660e</li> <li>\u30c6\u30b9\u30c8\u7d50\u679c</li> <li>\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\uff08UI\u5909\u66f4\u306e\u5834\u5408\uff09</li> <li>**\u95a2\u9023Issue**\u3078\u306e\u30ea\u30f3\u30af</li> </ol>"},{"location":"developer-guide/#_25","title":"\u30b3\u30fc\u30c9\u30ec\u30d3\u30e5\u30fc","text":"<p>\u30ec\u30d3\u30e5\u30fc\u6642\u306f\u4ee5\u4e0b\u3092\u78ba\u8a8d\uff1a</p> <ol> <li>\u30b3\u30fc\u30c9\u54c1\u8cea - \u53ef\u8aad\u6027\u3001\u4fdd\u5b88\u6027</li> <li>\u30c6\u30b9\u30c8 - \u30c6\u30b9\u30c8\u30ab\u30d0\u30ec\u30c3\u30b8</li> <li>\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 - \u66f4\u65b0\u306e\u5fc5\u8981\u6027</li> <li>\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9 - \u6027\u80fd\u3078\u306e\u5f71\u97ff</li> </ol>"},{"location":"developer-guide/#_26","title":"\u30ea\u30ea\u30fc\u30b9\u30d7\u30ed\u30bb\u30b9","text":""},{"location":"developer-guide/#_27","title":"\u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406","text":"<ul> <li>**\u30bb\u30de\u30f3\u30c6\u30a3\u30c3\u30af\u30d0\u30fc\u30b8\u30e7\u30cb\u30f3\u30b0**\u3092\u4f7f\u7528</li> <li>**MAJOR.MINOR.PATCH**\u5f62\u5f0f</li> <li>MAJOR: \u7834\u58ca\u7684\u5909\u66f4</li> <li>MINOR: \u65b0\u6a5f\u80fd\u8ffd\u52a0</li> <li>PATCH: \u30d0\u30b0\u4fee\u6b63</li> </ul>"},{"location":"developer-guide/#_28","title":"\u30ea\u30ea\u30fc\u30b9\u624b\u9806","text":"<ol> <li> <p>\u30d0\u30fc\u30b8\u30e7\u30f3\u66f4\u65b0 <pre><code># pyproject.toml \u306e version \u3092\u66f4\u65b0\nversion = \"0.4.0\"\n</code></pre></p> </li> <li> <p>CHANGELOG\u66f4\u65b0 <pre><code>## [0.4.0] - 2025-01-01\n\n### Added\n- \u65b0\u6a5f\u80fdA\n- \u65b0\u6a5f\u80fdB\n\n### Changed\n- \u65e2\u5b58\u6a5f\u80fd\u306e\u6539\u5584\n\n### Fixed\n- \u30d0\u30b0\u4fee\u6b63A\n- \u30d0\u30b0\u4fee\u6b63B\n</code></pre></p> </li> <li> <p>\u30c6\u30b9\u30c8\u5b9f\u884c <pre><code>python -m pytest\npython -m pytest --cov=BackcastPro\n</code></pre></p> </li> <li> <p>\u30d3\u30eb\u30c9 <pre><code>uv build\n</code></pre></p> </li> <li> <p>PyPI\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9 <pre><code>uv publish\n</code></pre></p> </li> <li> <p>Git\u30bf\u30b0\u4f5c\u6210 <pre><code>git tag v0.4.0\ngit push origin v0.4.0\n</code></pre></p> </li> </ol>"},{"location":"developer-guide/#_29","title":"\u81ea\u52d5\u5316","text":"<p>GitHub Actions\u3092\u4f7f\u7528\u3057\u3066\u4ee5\u4e0b\u3092\u81ea\u52d5\u5316\uff1a</p> <ul> <li>\u30c6\u30b9\u30c8\u5b9f\u884c - PR\u4f5c\u6210\u6642</li> <li>\u30b3\u30fc\u30c9\u54c1\u8cea\u30c1\u30a7\u30c3\u30af - \u30ea\u30f3\u30c8\u3001\u30d5\u30a9\u30fc\u30de\u30c3\u30c8</li> <li>\u30d3\u30eb\u30c9 - \u30ea\u30ea\u30fc\u30b9\u6642</li> <li>PyPI\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9 - <code>main</code> push\u6642\uff08<code>.github/workflows/publish-pypi.yml</code>\uff09</li> <li>DockerHub push - <code>main</code> push\u6642\uff08<code>.github/workflows/publish-dockerhub.yml</code> \u2192 <code>backcast/cloud-job</code>\uff09</li> <li>\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 - <code>main</code> push\u6642\uff08<code>.github/workflows/docs.yml</code>\uff09</li> </ul>"},{"location":"developer-guide/#_30","title":"\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u6700\u9069\u5316","text":""},{"location":"developer-guide/#_31","title":"\u30d7\u30ed\u30d5\u30a1\u30a4\u30ea\u30f3\u30b0","text":"<pre><code>import cProfile\nimport pstats\nfrom BackcastPro import Backtest\n\ndef profile_backtest():\n    \"\"\"\u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u306e\u30d7\u30ed\u30d5\u30a1\u30a4\u30ea\u30f3\u30b0\"\"\"\n    def my_strategy(bt):\n        for code, df in bt.data.items():\n            if len(df) &gt; 20 and bt.position_of(code) == 0:\n                sma = df['Close'].rolling(20).mean().iloc[-1]\n                if df['Close'].iloc[-1] &lt; sma:\n                    bt.buy(code=code)\n\n    # \u30d7\u30ed\u30d5\u30a1\u30a4\u30ea\u30f3\u30b0\u3092\u958b\u59cb\n    profiler = cProfile.Profile()\n    profiler.enable()\n\n    # \u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\n    bt = Backtest(data={'TEST': data}, cash=10000)\n    bt.set_strategy(my_strategy)\n    results = bt.run()\n\n    # \u30d7\u30ed\u30d5\u30a1\u30a4\u30ea\u30f3\u30b0\u3092\u505c\u6b62\n    profiler.disable()\n\n    # \u7d50\u679c\u3092\u8868\u793a\n    stats = pstats.Stats(profiler)\n    stats.sort_stats('cumulative')\n    stats.print_stats(10)\n\nif __name__ == \"__main__\":\n    profile_backtest()\n</code></pre>"},{"location":"developer-guide/#_32","title":"\u30e1\u30e2\u30ea\u4f7f\u7528\u91cf\u306e\u76e3\u8996","text":"<pre><code>import psutil\nimport os\n\ndef monitor_memory():\n    \"\"\"\u30e1\u30e2\u30ea\u4f7f\u7528\u91cf\u3092\u76e3\u8996\"\"\"\n    def my_strategy(bt):\n        for code, df in bt.data.items():\n            if bt.position_of(code) == 0:\n                bt.buy(code=code)\n\n    process = psutil.Process(os.getpid())\n\n    # \u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u524d\n    memory_before = process.memory_info().rss / 1024 / 1024  # MB\n\n    # \u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u5b9f\u884c\n    bt = Backtest(data={'TEST': data}, cash=10000)\n    bt.set_strategy(my_strategy)\n    results = bt.run()\n\n    # \u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u5f8c\n    memory_after = process.memory_info().rss / 1024 / 1024  # MB\n\n    print(f\"\u30e1\u30e2\u30ea\u4f7f\u7528\u91cf: {memory_after - memory_before:.2f} MB\")\n</code></pre>"},{"location":"developer-guide/#_33","title":"\u307e\u3068\u3081","text":"<p>\u3053\u306e\u958b\u767a\u8005\u5411\u3051\u30ac\u30a4\u30c9\u3067\u306f\u3001BackcastPro\u306e\u958b\u767a\u306b\u53c2\u52a0\u3059\u308b\u305f\u3081\u306e\u60c5\u5831\u3092\u63d0\u4f9b\u3057\u307e\u3057\u305f\uff1a</p> <ol> <li>\u958b\u767a\u74b0\u5883\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7 - \u5fc5\u8981\u306a\u30c4\u30fc\u30eb\u3068\u624b\u9806</li> <li>\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u69cb\u9020 - \u30b3\u30fc\u30c9\u306e\u7d44\u7e54</li> <li>\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3 - \u30b7\u30b9\u30c6\u30e0\u306e\u8a2d\u8a08</li> <li>\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u898f\u7d04 - \u30b3\u30fc\u30c9\u30b9\u30bf\u30a4\u30eb\u3068\u54c1\u8cea</li> <li>\u30c6\u30b9\u30c8 - \u30c6\u30b9\u30c8\u306e\u66f8\u304d\u65b9\u3068\u5b9f\u884c</li> <li>\u30b3\u30f3\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3 - \u8ca2\u732e\u306e\u65b9\u6cd5</li> <li>\u30ea\u30ea\u30fc\u30b9\u30d7\u30ed\u30bb\u30b9 - \u30ea\u30ea\u30fc\u30b9\u306e\u624b\u9806</li> </ol> <p>\u3053\u308c\u3089\u306e\u60c5\u5831\u3092\u53c2\u8003\u306b\u3001BackcastPro\u306e\u958b\u767a\u306b\u53c2\u52a0\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p>"},{"location":"execution-logic-report/","title":"BackcastPro \u7d04\u5b9a\u30ed\u30b8\u30c3\u30af\u5206\u6790\u30ec\u30dd\u30fc\u30c8","text":""},{"location":"execution-logic-report/#_1","title":"\u6982\u8981","text":"<p>\u672c\u30ec\u30dd\u30fc\u30c8\u3067\u306f\u3001BackcastPro\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306b\u304a\u3051\u308b\u58f2\u8cb7\u7d04\u5b9a\u6642\u306e\u4fa1\u683c\u6c7a\u5b9a\u30ed\u30b8\u30c3\u30af\u306b\u3064\u3044\u3066\u8a73\u3057\u304f\u5206\u6790\u3057\u307e\u3059\u3002Open, High, Low, **Close**\u306e\u3069\u306e\u5024\u304c\u7d04\u5b9a\u4fa1\u683c\u3068\u3057\u3066\u4f7f\u7528\u3055\u308c\u308b\u304b\u3092\u660e\u78ba\u306b\u3057\u307e\u3059\u3002</p>"},{"location":"execution-logic-report/#_2","title":"\u7d04\u5b9a\u4fa1\u683c\u6c7a\u5b9a\u306e\u57fa\u672c\u30ed\u30b8\u30c3\u30af","text":""},{"location":"execution-logic-report/#1-market-order","title":"1. \u6210\u884c\u6ce8\u6587\uff08Market Order\uff09\u306e\u7d04\u5b9a\u4fa1\u683c","text":"<p>\u6210\u884c\u6ce8\u6587\u306f\u3001<code>_broker.py</code>\u306e<code>_process_orders()</code>\u30e1\u30bd\u30c3\u30c9\u5185\u3067\u4ee5\u4e0b\u306e\u30ed\u30b8\u30c3\u30af\u3067\u51e6\u7406\u3055\u308c\u307e\u3059\uff1a</p> <pre><code># \u6210\u884c\u6ce8\u6587\uff08Market-if-touched / market order\uff09\n# \u6761\u4ef6\u4ed8\u304d\u6ce8\u6587\u306f\u5e38\u306b\u6b21\u306e\u59cb\u5024\u3067\nprev_close = df.Close.iloc[-2]\nprice = prev_close if self._trade_on_close and not order.is_contingent else open\n</code></pre>"},{"location":"execution-logic-report/#_3","title":"\u7d04\u5b9a\u4fa1\u683c\u6c7a\u5b9a\u30eb\u30fc\u30eb\uff1a","text":"<ol> <li><code>trade_on_close=False</code>\u306e\u5834\u5408\uff08\u30c7\u30d5\u30a9\u30eb\u30c8\uff09\uff1a</li> <li>\u7d04\u5b9a\u4fa1\u683c = Open\uff08\u59cb\u5024\uff09</li> <li> <p>\u6b21\u306e\u30d0\u30fc\u306e\u59cb\u5024\u3067\u7d04\u5b9a</p> </li> <li> <p><code>trade_on_close=True</code>\u306e\u5834\u5408\uff1a</p> </li> <li>\u7d04\u5b9a\u4fa1\u683c = Close\uff08\u524d\u306e\u30d0\u30fc\u306e\u7d42\u5024\uff09</li> <li> <p>\u73fe\u5728\u306e\u30d0\u30fc\u306e\u7d42\u5024\u3067\u7d04\u5b9a</p> </li> <li> <p>\u6761\u4ef6\u4ed8\u304d\u6ce8\u6587\uff08SL/TP\u6ce8\u6587\uff09\u306e\u5834\u5408\uff1a</p> </li> <li>\u5e38\u306b**Open**\uff08\u59cb\u5024\uff09\u3067\u7d04\u5b9a</li> <li><code>trade_on_close</code>\u306e\u8a2d\u5b9a\u306b\u95a2\u4fc2\u306a\u304f</li> </ol>"},{"location":"execution-logic-report/#2-limit-order","title":"2. \u6307\u5024\u6ce8\u6587\uff08Limit Order\uff09\u306e\u7d04\u5b9a\u4fa1\u683c","text":"<p>\u6307\u5024\u6ce8\u6587\u306e\u7d04\u5b9a\u4fa1\u683c\u306f\u4ee5\u4e0b\u306e\u30ed\u30b8\u30c3\u30af\u3067\u6c7a\u5b9a\u3055\u308c\u307e\u3059\uff1a</p> <pre><code>if order.limit:\n    is_limit_hit = low &lt;= order.limit if order.is_long else high &gt;= order.limit\n    if not is_limit_hit or is_limit_hit_before_stop:\n        continue\n\n    # stop_price\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u3001\u3053\u306e\u30d0\u30fc\u5185\u3067\u6e80\u305f\u3055\u308c\u305f\n    price = (min(stop_price or open, order.limit)\n            if order.is_long else\n            max(stop_price or open, order.limit))\n</code></pre>"},{"location":"execution-logic-report/#_4","title":"\u7d04\u5b9a\u4fa1\u683c\u6c7a\u5b9a\u30eb\u30fc\u30eb\uff1a","text":"<ol> <li>\u30ed\u30f3\u30b0\u30dd\u30b8\u30b7\u30e7\u30f3\uff1a</li> <li>\u7d04\u5b9a\u6761\u4ef6\uff1a<code>Low &lt;= limit_price</code></li> <li> <p>\u7d04\u5b9a\u4fa1\u683c = <code>min(\u59cb\u5024 or \u30b9\u30c8\u30c3\u30d7\u4fa1\u683c, \u6307\u5024\u4fa1\u683c)</code></p> </li> <li> <p>\u30b7\u30e7\u30fc\u30c8\u30dd\u30b8\u30b7\u30e7\u30f3\uff1a</p> </li> <li>\u7d04\u5b9a\u6761\u4ef6\uff1a<code>High &gt;= limit_price</code></li> <li>\u7d04\u5b9a\u4fa1\u683c = <code>max(\u59cb\u5024 or \u30b9\u30c8\u30c3\u30d7\u4fa1\u683c, \u6307\u5024\u4fa1\u683c)</code></li> </ol>"},{"location":"execution-logic-report/#3-stop-order","title":"3. \u30b9\u30c8\u30c3\u30d7\u6ce8\u6587\uff08Stop Order\uff09\u306e\u7d04\u5b9a\u4fa1\u683c","text":"<p>\u30b9\u30c8\u30c3\u30d7\u6ce8\u6587\u306f\u4ee5\u4e0b\u306e\u30ed\u30b8\u30c3\u30af\u3067\u51e6\u7406\u3055\u308c\u307e\u3059\uff1a</p> <pre><code># \u30b9\u30c8\u30c3\u30d7\u6761\u4ef6\u304c\u6e80\u305f\u3055\u308c\u305f\u304b\u30c1\u30a7\u30c3\u30af\nstop_price = order.stop\nif stop_price:\n    is_stop_hit = ((high &gt;= stop_price) if order.is_long else (low &lt;= stop_price))\n    if not is_stop_hit:\n        continue\n\n    # \u30b9\u30c8\u30c3\u30d7\u4fa1\u683c\u306b\u9054\u3059\u308b\u3068\u3001\u30b9\u30c8\u30c3\u30d7\u6ce8\u6587\u306f\u6210\u884c/\u6307\u5024\u6ce8\u6587\u306b\u306a\u308b\n    order._replace(stop_price=None)\n</code></pre>"},{"location":"execution-logic-report/#_5","title":"\u7d04\u5b9a\u4fa1\u683c\u6c7a\u5b9a\u30eb\u30fc\u30eb\uff1a","text":"<ol> <li>\u30ed\u30f3\u30b0\u30dd\u30b8\u30b7\u30e7\u30f3\uff1a</li> <li>\u7d04\u5b9a\u6761\u4ef6\uff1a<code>High &gt;= stop_price</code></li> <li> <p>\u30b9\u30c8\u30c3\u30d7\u4fa1\u683c\u306b\u9054\u3057\u305f\u5f8c\u306f\u6210\u884c\u6ce8\u6587\u3068\u3057\u3066\u51e6\u7406</p> </li> <li> <p>\u30b7\u30e7\u30fc\u30c8\u30dd\u30b8\u30b7\u30e7\u30f3\uff1a</p> </li> <li>\u7d04\u5b9a\u6761\u4ef6\uff1a<code>Low &lt;= stop_price</code></li> <li>\u30b9\u30c8\u30c3\u30d7\u4fa1\u683c\u306b\u9054\u3057\u305f\u5f8c\u306f\u6210\u884c\u6ce8\u6587\u3068\u3057\u3066\u51e6\u7406</li> </ol>"},{"location":"execution-logic-report/#4","title":"4. \u30b9\u30c8\u30c3\u30d7\u30ed\u30b9/\u30c6\u30a4\u30af\u30d7\u30ed\u30d5\u30a3\u30c3\u30c8\u6ce8\u6587\u306e\u7d04\u5b9a\u4fa1\u683c","text":"<p>\u6761\u4ef6\u4ed8\u304d\u6ce8\u6587\uff08SL/TP\uff09\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u51e6\u7406\u3055\u308c\u307e\u3059\uff1a</p> <pre><code># \u6761\u4ef6\u4ed8\u304d\u6ce8\u6587\u306f\u5e38\u306b\u6b21\u306e\u59cb\u5024\u3067\nprev_close = df.Close.iloc[-2]\nprice = prev_close if self._trade_on_close and not order.is_contingent else open\n</code></pre>"},{"location":"execution-logic-report/#_6","title":"\u7d04\u5b9a\u4fa1\u683c\u6c7a\u5b9a\u30eb\u30fc\u30eb\uff1a","text":"<ul> <li>\u5e38\u306bOpen\uff08\u59cb\u5024\uff09\u3067\u7d04\u5b9a</li> <li><code>trade_on_close</code>\u306e\u8a2d\u5b9a\u306b\u95a2\u4fc2\u306a\u304f</li> </ul>"},{"location":"execution-logic-report/#_7","title":"\u30b9\u30d7\u30ec\u30c3\u30c9\u3068\u624b\u6570\u6599\u306e\u9069\u7528","text":"<p>\u7d04\u5b9a\u4fa1\u683c\u306f\u3001\u30b9\u30d7\u30ec\u30c3\u30c9\u3068\u624b\u6570\u6599\u3092\u8003\u616e\u3057\u3066\u8abf\u6574\u3055\u308c\u307e\u3059\uff1a</p> <pre><code>def _adjusted_price(self, code: str, size=None, price=None) -&gt; float:\n    \"\"\"\n    Long/short `price`, adjusted for spread.\n    In long positions, the adjusted price is a fraction higher, and vice versa.\n    \"\"\"\n    return (price or self.last_price(code)) * (1 + copysign(self._spread, size))\n</code></pre>"},{"location":"execution-logic-report/#_8","title":"\u8abf\u6574\u30ed\u30b8\u30c3\u30af\uff1a","text":"<ol> <li>\u30ed\u30f3\u30b0\u30dd\u30b8\u30b7\u30e7\u30f3\uff1a</li> <li>\u8abf\u6574\u4fa1\u683c = \u7d04\u5b9a\u4fa1\u683c \u00d7 (1 + spread)</li> <li> <p>\u3088\u308a\u9ad8\u3044\u4fa1\u683c\u3067\u8cfc\u5165\uff08\u4e0d\u5229\uff09</p> </li> <li> <p>\u30b7\u30e7\u30fc\u30c8\u30dd\u30b8\u30b7\u30e7\u30f3\uff1a</p> </li> <li>\u8abf\u6574\u4fa1\u683c = \u7d04\u5b9a\u4fa1\u683c \u00d7 (1 - spread)</li> <li>\u3088\u308a\u4f4e\u3044\u4fa1\u683c\u3067\u58f2\u5374\uff08\u4e0d\u5229\uff09</li> </ol>"},{"location":"execution-logic-report/#_9","title":"\u5b9f\u969b\u306e\u7d04\u5b9a\u4fa1\u683c\u306e\u6c7a\u5b9a\u30d5\u30ed\u30fc","text":""},{"location":"execution-logic-report/#1","title":"1. \u57fa\u672c\u7684\u306a\u7d04\u5b9a\u4fa1\u683c\u306e\u6c7a\u5b9a","text":"<pre><code># \u57fa\u672c\u7684\u306a\u7d04\u5b9a\u4fa1\u683c\nif order.limit:\n    # \u6307\u5024\u6ce8\u6587\u306e\u5834\u5408\n    price = (min(stop_price or open, order.limit) if order.is_long else\n             max(stop_price or open, order.limit))\nelse:\n    # \u6210\u884c\u6ce8\u6587\u306e\u5834\u5408\n    prev_close = df.Close.iloc[-2]\n    price = prev_close if self._trade_on_close and not order.is_contingent else open\n</code></pre>"},{"location":"execution-logic-report/#2","title":"2. \u30b9\u30d7\u30ec\u30c3\u30c9\u8abf\u6574","text":"<pre><code># \u30b9\u30d7\u30ec\u30c3\u30c9\u8abf\u6574\nadjusted_price = self._adjusted_price(code=order.code, size=order.size, price=price)\n</code></pre>"},{"location":"execution-logic-report/#3","title":"3. \u624b\u6570\u6599\u8a08\u7b97","text":"<pre><code># \u624b\u6570\u6599\u8a08\u7b97\nadjusted_price_plus_commission = \\\n    adjusted_price + self._commission(order.size, price) / abs(order.size)\n</code></pre>"},{"location":"execution-logic-report/#_10","title":"\u7d04\u5b9a\u4fa1\u683c\u306e\u512a\u5148\u9806\u4f4d","text":""},{"location":"execution-logic-report/#1_1","title":"1. \u6307\u5024\u6ce8\u6587\u306e\u5834\u5408","text":"<ol> <li>\u30b9\u30c8\u30c3\u30d7\u4fa1\u683c\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u5834\u5408\uff1a</li> <li>\u30ed\u30f3\u30b0\uff1a<code>min(\u59cb\u5024, \u6307\u5024\u4fa1\u683c)</code></li> <li> <p>\u30b7\u30e7\u30fc\u30c8\uff1a<code>max(\u59cb\u5024, \u6307\u5024\u4fa1\u683c)</code></p> </li> <li> <p>\u30b9\u30c8\u30c3\u30d7\u4fa1\u683c\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u306a\u3044\u5834\u5408\uff1a</p> </li> <li>\u30ed\u30f3\u30b0\uff1a<code>min(\u59cb\u5024, \u6307\u5024\u4fa1\u683c)</code></li> <li>\u30b7\u30e7\u30fc\u30c8\uff1a<code>max(\u59cb\u5024, \u6307\u5024\u4fa1\u683c)</code></li> </ol>"},{"location":"execution-logic-report/#2_1","title":"2. \u6210\u884c\u6ce8\u6587\u306e\u5834\u5408","text":"<ol> <li><code>trade_on_close=True</code>\u304b\u3064\u6761\u4ef6\u4ed8\u304d\u6ce8\u6587\u3067\u306a\u3044\u5834\u5408\uff1a</li> <li> <p>\u7d04\u5b9a\u4fa1\u683c = \u524d\u306e\u30d0\u30fc\u306e\u7d42\u5024\uff08Close\uff09</p> </li> <li> <p>\u305d\u306e\u4ed6\u306e\u5834\u5408\uff1a</p> </li> <li>\u7d04\u5b9a\u4fa1\u683c = \u73fe\u5728\u306e\u30d0\u30fc\u306e\u59cb\u5024\uff08Open\uff09</li> </ol>"},{"location":"execution-logic-report/#_11","title":"\u91cd\u8981\u306a\u6ce8\u610f\u70b9","text":""},{"location":"execution-logic-report/#1_2","title":"1. \u30c7\u30fc\u30bf\u306e\u53d6\u5f97\u65b9\u6cd5","text":"<pre><code>open, high, low = df.Open.iloc[-1], df.High.iloc[-1], df.Low.iloc[-1]\n</code></pre> <ul> <li><code>iloc[-1]</code>\uff1a\u73fe\u5728\u306e\u30d0\u30fc\uff08\u6700\u65b0\u306e\u30ed\u30fc\u30bd\u30af\u8db3\uff09</li> <li><code>iloc[-2]</code>\uff1a\u524d\u306e\u30d0\u30fc\uff081\u3064\u524d\u306e\u30ed\u30fc\u30bd\u30af\u8db3\uff09</li> </ul>"},{"location":"execution-logic-report/#2_2","title":"2. \u6761\u4ef6\u4ed8\u304d\u6ce8\u6587\u306e\u7279\u5225\u6271\u3044","text":"<pre><code># \u6761\u4ef6\u4ed8\u304d\u6ce8\u6587\u306f\u5e38\u306b\u6b21\u306e\u59cb\u5024\u3067\nprice = prev_close if self._trade_on_close and not order.is_contingent else open\n</code></pre> <p>\u6761\u4ef6\u4ed8\u304d\u6ce8\u6587\uff08SL/TP\uff09\u306f<code>trade_on_close</code>\u306e\u8a2d\u5b9a\u306b\u95a2\u4fc2\u306a\u304f\u3001\u5e38\u306b**Open**\u3067\u7d04\u5b9a\u3055\u308c\u307e\u3059\u3002</p>"},{"location":"execution-logic-report/#3_1","title":"3. \u30b9\u30c8\u30c3\u30d7\u6ce8\u6587\u306e\u5909\u63db","text":"<p>\u30b9\u30c8\u30c3\u30d7\u4fa1\u683c\u306b\u9054\u3059\u308b\u3068\u3001\u30b9\u30c8\u30c3\u30d7\u6ce8\u6587\u306f\u81ea\u52d5\u7684\u306b\u6210\u884c\u6ce8\u6587\u306b\u5909\u63db\u3055\u308c\u307e\u3059\uff1a</p> <pre><code># \u30b9\u30c8\u30c3\u30d7\u4fa1\u683c\u306b\u9054\u3059\u308b\u3068\u3001\u30b9\u30c8\u30c3\u30d7\u6ce8\u6587\u306f\u6210\u884c/\u6307\u5024\u6ce8\u6587\u306b\u306a\u308b\norder._replace(stop_price=None)\n</code></pre>"},{"location":"execution-logic-report/#_12","title":"\u307e\u3068\u3081","text":"<p>BackcastPro\u306b\u304a\u3051\u308b\u7d04\u5b9a\u4fa1\u683c\u306e\u6c7a\u5b9a\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8981\u7d04\u3055\u308c\u307e\u3059\uff1a</p> <ol> <li>\u6210\u884c\u6ce8\u6587\uff1a</li> <li>\u30c7\u30d5\u30a9\u30eb\u30c8\uff1aOpen\uff08\u59cb\u5024\uff09</li> <li> <p><code>trade_on_close=True</code>\uff1aClose\uff08\u524d\u306e\u30d0\u30fc\u306e\u7d42\u5024\uff09</p> </li> <li> <p>\u6307\u5024\u6ce8\u6587\uff1a</p> </li> <li>\u30ed\u30f3\u30b0\uff1a<code>min(\u59cb\u5024, \u6307\u5024\u4fa1\u683c)</code></li> <li> <p>\u30b7\u30e7\u30fc\u30c8\uff1a<code>max(\u59cb\u5024, \u6307\u5024\u4fa1\u683c)</code></p> </li> <li> <p>\u30b9\u30c8\u30c3\u30d7\u6ce8\u6587\uff1a</p> </li> <li> <p>\u6761\u4ef6\u9054\u6210\u5f8c\u306f\u6210\u884c\u6ce8\u6587\u3068\u3057\u3066\u51e6\u7406</p> </li> <li> <p>\u6761\u4ef6\u4ed8\u304d\u6ce8\u6587\uff08SL/TP\uff09\uff1a</p> </li> <li> <p>\u5e38\u306b**Open**\uff08\u59cb\u5024\uff09</p> </li> <li> <p>\u30b9\u30d7\u30ec\u30c3\u30c9\u8abf\u6574\uff1a</p> </li> <li>\u30ed\u30f3\u30b0\uff1a\u7d04\u5b9a\u4fa1\u683c \u00d7 (1 + spread)</li> <li>\u30b7\u30e7\u30fc\u30c8\uff1a\u7d04\u5b9a\u4fa1\u683c \u00d7 (1 - spread)</li> </ol> <p>\u3053\u306e\u30ed\u30b8\u30c3\u30af\u306b\u3088\u308a\u3001\u30ea\u30a2\u30eb\u306a\u53d6\u5f15\u74b0\u5883\u3092\u30b7\u30df\u30e5\u30ec\u30fc\u30c8\u3057\u3001\u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u306e\u7cbe\u5ea6\u3092\u5411\u4e0a\u3055\u305b\u3066\u3044\u307e\u3059\u3002</p>"},{"location":"how-to-deploy-to-PyPI/","title":"PyPI\u30c7\u30d7\u30ed\u30a4","text":""},{"location":"how-to-deploy-to-PyPI/#pypiwindows-uv","title":"PyPI\u3078\u306e\u30c7\u30d7\u30ed\u30a4\u65b9\u6cd5\uff08Windows / uv\uff09","text":"<p>\u8a73\u7d30\u306a\u30ea\u30ea\u30fc\u30b9\u624b\u9806\u306f <code>developer-guide.md</code> \u306e\u300c\u30ea\u30ea\u30fc\u30b9\u30d7\u30ed\u30bb\u30b9\u300d\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u3053\u3053\u3067\u306f\u6700\u5c0f\u624b\u9806\u306e\u307f\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002</p>"},{"location":"how-to-deploy-to-PyPI/#1","title":"1. \u914d\u5e03\u7269\u3092\u30d3\u30eb\u30c9","text":"<pre><code>uv build\n</code></pre>"},{"location":"how-to-deploy-to-PyPI/#2-pypi","title":"2. PyPI\u3078\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9","text":"<pre><code>uv publish\n</code></pre> <pre><code>uv publish --publish-url https://test.pypi.org/legacy/\n</code></pre> <p>\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u6642\u306f PyPI \u306e API \u30c8\u30fc\u30af\u30f3\uff08<code>pypi-</code> \u3067\u59cb\u307e\u308b\u5024\uff09\u3092\u5165\u529b\u3057\u307e\u3059\u3002</p> <p>\u74b0\u5883\u5909\u6570\u3067\u4e8b\u524d\u306b\u8a2d\u5b9a\u3059\u308b\u5834\u5408\uff1a</p> <pre><code>$env:UV_PUBLISH_TOKEN = \"pypi-xxxx...\"\nuv publish\n</code></pre> <p>\u53c2\u8003: - uv build - uv publish - Packaging projects\uff08\u516c\u5f0f\uff09</p>"},{"location":"nautilus-migration-plan/","title":"BackcastPro \u2192 NautilusTrader \u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u30a8\u30f3\u30b8\u30f3\u79fb\u884c","text":""},{"location":"nautilus-migration-plan/#2026-02-22","title":"\u5b9f\u88c5\u72b6\u6cc1\uff082026-02-22 \u66f4\u65b0\uff09","text":"\u30d5\u30a7\u30fc\u30ba \u5185\u5bb9 \u72b6\u614b Phase 0 bridge.py \u30d0\u30b0\u4fee\u6b63 \u2705 \u5b8c\u4e86 Phase 1 nautilus_adapter.py \u5b9f\u88c5 + \u30e6\u30cb\u30c3\u30c8\u30c6\u30b9\u30c8\uff0838/38 \u901a\u904e\uff09 \u2705 \u5b8c\u4e86 Phase 2 \u5404\u30d5\u30a1\u30a4\u30eb\u306e\u30a4\u30f3\u30dd\u30fc\u30c8\u5207\u308a\u66ff\u3048 \u2705 \u5b8c\u4e86 Phase 3 \u7d71\u5408\u30c6\u30b9\u30c8\uff08\u30e6\u30fc\u30b6\u30fc\u306b\u3088\u308b\u30a2\u30d7\u30ea\u52d5\u4f5c\u78ba\u8a8d\uff09 \u23f3 \u672a\u5b9f\u65bd \u8ffd\u52a0\u4f5c\u696d <code>run(strategy, step_callback)</code> API \u8ffd\u52a0 + blacksheep.py \u306e run \u65b9\u5f0f\u79fb\u884c \u26a0\ufe0f \u8981\u78ba\u8a8d\uff08\u5f8c\u8ff0\uff09"},{"location":"nautilus-migration-plan/#tips","title":"\u5b9f\u88c5\u3067\u5224\u660e\u3057\u305f\u77e5\u898b\u30fb\u8a2d\u8a08\u601d\u60f3\u30fbTips","text":""},{"location":"nautilus-migration-plan/#1-ohlc","title":"1. OHLC \u6574\u6570\u4e38\u3081\u554f\u984c\uff08\u5b9f\u88c5\u3067\u521d\u3081\u3066\u767a\u899a\uff09","text":"<p>NautilusTrader \u306e <code>Bar</code> \u306f <code>low &lt;= open</code> \u304b\u3064 <code>low &lt;= close</code> \u3092\u53b3\u683c\u306b\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3059\u308b\u3002 \u65e5\u672c\u682a\u30c7\u30fc\u30bf\u3092\u6574\u6570\u5186\u306b\u4e38\u3081\u308b\u969b\u3001\u4e38\u3081\u8aa4\u5dee\u3067\u5236\u7d04\u304c\u7834\u3089\u308c\u308b\u3053\u3068\u304c\u3042\u308b\u3002</p> <p>\u5bfe\u51e6: <code>ohlcv_to_bars()</code> \u3067\u4e38\u3081\u5f8c\u306b\u5236\u7d04\u3092\u5f37\u5236\u3059\u308b\u3002</p> <pre><code>o = max(1, int(round(float(row[\"Open\"]))))\nh = max(1, int(round(float(row[\"High\"]))))\nlo = max(1, int(round(float(row[\"Low\"]))))\nc = max(1, int(round(float(row[\"Close\"]))))\nh = max(h, o, c)   # High \u306f\u5e38\u306b\u6700\u5927\u5024\nlo = min(lo, o, c) # Low \u306f\u5e38\u306b\u6700\u5c0f\u5024\n</code></pre>"},{"location":"nautilus-migration-plan/#2-equity-poc","title":"2. Equity \u306e\u8a08\u7b97\u65b9\u6cd5\uff08PoC\u7d50\u679c\u901a\u308a\uff09","text":"<p><code>balance_total(JPY)</code> \u306f\u30ad\u30e3\u30c3\u30b7\u30e5\u6b8b\u9ad8**\u306e\u307f**\u3092\u8fd4\u3059\uff08\u30dd\u30b8\u30b7\u30e7\u30f3\u306eMTM\u3092\u542b\u307e\u306a\u3044\uff09\u3002 \u771f\u306e\u30a8\u30af\u30a4\u30c6\u30a3\u306f\u81ea\u524d\u3067\u8a08\u7b97\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\uff1a</p> <pre><code>account = engine.portfolio.account(VENUE)\ncash = float(account.balance_total(JPY).as_decimal())\nfor pos in engine.cache.positions_open():\n    price = current_close_of(pos.instrument_id.symbol.value)\n    cash += float(pos.signed_qty) * price\n</code></pre>"},{"location":"nautilus-migration-plan/#3-commission","title":"3. <code>commission</code> \u306e\u9069\u7528\u65b9\u6cd5","text":"<p><code>MakerTakerFeeModel()</code> \u3092 Venue \u306b\u8a2d\u5b9a\u3057\u3001Equity \u306e <code>maker_fee</code> / <code>taker_fee</code> \u30d5\u30a3\u30fc\u30eb\u30c9\u306b\u624b\u6570\u6599\u7387\uff08Decimal\uff09\u3092\u8a2d\u5b9a\u3059\u308b\u3002</p> <pre><code># add_venue \u6642\nfee_model=MakerTakerFeeModel() if commission &gt; 0 else None\n\n# Equity \u4f5c\u6210\u6642\nmaker_fee=Decimal(str(commission)),\ntaker_fee=Decimal(str(commission)),\n</code></pre> <p>commission=0 \u306e\u5834\u5408\u306f <code>fee_model=None</code>\uff08\u5f15\u6570\u7701\u7565\u3067\u306f\u306a\u304f\u660e\u793a\u7684\u306b None \u3092\u6e21\u3059\uff09\u3002</p>"},{"location":"nautilus-migration-plan/#4-price_precision-price_incrementprecision","title":"4. <code>price_precision</code> \u306f <code>price_increment.precision</code> \u3068\u4e00\u81f4\u3055\u305b\u308b","text":"<p><code>Equity</code> \u521d\u671f\u5316\u6642\u306b <code>price_precision</code> \u3068 <code>price_increment</code> \u306e\u7cbe\u5ea6\u304c\u4e00\u81f4\u3057\u306a\u3044\u3068 <code>ValueError</code> \u306b\u306a\u308b\u3002 \u65e5\u672c\u682a\uff08\u6574\u6570\u5186\uff09\u306e\u5834\u5408\u306f <code>price_precision=0</code>\u3001<code>price_increment=Price.from_str(\"1\")</code>\u3002</p> <pre><code># \u6b63\u3057\u3044\nEquity(price_precision=0, price_increment=Price.from_str(\"1\"), ...)\n\n# NG: precision=1 \u3060\u304c increment \u306f\u6574\u6570\nEquity(price_precision=1, price_increment=Price.from_str(\"1\"), ...)  # ValueError\n</code></pre>"},{"location":"nautilus-migration-plan/#5-strategyconfig-order_id_tag","title":"5. <code>StrategyConfig</code> \u306e <code>order_id_tag</code> \u306f\u5fc5\u9808","text":"<p><code>Strategy</code> \u30b5\u30d6\u30af\u30e9\u30b9\u3092\u4f5c\u308b\u969b\u3001<code>StrategyConfig</code> \u306b <code>order_id_tag</code> \u3092\u8a2d\u5b9a\u3057\u306a\u3044\u3068 \u30a8\u30f3\u30b8\u30f3\u304c\u30b9\u30c8\u30e9\u30c6\u30b8\u30fc\u3092\u8b58\u5225\u3067\u304d\u306a\u3044\u3002</p> <pre><code>class _InteractiveStrategyConfig(StrategyConfig, frozen=True):\n    pass\n\nsuper().__init__(_InteractiveStrategyConfig(order_id_tag=\"001\"))\n</code></pre>"},{"location":"nautilus-migration-plan/#6-goto","title":"6. <code>goto()</code> \u3067\u306e\u6226\u7565\u30b9\u30ad\u30c3\u30d7","text":"<p><code>goto()</code> \u4e2d\u306f <code>_strategy_fn = None</code> \u306b\u3057\u3066\u9ad8\u901f\u5b9f\u884c\u3059\u308b\u8a2d\u8a08\u3002 \u3053\u308c\u306b\u3088\u308a SMA \u7b49\u306e\u8a08\u7b97\u304c\u8d70\u3089\u305a goto \u304c\u30d5\u30ec\u30fc\u30e0\u5358\u4f4d\u3067\u901f\u304f\u306a\u308b\u3002 \u305f\u3060\u3057**\u6226\u7565\u304c\u7d2f\u7a4d\u72b6\u614b\u3092\u6301\u3064\u5834\u5408**\uff08\u4f8b: \u5b66\u7fd2\u7cfb\u30e2\u30c7\u30eb\uff09\u306f\u6ce8\u610f\u304c\u5fc5\u8981\u3002</p> <pre><code>def goto(self, step, strategy=None):\n    ...\n    saved_fn = self._strategy_fn\n    self._strategy_fn = None  # goto \u4e2d\u306f\u6226\u7565\u3092\u30b9\u30ad\u30c3\u30d7\n    try:\n        while self._step_index &lt; step and not self._is_finished:\n            self.step()\n    finally:\n        self._strategy_fn = saved_fn  # \u5fc5\u305a\u5fa9\u5143\n</code></pre>"},{"location":"nautilus-migration-plan/#7-bankrupterror","title":"7. <code>BankruptError</code> \u306e\u6319\u52d5\u306e\u5909\u66f4\u70b9","text":"<p>BackcastPro \u306e <code>step()</code> \u306f\u5185\u90e8\u3067 <code>BankruptError</code> \u3092 catch \u3057\u3066 False \u3092\u8fd4\u3059\uff08re-raise \u3057\u306a\u3044\uff09\u3002 NautilusBacktest \u3067\u306f game_setup.py \u306e catch \u30d6\u30ed\u30c3\u30af\u3092\u6d3b\u304b\u3059\u305f\u3081 raise \u3059\u308b \u8a2d\u8a08\u306b\u5909\u66f4\u3057\u305f\u3002</p> <pre><code># NautilusBacktest.step() \u306e\u672b\u5c3e\nif self.equity &lt;= 0:\n    self._is_finished = True\n    raise BankruptError(...)  # BackcastPro\u3068\u9055\u3044\u3001re-raise\u3059\u308b\n</code></pre> <p>game_setup.py \u306e <code>step()</code> \u304c\u3053\u308c\u3092 catch \u3057\u3066 <code>FAIL_003</code> \u30b9\u30ad\u30eb\u3092\u767a\u706b\u3055\u305b\u308b\uff08\u65e2\u5b58\u52d5\u4f5c\u3092\u7dad\u6301\uff09\u3002</p>"},{"location":"nautilus-migration-plan/#8","title":"8. \u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u306e\u6ce8\u610f\u70b9","text":"<p>\u5408\u6210\u30c7\u30fc\u30bf\u3067 <code>pd.date_range(..., freq=\"B\")</code> \uff08\u55b6\u696d\u65e5\uff09\u3092\u4f7f\u3046\u70b9\u306b\u6ce8\u610f\u3002 <code>freq=\"D\"</code> \u306b\u3059\u308b\u3068\u571f\u65e5\u304c\u542b\u307e\u308c\u3001\u5b9f\u969b\u306e\u682a\u4fa1\u30c7\u30fc\u30bf\u3068\u306e\u6319\u52d5\u5dee\u304c\u51fa\u3084\u3059\u3044\u3002</p>"},{"location":"nautilus-migration-plan/#9-run-api-strategy-step_callback-2026-02-22","title":"9. <code>run()</code> \u306e API \u62e1\u5f35 \u2014 <code>strategy</code> \u3068 <code>step_callback</code> \u5f15\u6570\uff082026-02-22 \u8ffd\u52a0\uff09","text":"<p>NautilusTrader \u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u306e\u300cstrategy \u3092\u767b\u9332\u3057\u3066 <code>engine.run()</code> \u30921\u56de\u547c\u3076\u300d\u65b9\u5f0f\u306b\u5408\u308f\u305b\u308b\u305f\u3081\u3001 <code>NautilusBacktest.run()</code> \u306b2\u3064\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u5f15\u6570\u3092\u8ffd\u52a0\u3057\u305f\u3002</p> <pre><code># nautilus_adapter.py \u2014 \u5909\u66f4\u5f8c\u306e run()\ndef run(self, strategy=None, step_callback=None) -&gt; pd.Series:\n    \"\"\"\u5168\u30d0\u30fc\u3092\u5b9f\u884c\u3057\u3066\u7d71\u8a08\u3092\u8fd4\u3059\"\"\"\n    if strategy is not None:\n        self.set_strategy(strategy)\n    while not self._is_finished:\n        self.step()\n        if step_callback is not None:\n            step_callback(self)\n    return self.finalize()\n</code></pre> <p>\u8a2d\u8a08\u30dd\u30a4\u30f3\u30c8: - <code>strategy</code> \u3092\u6e21\u3059\u3068 <code>set_strategy()</code> \u3092\u5185\u90e8\u3067\u547c\u3076 \u2192 \u547c\u3073\u51fa\u3057\u5074\u3067\u5225\u9014 <code>set_strategy()</code> \u4e0d\u8981 - <code>step_callback</code> \u306f <code>step()</code> \u5b8c\u4e86\u5f8c\uff08\u6ce8\u6587\u57f7\u884c\u6e08\u307f\uff09\u306b\u547c\u3070\u308c\u308b \u2192 \u30c1\u30e3\u30fc\u30c8\u66f4\u65b0\u30bf\u30a4\u30df\u30f3\u30b0\u304c\u65e7\u30eb\u30fc\u30d7\u3068\u540c\u4e00 - \u65e2\u5b58\u306e <code>run()</code> \u3068\u306e\u5f8c\u65b9\u4e92\u63db\u6027\u3042\u308a\uff08\u5f15\u6570\u306a\u3057\u3067\u547c\u3079\u3070\u5f93\u6765\u901a\u308a\u52d5\u4f5c\uff09</p> <p>blacksheep.py \u3067\u306e\u4f7f\u7528\u4f8b: <pre><code>def strategy(bt):\n    _df = bt.data[code]\n    if len(_df) &lt; long_window + 1:\n        return\n    sma_short = _df.Close.rolling(short_window).mean()\n    sma_long  = _df.Close.rolling(long_window).mean()\n    prev_short, curr_short = sma_short.iloc[-2], sma_short.iloc[-1]\n    prev_long,  curr_long  = sma_long.iloc[-2],  sma_long.iloc[-1]\n    pos = bt.position_of(code)\n    if prev_short &lt;= prev_long and curr_short &gt; curr_long and pos == 0:\n        bt.buy(code=code)\n    elif prev_short &gt;= prev_long and curr_short &lt; curr_long and pos &gt; 0:\n        bt.sell(code=code, size=pos)\n\ntry:\n    bt.run(strategy=strategy, step_callback=update_all_backtest_charts)\nexcept BankruptError:\n    update_all_backtest_charts(bt)\n</code></pre></p> <p>\u65e7\u65b9\u5f0f <code>for i in range(200): if not bt.step(): break</code> \u3068\u306e\u6bd4\u8f03\uff1a</p> \u9805\u76ee \u65e7\u30eb\u30fc\u30d7\u65b9\u5f0f run \u65b9\u5f0f \u6700\u5927\u30b9\u30c6\u30c3\u30d7 200\u56de \u5168\u30c7\u30fc\u30bf\u6d88\u8cbb\u307e\u3067\uff08\u4e0a\u9650\u306a\u3057\uff09 \u6226\u7565\u306e\u4f4d\u7f6e \u30eb\u30fc\u30d7\u5185\u30a4\u30f3\u30e9\u30a4\u30f3 <code>strategy()</code> \u95a2\u6570\u3068\u3057\u3066\u5206\u96e2 \u30c1\u30e3\u30fc\u30c8\u66f4\u65b0 <code>step()</code> \u5f8c\u306b\u660e\u793a\u547c\u3073\u51fa\u3057 <code>step_callback</code> \u3067\u81ea\u52d5\u547c\u3073\u51fa\u3057 BankruptError \u30eb\u30fc\u30d7\u306e try/except <code>run()</code> \u306e try/except"},{"location":"nautilus-migration-plan/#10-marimo-nautilus_adapterpy","title":"10. \u26a0\ufe0f marimo \u30ce\u30fc\u30c8\u30d6\u30c3\u30af\u304c\u8aad\u3080 <code>nautilus_adapter.py</code> \u306e\u5834\u6240\u554f\u984c","text":"<p><code>blacksheep.py</code>\uff08<code>C:\\Users\\sasai\\AppData\\Roaming\\marimo\\notebooks\\</code>\uff09\u3067\u5b9f\u884c\u6642\u306b\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u305f\uff1a</p> <pre><code>TypeError: NautilusBacktest.run() got an unexpected keyword argument 'strategy'\n</code></pre> <p>\u7de8\u96c6\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u306f <code>C:\\Users\\sasai\\Documents\\marimo\\src-tauri\\resources\\files\\nautilus_adapter.py</code> \u3060\u304c\u3001 marimo \u30ce\u30fc\u30c8\u30d6\u30c3\u30af\u304c \u5225\u306e\u5834\u6240\u306e <code>nautilus_adapter.py</code> \u3092 import \u3057\u3066\u3044\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u3002</p> <p>\u8abf\u67fb\u3059\u3079\u304d\u5834\u6240: - <code>C:\\Users\\sasai\\AppData\\Roaming\\marimo\\notebooks\\nautilus_adapter.py</code>\uff08\u30ce\u30fc\u30c8\u30d6\u30c3\u30af\u3068\u540c\u3058\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\uff09 - Python \u306e <code>sys.path</code> \u306b\u542b\u307e\u308c\u308b\u3069\u3053\u304b</p> <p>[!IMPORTANT] <code>nautilus_adapter.py</code> \u306e\u7de8\u96c6\u5f8c\u306f\u30ce\u30fc\u30c8\u30d6\u30c3\u30af\u5074\u306e Python \u30d7\u30ed\u30bb\u30b9\u3092\u518d\u8d77\u52d5\u3057\u306a\u3044\u3068\u5909\u66f4\u304c\u53cd\u6620\u3055\u308c\u306a\u3044\u5834\u5408\u304c\u3042\u308b\uff08Python \u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u30ad\u30e3\u30c3\u30b7\u30e5\uff09\u3002 marimo \u306e\u5834\u5408\u306f <code>mo.restart_kernel()</code> \u307e\u305f\u306f\u30b5\u30fc\u30d0\u30fc\u518d\u8d77\u52d5\u304c\u5fc5\u8981\u3002 \u307e\u305f\u3001**\u30ce\u30fc\u30c8\u30d6\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u3068\u540c\u3058\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b <code>nautilus_adapter.py</code> \u304c\u5b58\u5728\u3059\u308b\u5834\u5408\u3001\u305d\u3061\u3089\u304c\u512a\u5148\u3055\u308c\u308b**\u305f\u3081\u3001 \u8907\u6570\u306e\u5834\u6240\u306b\u540c\u540d\u30d5\u30a1\u30a4\u30eb\u304c\u5b58\u5728\u3057\u306a\u3044\u304b\u78ba\u8a8d\u3059\u308b\u3053\u3068\u3002</p> <p>BackcastPro\u306e\u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u30a8\u30f3\u30b8\u30f3\u3092NautilusTrader\u306b\u7f6e\u304d\u63db\u3048\u308b\u3002\u30c7\u30fc\u30bf\u53d6\u5f97\u90e8\u5206\uff08get_stock_daily\u7b49\uff09\u306fBackcastPro\u3092\u7d99\u7d9a\u5229\u7528\u3002\u30b2\u30fc\u30e0UI\uff08<code>bt.step()</code>, <code>bt.buy()</code>, <code>bt.chart()</code>\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\uff09\u306f\u7dad\u6301\u3059\u308b\u3002</p>"},{"location":"nautilus-migration-plan/#poc","title":"PoC \u691c\u8a3c\u7d50\u679c","text":"<p>[!NOTE] poc_result.md \u30673\u65b9\u5f0f\u3092\u5b9f\u6a5f\u691c\u8a3c\u6e08\u307f\uff08nautilus_trader 1.221.0\uff09\u3002</p> \u65b9\u5f0f \u5185\u5bb9 \u7d50\u679c A: <code>run(start=ts, end=ts)</code> start/end \u30d5\u30a3\u30eb\u30bf\u30671\u30d0\u30fc\u5b9f\u884c \u274c Strategy \u304c step 2 \u4ee5\u964d\u306e\u30d0\u30fc\u3092\u53d7\u3051\u53d6\u3089\u306a\u3044 B: streaming 1\u30d0\u30fc\u305a\u3064 <code>add_data</code> \u2192 <code>run(streaming=True)</code> \u2192 <code>clear_data</code> \u30b5\u30a4\u30af\u30eb \u2705 \u63a1\u7528 C: event-driven callback \u5168\u30c7\u30fc\u30bf\u767b\u9332\u5f8c <code>run()</code> 1\u56de\u3001Strategy \u3067\u30b3\u30fc\u30eb\u30d0\u30c3\u30af \u2705 \uff08\u5c06\u6765\u5019\u88dc\uff09 <p>\u63a1\u7528\u65b9\u5f0f: B\uff08streaming 1\u30d0\u30fc\u305a\u3064\uff09</p> <pre><code>step() \u3054\u3068\u306b:\n  1. _current_data \u3092\u73fe\u5728\u30d0\u30fc\u307e\u3067\u66f4\u65b0\n  2. strategy_fn(self) \u3092\u547c\u3076\uff08\u73fe\u5728\u30d0\u30fc\u304c\u898b\u3048\u308b\u72b6\u614b\uff09\n  3. engine.add_data([bar])\n  4. engine.run(streaming=True)  \u2190 \u6700\u7d42\u30d0\u30fc\u306e\u307f streaming=False\n     \u2514\u2500 on_bar() \u304c\u767a\u706b \u2192 \u6ce8\u6587\u30ad\u30e5\u30fc\u3092\u30d5\u30e9\u30c3\u30b7\u30e5\n  5. engine.clear_data()\n  6. self._step_index += 1\n</code></pre> <p>[!IMPORTANT] NautilusTrader\u306b\u306f**\u30b9\u30c6\u30c3\u30d7\u5b9f\u884cAPI\uff08step()\uff09\u304c\u5b58\u5728\u3057\u307e\u305b\u3093**\u3002 \u672c\u8a08\u753b\u3067\u306f**streaming \u30e2\u30fc\u30c9\u30671\u30d0\u30fc\u305a\u3064\u30c7\u30fc\u30bf\u3092\u8ffd\u52a0\u3057\u3066 <code>run()</code> \u3092\u547c\u3076\u3053\u3068\u3067\u30b9\u30c6\u30c3\u30d7\u5b9f\u884c\u3092\u30a8\u30df\u30e5\u30ec\u30fc\u30c8**\u3059\u308b\u30a2\u30c0\u30d7\u30bf\u30fc\u5c64\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002</p> <p>[!WARNING] NautilusTrader\u306fRust/Cython\u30d9\u30fc\u30b9\u306e\u9ad8\u6027\u80fd\u30a8\u30f3\u30b8\u30f3\u3067\u3001Pyodide\uff08WASM\uff09\u74b0\u5883\u3067\u306f\u52d5\u4f5c\u3057\u307e\u305b\u3093\u3002 pyodide.py \u3068 wasm-intro.py \u306f BackcastPro \u306e\u307e\u307e\u306b\u3059\u308b\u304b\u3001\u5225\u9014\u5bfe\u5fdc\u304c\u5fc5\u8981\u3067\u3059\u3002</p>"},{"location":"nautilus-migration-plan/#proposed-changes","title":"Proposed Changes","text":""},{"location":"nautilus-migration-plan/#nautilustrader","title":"NautilusTrader \u30a2\u30c0\u30d7\u30bf\u30fc\u5c64\uff08\u65b0\u898f\u4f5c\u6210\uff09","text":"<p>NautilusTrader\u306e<code>BacktestEngine</code>\u3092\u30e9\u30c3\u30d7\u3057\u3001\u65e2\u5b58\u306e\u30b2\u30fc\u30e0\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3068\u540c\u3058API\uff08step(), buy(), sell(), equity, trades\u7b49\uff09\u3092\u63d0\u4f9b\u3059\u308b\u3002</p>"},{"location":"nautilus-migration-plan/#new-nautilus_adapterpy","title":"[NEW] nautilus_adapter.py","text":"<p>NautilusTrader \u2194 \u30b2\u30fc\u30e0UI\u306e\u30d6\u30ea\u30c3\u30b8\u3002\u4ee5\u4e0b\u306e\u30af\u30e9\u30b9\u3092\u542b\u3080\uff1a</p>"},{"location":"nautilus-migration-plan/#nautilusbacktest-backcastprobacktest-api","title":"<code>NautilusBacktest</code> \u30af\u30e9\u30b9 \u2014 BackcastPro.Backtest \u3068\u306e\u5b8c\u5168API\u4e92\u63db\u8868","text":"BackcastPro \u30e1\u30bd\u30c3\u30c9/\u30d7\u30ed\u30d1\u30c6\u30a3 NautilusBacktest \u3067\u306e\u5b9f\u88c5\u65b9\u6cd5 <code>__init__(data, cash, commission, ...)</code> BacktestEngine \u521d\u671f\u5316\u3001Venue\u30fbInstrument \u8a2d\u5b9a\uff08\u4e0b\u8a18\u30d1\u30e9\u30e1\u30fc\u30bf\u8868\u53c2\u7167\uff09 <code>set_data(dct)</code> OHLCV DataFrame \u2192 Bar \u30ea\u30b9\u30c8\u306b\u5909\u63db\u3001<code>_all_bars_by_ts</code> \u3068\u3057\u3066\u4fdd\u6301\u3002\u5b8c\u4e86\u5f8c <code>start()</code> \u3092\u81ea\u52d5\u547c\u3073\u51fa\u3057\uff08BackcastPro\u4e92\u63db\uff09 <code>set_cash(cash)</code> <code>_initial_cash</code> \u3092\u66f4\u65b0\u3001\u6b21\u306e <code>start()</code> \u3067\u53cd\u6620 <code>set_strategy(fn)</code> <code>_strategy_fn</code> \u306b\u683c\u7d0d\uff08<code>step()</code> \u5185\u3067 <code>_current_data</code> \u66f4\u65b0\u5f8c\u306b\u547c\u3073\u51fa\u3059\uff09 <code>start()</code> \u30a8\u30f3\u30b8\u30f3\u521d\u671f\u5316\u3001<code>_step_index = 0</code>\u3001<code>_is_finished = False</code> <code>reset()</code> <code>engine.reset()</code> \u2192 <code>_step_index = 0</code>\u3001<code>_is_finished = False</code> <code>step() \u2192 bool</code> streaming 1\u30d0\u30fc\u30b5\u30a4\u30af\u30eb\u5b9f\u884c\uff08\u8a73\u7d30\u4e0b\u8a18\uff09 <code>goto(step, strategy)</code> <code>step &lt; _step_index</code> \u306a\u3089 <code>reset()</code> \u3057\u3066\u304b\u3089 <code>step()</code> \u3092\u7e70\u308a\u8fd4\u3059 <code>run() \u2192 pd.Series</code> \u5168\u30d0\u30fc <code>step()</code> \u2192 <code>finalize()</code> <code>finalize() \u2192 pd.Series</code> <code>engine.get_result()</code> \u304b\u3089\u7d71\u8a08\u3092\u751f\u6210 <code>buy(code, size, limit, stop, sl, tp, tag)</code> \u6ce8\u6587\u30ad\u30e5\u30fc\u306b\u8ffd\u52a0\u3001\u6b21\u306e <code>on_bar()</code> \u3067 <code>submit_order()</code> <code>sell(code, size, limit, stop, sl, tp, tag)</code> \u58f2\u308a\u6ce8\u6587\u30ad\u30e5\u30fc\u306b\u8ffd\u52a0\u3001\u6b21\u306e <code>on_bar()</code> \u3067 <code>submit_order()</code> <code>equity</code> (property) <code>cash + \u03a3(open_pos.signed_qty \u00d7 current_close)</code> <code>cash</code> (property) <code>account.balance_free(JPY).as_decimal()</code> <code>trades</code> (property) open positions \u2192 <code>TradeCompat</code> \u30ea\u30b9\u30c8 <code>closed_trades</code> (property) closed positions \u2192 <code>TradeCompat</code> \u30ea\u30b9\u30c8 <code>orders</code> (property) open orders \u2192 <code>OrderCompat</code> \u30ea\u30b9\u30c8 <code>position</code> (property) <code>Position._empty()</code> \u4e92\u63db\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\uff08\u5f8c\u65b9\u4e92\u63db\uff09 <code>position_of(code)</code> <code>cache.positions_open()</code> \u304b\u3089\u9298\u67c4\u5225\u306b\u96c6\u8a08 <code>data</code> (property) <code>_current_data</code>\uff08\u73fe\u5728\u30b9\u30c6\u30c3\u30d7\u307e\u3067\u306e\u30b9\u30e9\u30a4\u30b9\u6e08\u307f DataFrame\uff09 <code>current_time</code> (property) <code>_all_timestamps[_step_index - 1]</code> <code>progress</code> (property) <code>_step_index / len(_all_timestamps)</code> <code>step_index</code> (property) <code>_step_index</code>\uff08read-only\uff09 <code>is_finished</code> (property) <code>_is_finished</code> <code>get_state_snapshot()</code> \u8f9e\u66f8\u5f62\u5f0f\u3067\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u3092\u8fd4\u3059 <code>add_trade_callback(cb)</code> <code>_trade_callbacks</code> \u30ea\u30b9\u30c8\u306b\u8ffd\u52a0 <code>_chart_state</code> <code>Backtest_Wrapper</code> \u304c\u8a2d\u5b9a\u3059\u308b\u5c5e\u6027\u3002<code>NautilusBacktest</code> \u306f <code>__dict__</code> \u3067\u52d5\u7684\u306b\u53d7\u3051\u4ed8\u3051\u308b <p><code>__init__</code> \u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u5b9f\u88c5\u65b9\u91dd\uff08Phase 1\uff09:</p> \u30d1\u30e9\u30e1\u30fc\u30bf Phase 1 \u306e\u6271\u3044 <code>cash</code> Venue \u306e\u521d\u671f\u6b8b\u9ad8\u3068\u3057\u3066\u8a2d\u5b9a <code>commission</code> <code>FeeModel</code> \u3068\u3057\u3066\u8a2d\u5b9a\uff08float \u306e\u307f\u5bfe\u5fdc\u3001callable \u306f Phase 2 \u4ee5\u964d\uff09 <code>spread</code> <code>0.0</code> \u56fa\u5b9a\uff08Phase 1 \u3067\u306f\u672a\u5b9f\u88c5\uff09 <code>margin</code> <code>1.0</code> \u56fa\u5b9a\uff08\u30ec\u30d0\u30ec\u30c3\u30b8\u306a\u3057\u3001Phase 1 \u3067\u306f\u672a\u5b9f\u88c5\uff09 <code>trade_on_close</code> <code>False</code> \u56fa\u5b9a\uff08\u6b21\u30d0\u30fc\u59cb\u5024\u7d04\u5b9a\u3001Phase 1 \u3067\u306f\u672a\u5b9f\u88c5\uff09 <code>exclusive_orders</code> <code>False</code> \u56fa\u5b9a\uff08Phase 1 \u3067\u306f\u672a\u5b9f\u88c5\uff09 <code>finalize_trades</code> <code>True</code> \u56fa\u5b9a\uff08Phase 1 \u3067\u306f\u5168\u30aa\u30fc\u30d7\u30f3\u53d6\u5f15\u3092\u7d42\u5024\u3067\u30af\u30ed\u30fc\u30ba\uff09 <p>[!NOTE] <code>spread</code>, <code>margin</code>, <code>trade_on_close</code>, <code>exclusive_orders</code> \u306f\u73fe\u5728\u306e\u30b2\u30fc\u30e0UI\u3067\u306f\u4f7f\u7528\u3055\u308c\u3066\u3044\u306a\u3044\u305f\u3081\u3001Phase 1 \u3067\u306f\u56fa\u5b9a\u5024\u3067\u30b9\u30bf\u30d6\u3059\u308b\u3002</p> <p><code>step()</code> \u306e\u8a73\u7d30\u30d5\u30ed\u30fc: <pre><code>def step(self) -&gt; bool:\n    if self._is_finished:\n        return False\n    # 1. _current_data \u3092\u73fe\u5728\u30d0\u30fc\u307e\u3067\u66f4\u65b0\uff08\u6226\u7565\u304c\u73fe\u5728\u30d0\u30fc\u3092\u898b\u3048\u308b\u72b6\u614b\u306b\u3059\u308b\uff09\n    self._update_current_data()  # _bars_flat[_step_index] \u306e\u5024\u3092 _current_data \u306b\u53cd\u6620\n    # 2. \u6226\u7565\u95a2\u6570\u3092\u547c\u3076\uff08BackcastPro \u4e92\u63db: \u73fe\u5728\u30d0\u30fc\u306e\u30c7\u30fc\u30bf\u3067\u5224\u65ad\uff09\n    if self._strategy_fn:\n        self._strategy_fn(self)\n    # 3. streaming \u30b5\u30a4\u30af\u30eb\uff08\u6ce8\u6587\u30ad\u30e5\u30fc\u306f on_bar() \u3067\u30d5\u30e9\u30c3\u30b7\u30e5\uff09\n    bar = self._bars_flat[self._step_index]\n    self._engine.add_data([bar])\n    is_last = (self._step_index == len(self._bars_flat) - 1)\n    self._engine.run(streaming=not is_last)\n    self._engine.clear_data()\n    self._step_index += 1\n    if is_last:\n        self._is_finished = True\n    return not self._is_finished\n</code></pre></p> <p>[!CAUTION] <code>_update_current_data()</code> \u306f\u5fc5\u305a\u6226\u7565\u547c\u3073\u51fa\u3057\u306e\u524d\u306b\u884c\u3046\u3053\u3068\u3002 BackcastPro \u306e <code>step()</code> \u306f\u300c\u73fe\u5728\u30d0\u30fc\u306e\u30b9\u30e9\u30a4\u30b9\u66f4\u65b0 \u2192 \u6226\u7565\u547c\u3073\u51fa\u3057 \u2192 \u30d6\u30ed\u30fc\u30ab\u30fc\u51e6\u7406\u300d\u306e\u9806\u3002 NautilusBacktest \u3067\u3053\u306e\u9806\u5e8f\u3092\u9006\u306b\u3059\u308b\u3068\u3001\u6226\u7565\u304c1\u30b9\u30c6\u30c3\u30d7\u53e4\u3044\u30c7\u30fc\u30bf\u3067\u5224\u65ad\u3059\u308b\u3053\u3068\u306b\u306a\u308a\u3001 SMA\u7b49\u306e\u30a4\u30f3\u30b8\u30b1\u30fc\u30bf\u30fc\u304c1\u30d0\u30fc\u305a\u308c\u308b\u3002</p>"},{"location":"nautilus-migration-plan/#interactivestrategy-nautilustrader-strategy","title":"<code>InteractiveStrategy</code> \u30af\u30e9\u30b9 \u2014 NautilusTrader \u306e <code>Strategy</code> \u3092\u7d99\u627f","text":"<ul> <li><code>on_bar()</code> \u3067\u30e6\u30fc\u30b6\u30fc\u304b\u3089\u306e\u6ce8\u6587\u30ad\u30e5\u30fc\u3092\u30d5\u30e9\u30c3\u30b7\u30e5\uff08<code>submit_order()</code> \u3092\u547c\u3073\u51fa\u3059\u306e\u307f\uff09</li> <li><code>on_order_filled()</code> \u3067 <code>_trade_callbacks</code> \u3092\u547c\u3073\u51fa\u3057</li> <li>\u6226\u7565\u30ed\u30b8\u30c3\u30af\u81ea\u4f53\u306f <code>NautilusBacktest.step()</code> \u304c\u547c\u3076 <code>_strategy_fn</code> \u306b\u59d4\u8b72\u3059\u308b\u305f\u3081\u3001<code>on_bar()</code> \u306e\u8cac\u52d9\u306f\u300c\u6ce8\u6587\u306e\u30d5\u30e9\u30c3\u30b7\u30e5\u300d\u306e\u307f</li> </ul>"},{"location":"nautilus-migration-plan/#tradecompat-trade","title":"<code>TradeCompat</code> \u30af\u30e9\u30b9 \u2014 Trade \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u4e92\u63db\u5c64","text":"<p>BackcastPro \u306e <code>Trade</code> \u3068\u540c\u3058\u30d7\u30ed\u30d1\u30c6\u30a3/\u30e1\u30bd\u30c3\u30c9\u3092\u63d0\u4f9b\u3059\u308b:</p> BackcastPro <code>Trade</code> <code>TradeCompat</code> \u306e\u5b9f\u88c5 <code>trade.code</code> <code>position.instrument_id.symbol.value</code> <code>trade.size</code> <code>int(position.signed_qty)</code> <code>trade.entry_price</code> <code>float(position.avg_px_open)</code> <code>trade.pl</code> <code>float(position.unrealized_pnl(...).as_decimal())</code> <code>trade.close()</code> \u58f2\u308a\u6ce8\u6587\u30ad\u30e5\u30fc\u306b\u8ffd\u52a0\u3057\u3066\u6b21\u306e <code>on_bar()</code> \u3067\u7d04\u5b9a"},{"location":"nautilus-migration-plan/#_1","title":"\u305d\u306e\u4ed6\u30d8\u30eb\u30d1\u30fc\u30fb\u4f8b\u5916\u30af\u30e9\u30b9","text":"<ul> <li><code>create_jpx_equity(code, venue)</code>: \u65e5\u672c\u682a\u306eEquity\u30a4\u30f3\u30b9\u30c8\u30a5\u30eb\u30e1\u30f3\u30c8\u3092\u751f\u6210</li> <li><code>ohlcv_to_bars(df, instrument)</code>: BackcastPro\u306eDataFrame \u2192 NautilusTrader \u306e Bar \u30ea\u30b9\u30c8\u306b\u5909\u63db</li> <li><code>BankruptError</code>: \u4e92\u63db\u6027\u7528\uff08equity &lt;= 0 \u691c\u77e5\u6642\u306b raise\uff09</li> </ul>"},{"location":"nautilus-migration-plan/#_2","title":"\u65e2\u5b58\u30d5\u30a1\u30a4\u30eb\u4fee\u6b63","text":""},{"location":"nautilus-migration-plan/#bugfix-bridgepy-phase-0-nautilustrader","title":"[BUGFIX] bridge.py \u2014 Phase 0 \u3067\u5148\u884c\u4fee\u6b63\uff08NautilusTrader\u79fb\u884c\u3068\u72ec\u7acb\uff09","text":"<p>bridge.py \u306b\u306f NautilusTrader \u79fb\u884c\u3068\u306f\u7121\u95a2\u4fc2\u306e\u65e2\u5b58\u30d0\u30b0\u304c3\u3064\u3042\u308b\u3002Phase 0 \u3068\u3057\u3066\u5148\u306b\u4fee\u6b63\u3059\u308b\u3002</p> <p>\u30d0\u30b01: <code>Backtest</code> \u3092\u76f4\u63a5\u4f7f\u3063\u3066\u3044\u308b\u304c <code>color_theme</code> \u5f15\u6570\u304c\u5b58\u5728\u3057\u306a\u3044\uff08<code>TypeError</code>\uff09 <pre><code>-from BackcastPro import Backtest, get_stock_daily\n+from backtest_wrapper import Backtest_Wrapper as Backtest\n+from BackcastPro import get_stock_daily\n</code></pre> <pre><code>-bt = Backtest(\n-    cash=100_000,\n-    commission=0.001,\n-    finalize_trades=True,\n-    color_theme=\"light\",\n-)\n+bt = Backtest(\n+    cash=100_000,\n+    commission=0.001,\n+    finalize_trades=True,\n+    color_theme=\"light\",\n+)\n</code></pre> \uff08<code>Backtest_Wrapper</code> \u306b\u5909\u66f4\u3059\u308b\u3053\u3068\u3067 <code>color_theme</code> \u3068 <code>_chart_state</code> \u304c\u6b63\u3057\u304f\u6271\u308f\u308c\u308b\uff09</p> <p>\u30d0\u30b02: <code>bt._chart_state.reset()</code> \u304c <code>AttributeError</code>\uff08<code>Backtest</code> \u306b\u306f <code>_chart_state</code> \u304c\u306a\u3044\uff09 \u2192 \u30d0\u30b01\u306e\u4fee\u6b63\uff08<code>Backtest_Wrapper</code> \u4f7f\u7528\uff09\u3067\u81ea\u52d5\u7684\u306b\u89e3\u6d88\u3002</p> <p>\u30d0\u30b03: <code>bt.trades()</code> \u3092 callable \u3068\u3057\u3066\u547c\u3093\u3067\u3044\u308b\u304c <code>@property</code> <pre><code>-    for trade in bt.trades():\n+    for trade in bt.trades:\n</code></pre></p>"},{"location":"nautilus-migration-plan/#modify-backtest_wrapperpy-phase-2","title":"[MODIFY] backtest_wrapper.py \u2014 Phase 2","text":"<pre><code>-from BackcastPro import Backtest, get_stock_daily as _get_stock_daily\n+from nautilus_adapter import NautilusBacktest as Backtest\n</code></pre> <p><code>Backtest_Wrapper</code> \u306f <code>NautilusBacktest</code> \u3092\u7d99\u627f\u3059\u308b\u5f62\u306b\u5909\u66f4\u3002<code>_ChartState</code> \u306f\u305d\u306e\u307e\u307e\u7dad\u6301\u3002 <code>_chart_state</code> \u306f\u52d5\u7684\u5c5e\u6027\u3068\u3057\u3066 <code>NautilusBacktest</code> \u5074\u3067\u900f\u904e\u7684\u306b\u6271\u308f\u308c\u308b\u3002</p>"},{"location":"nautilus-migration-plan/#modify-game_setuppy-phase-2","title":"[MODIFY] game_setup.py \u2014 Phase 2","text":"<pre><code>-from BackcastPro import get_stock_daily as _get_stock_daily, BankruptError\n+from BackcastPro import get_stock_daily as _get_stock_daily\n+from nautilus_adapter import BankruptError\n</code></pre> <p>\u30c7\u30fc\u30bf\u53d6\u5f97\uff08<code>_get_stock_daily</code>\uff09\u306fBackcastPro\u3092\u7dad\u6301\u3002<code>BankruptError</code> \u306f\u65b0\u30a2\u30c0\u30d7\u30bf\u30fc\u304b\u3089\u3002</p>"},{"location":"nautilus-migration-plan/#modify-bridgepy-phase-2","title":"[MODIFY] bridge.py \u2014 Phase 2","text":"<pre><code>-from backtest_wrapper import Backtest_Wrapper as Backtest\n+from backtest_wrapper import Backtest_Wrapper as Backtest  # \u5909\u66f4\u306a\u3057\uff08Phase 0 \u3067\u4fee\u6b63\u6e08\u307f\uff09\n</code></pre> <p>Phase 0 \u3067 <code>Backtest_Wrapper</code> \u4f7f\u7528\u306b\u5207\u308a\u66ff\u3048\u6e08\u307f\u306e\u305f\u3081\u3001Phase 2 \u3067\u306f <code>backtest_wrapper.py</code> \u306e\u5dee\u3057\u66ff\u3048\u306e\u307f\u3067\u81ea\u52d5\u7684\u306b NautilusBacktest \u306b\u5207\u308a\u66ff\u308f\u308b\u3002</p>"},{"location":"nautilus-migration-plan/#modify-full_modepy-phase-2","title":"[MODIFY] full_mode.py \u2014 Phase 2","text":"<p>\u540c\u69d8\u306bBacktest\u306e\u30a4\u30f3\u30dd\u30fc\u30c8\u5143\u3092\u5909\u66f4\u3002get_stock_daily\u306fBackcastPro\u306e\u307e\u307e\u3002</p>"},{"location":"nautilus-migration-plan/#modify-sandboxpy-phase-2","title":"[MODIFY] sandbox.py \u2014 Phase 2","text":"<p>\u540c\u69d8\u306b\u30a4\u30f3\u30dd\u30fc\u30c8\u5909\u66f4\u3002</p>"},{"location":"nautilus-migration-plan/#modify-headless_broadcastpy-phase-2","title":"[MODIFY] headless_broadcast.py \u2014 Phase 2","text":"<p>Backtest \u578b\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u306e\u30a4\u30f3\u30dd\u30fc\u30c8\u5143\u3092\u5909\u66f4\u3002</p>"},{"location":"nautilus-migration-plan/#no-change-chartpy","title":"[NO CHANGE] chart.py","text":"<p><code>BackcastPro.api.stocks_price</code> \u306e\u30a4\u30f3\u30dd\u30fc\u30c8\u306f\u30c7\u30fc\u30bf\u53d6\u5f97\u7528\u306a\u306e\u3067\u5909\u66f4\u306a\u3057\u3002</p>"},{"location":"nautilus-migration-plan/#no-change-boardpy","title":"[NO CHANGE] board.py","text":"<p><code>BackcastPro.api.stocks_board</code> \u306e\u30a4\u30f3\u30dd\u30fc\u30c8\u306f\u30c7\u30fc\u30bf\u53d6\u5f97\u7528\u306a\u306e\u3067\u5909\u66f4\u306a\u3057\u3002</p>"},{"location":"nautilus-migration-plan/#no-change-pyodidepy","title":"[NO CHANGE] pyodide.py","text":"<p>Pyodide\u74b0\u5883\u3067\u306fNautilusTrader\u306f\u52d5\u4f5c\u3057\u306a\u3044\u305f\u3081\u5909\u66f4\u306a\u3057\u3002</p>"},{"location":"nautilus-migration-plan/#modify-backcastpy","title":"[MODIFY] backcast.py","text":"<p>\u30ce\u30fc\u30c8\u30d6\u30c3\u30af\u81ea\u4f53\u306e\u5909\u66f4\u306f\u4e0d\u8981\uff08<code>game_setup</code> \u7d4c\u7531\u3067\u30e9\u30c3\u30d7\u3055\u308c\u308b\u305f\u3081\uff09\u3002\u305f\u3060\u3057\u8aac\u660e\u30c6\u30ad\u30b9\u30c8\u3092\u66f4\u65b0\u3002</p>"},{"location":"nautilus-migration-plan/#_3","title":"\u4f9d\u5b58\u95a2\u4fc2","text":""},{"location":"nautilus-migration-plan/#nautilus_trader","title":"nautilus_trader \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb","text":"<p>BackcastPro \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u4eee\u60f3\u74b0\u5883\u306b <code>nautilus_trader</code> \u3092\u8ffd\u52a0\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002</p> <pre><code>uv pip install nautilus_trader\n</code></pre> <p>\u78ba\u8a8d\u6e08\u307f: v1.221.0 \u304c <code>.venv</code>\uff08Python 3.11.14\uff09\u306b\u65e2\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\u3002</p>"},{"location":"nautilus-migration-plan/#_4","title":"\u5b9f\u88c5\u30d5\u30a7\u30fc\u30ba","text":""},{"location":"nautilus-migration-plan/#phase-0-bridgepy","title":"\u2705 Phase 0: bridge.py \u65e2\u5b58\u30d0\u30b0\u4fee\u6b63\uff08\u5b8c\u4e86\uff09","text":"<p>\u4ee5\u4e0b\u306e3\u3064\u306e\u30d0\u30b0\u3092\u4fee\u6b63\u6e08\u307f\uff08NautilusTrader\u79fb\u884c\u3068\u72ec\u7acb\u3057\u305f\u4fee\u6b63\uff09\uff1a</p> <ol> <li>\u2705 <code>bridge.py</code> \u306e\u30a4\u30f3\u30dd\u30fc\u30c8\u3092 <code>Backtest_Wrapper</code> \u306b\u5909\u66f4\uff08<code>color_theme</code> + <code>_chart_state</code> \u306e\u30d0\u30b0\u89e3\u6d88\uff09</li> <li>\u2705 <code>bridge.py</code> \u306e <code>bt.trades()</code> \u2192 <code>bt.trades</code>\uff08property \u547c\u3073\u51fa\u3057\u306e\u30d0\u30b0\u4fee\u6b63\uff09</li> </ol>"},{"location":"nautilus-migration-plan/#phase-1-nautilus_adapterpy","title":"\u2705 Phase 1: <code>nautilus_adapter.py</code> \u5358\u4f53\u5b9f\u88c5\u30fb\u30e6\u30cb\u30c3\u30c8\u30c6\u30b9\u30c8\uff08\u5b8c\u4e86\uff09","text":"<ol> <li>\u2705 <code>nautilus_adapter.py</code> \u3092\u65b0\u898f\u4f5c\u6210\uff08328\u884c\uff09</li> <li><code>NautilusBacktest</code>, <code>TradeCompat</code>, <code>_InteractiveStrategy</code>, <code>BankruptError</code>, <code>create_jpx_equity()</code>, <code>ohlcv_to_bars()</code></li> <li>\u2705 <code>tests/test_nautilus_adapter.py</code> \u3092\u65b0\u898f\u4f5c\u6210\uff0838\u30c6\u30b9\u30c8\uff09</li> <li>\u2705 \u516838\u30c6\u30b9\u30c8\u901a\u904e\uff08<code>pytest tests/test_nautilus_adapter.py</code> \u3067 2.74\u79d2\uff09</li> </ol> <p>\u5b9f\u969b\u306b\u5b9f\u88c5\u3057\u305f\u30d5\u30a1\u30a4\u30eb: - <code>nautilus_adapter.py</code> \u2014 NautilusTrader \u30a2\u30c0\u30d7\u30bf\u30fc\u672c\u4f53 - <code>tests/test_nautilus_adapter.py</code> \u2014 \u30e6\u30cb\u30c3\u30c8\u30c6\u30b9\u30c8</p>"},{"location":"nautilus-migration-plan/#phase-2","title":"\u2705 Phase 2: \u5404\u30d5\u30a1\u30a4\u30eb\u306e\u30a4\u30f3\u30dd\u30fc\u30c8\u5909\u66f4\uff08\u5b8c\u4e86\uff09","text":"\u30d5\u30a1\u30a4\u30eb \u5909\u66f4\u5185\u5bb9 \u72b6\u614b <code>backtest_wrapper.py</code> <code>BackcastPro.Backtest</code> \u2192 <code>nautilus_adapter.NautilusBacktest</code> \u2705 <code>game_setup.py</code> <code>BankruptError</code> \u3092 <code>nautilus_adapter</code> \u304b\u3089\u53d6\u5f97 \u2705 <code>full_mode.py</code> <code>Backtest</code> \u3092 <code>backtest_wrapper.Backtest_Wrapper</code> \u7d4c\u7531\u306b\u5909\u66f4 \u2705 <code>bridge.py</code> Phase 0 \u3067\u4fee\u6b63\u6e08\u307f\u3002\u8ffd\u52a0\u5909\u66f4\u306a\u3057 \u2705 <code>sandbox.py</code> <code>game_setup</code> \u7d4c\u7531\u306e\u305f\u3081\u5909\u66f4\u4e0d\u8981 \u2705\uff08\u5909\u66f4\u306a\u3057\uff09 <code>headless_broadcast.py</code> TYPE_CHECKING \u306e\u307f\u3002\u5b9f\u884c\u6642\u5f71\u97ff\u306a\u3057 \u2705\uff08\u5909\u66f4\u306a\u3057\uff09 <p>[!NOTE] <code>backtest_wrapper.py</code> \u306e\u5909\u66f4\u304c\u6838\u5fc3\u3002<code>class Backtest_Wrapper(Backtest)</code> \u306e\u69cb\u9020\u3092\u5909\u3048\u305a\u3001 <code>Backtest</code> \u306e\u30a4\u30f3\u30dd\u30fc\u30c8\u5143\u3092\u5dee\u3057\u66ff\u3048\u308b\u3060\u3051\u3067\u5168\u4f53\u304c NautilusBacktest \u306b\u5207\u308a\u66ff\u308f\u308b\u3002</p>"},{"location":"nautilus-migration-plan/#phase-3","title":"\u23f3 Phase 3: \u7d71\u5408\u30c6\u30b9\u30c8\uff08\u30e6\u30fc\u30b6\u30fc\u306b\u3088\u308b\u52d5\u4f5c\u78ba\u8a8d\uff09","text":"<p><code>pnpm tauri:dev</code> \u3067\u30a2\u30d7\u30ea\u3092\u8d77\u52d5\u3057\u3001\u5b9f\u969b\u306e\u30b2\u30fc\u30e0UI\u3092\u64cd\u4f5c\u3057\u3066\u52d5\u4f5c\u78ba\u8a8d\u3002</p> <p>\u78ba\u8a8d\u30c1\u30a7\u30c3\u30af\u30ea\u30b9\u30c8: - [ ] <code>bt.chart(\"7203\")</code> \u3067\u30c1\u30e3\u30fc\u30c8\u304c\u8868\u793a\u3055\u308c\u308b - [ ] <code>bt.buy()</code> \u3067\u6ce8\u6587\u304c\u4f5c\u6210\u3055\u308c\u308b - [ ] <code>bt.step()</code> \u3067\u65e5\u304c\u9032\u307f\u3001\u6ce8\u6587\u304c\u7d04\u5b9a\u3059\u308b - [ ] <code>bt.sell()</code> \u3067\u4fdd\u6709\u682a\u3092\u58f2\u5374\u3067\u304d\u308b - [ ] equity / cash \u304c\u6b63\u3057\u304f\u66f4\u65b0\u3055\u308c\u308b - [ ] <code>BankruptError</code> \u304c equity &lt;= 0 \u3067\u767a\u751f\u3059\u308b - [ ] \u30d6\u30ea\u30c3\u30b8\u30e2\u30fc\u30c9\uff08bridge.py\uff09\u306e golden cross \u6226\u7565\u304c\u52d5\u4f5c\u3059\u308b - [ ] \u30d5\u30eb\u30e2\u30fc\u30c9\uff08full_mode.py\uff09\u304c\u52d5\u4f5c\u3059\u308b</p>"},{"location":"nautilus-migration-plan/#blacksheeppy-run","title":"\u2705 blacksheep.py \u2014 run \u65b9\u5f0f\u3078\u306e\u79fb\u884c\uff08\u30b3\u30fc\u30c9\u5909\u66f4\u5b8c\u4e86\u3001\u52d5\u4f5c\u672a\u78ba\u8a8d\uff09","text":"<p><code>C:\\Users\\sasai\\AppData\\Roaming\\marimo\\notebooks\\blacksheep.py</code> \u3092 NautilusTrader \u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u306e run \u65b9\u5f0f\u306b\u66f8\u304d\u63db\u3048\u6e08\u307f\u3002</p> <p>\u5909\u66f4\u5185\u5bb9: - \u2705 <code>for i in range(200): bt.step()</code> \u30eb\u30fc\u30d7\u3092 <code>bt.run(strategy=..., step_callback=...)</code> \u306b\u7f6e\u304d\u63db\u3048 - \u2705 \u6226\u7565\u30ed\u30b8\u30c3\u30af\u3092 <code>strategy()</code> \u95a2\u6570\u3068\u3057\u3066\u5206\u96e2 - \u2705 <code>update_all_backtest_charts</code> \u3092 <code>step_callback</code> \u3068\u3057\u3066\u6e21\u3057\uff08\u30c1\u30e3\u30fc\u30c8\u66f4\u65b0\u30bf\u30a4\u30df\u30f3\u30b0\u7dad\u6301\uff09</p> <p>\u26a0\ufe0f \u672a\u89e3\u6c7a: <code>nautilus_adapter.py</code> \u306e <code>run(strategy, step_callback)</code> \u5909\u66f4\u304c marimo \u30ce\u30fc\u30c8\u30d6\u30c3\u30af\u306b\u53cd\u6620\u3055\u308c\u3066\u3044\u306a\u3044\uff08\u77e5\u898b10\u53c2\u7167\uff09\u3002 \u6b63\u3057\u3044 <code>nautilus_adapter.py</code> \u306e\u30d1\u30b9\u3092\u7279\u5b9a\u3057\u3001\u305d\u3061\u3089\u3092\u7de8\u96c6\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002</p>"},{"location":"nautilus-migration-plan/#_5","title":"\u30d5\u30a9\u30fc\u30eb\u30d0\u30c3\u30af\u6226\u7565","text":"<p>NautilusTrader\u79fb\u884c\u304c\u56f0\u96e3\u306a\u5834\u5408\uff08\u7279\u5b9aAPI\u306e\u518d\u73fe\u304c\u4e0d\u53ef\u80fd\u3068\u5224\u660e\u3057\u305f\u5834\u5408\uff09\u306f\u3001 BackcastPro \u3092\u7d99\u7d9a\u5229\u7528\u3057\u3001\u79fb\u884c\u3092\u4e2d\u6b62\u3059\u308b\u3002 Phase 1 \u306e\u30e6\u30cb\u30c3\u30c8\u30c6\u30b9\u30c8\u304c\u901a\u3089\u306a\u3044\u5834\u5408\u306f\u3053\u306e\u30d5\u30a9\u30fc\u30eb\u30d0\u30c3\u30af\u3092\u9069\u7528\u3059\u308b\u3002</p>"},{"location":"nautilus-migration-plan/#verification-plan","title":"Verification Plan","text":""},{"location":"nautilus-migration-plan/#phase-0","title":"\u2705 Phase 0: \u65e2\u5b58\u30d0\u30b0\u4fee\u6b63\u306e\u78ba\u8a8d\uff08\u5b8c\u4e86\uff09","text":"<p><code>tests/test_nautilus_adapter.py::TestPhase0Compat</code> \u3067\u691c\u8a3c\u6e08\u307f\uff1a</p> <pre><code>def test_bridge_trades_is_property():\n    \"\"\"bt.trades \u304c property \u3067\u3042\u308a callable \u3067\u306a\u3044\u3053\u3068\"\"\"\n    bt = Backtest_Wrapper(cash=100_000)\n    assert not callable(bt.trades)\n\ndef test_bridge_chart_state_exists():\n    \"\"\"Backtest_Wrapper \u306b _chart_state \u304c\u5b58\u5728\u3059\u308b\u3053\u3068\"\"\"\n    bt = Backtest_Wrapper(cash=100_000, color_theme=\"light\")\n    assert hasattr(bt, \"_chart_state\")\n    bt._chart_state.reset()  # AttributeError \u304c\u51fa\u306a\u3044\u3053\u3068\n</code></pre>"},{"location":"nautilus-migration-plan/#phase-1-3838","title":"\u2705 Phase 1: \u30e6\u30cb\u30c3\u30c8\u30c6\u30b9\u30c8\uff08\u5b8c\u4e86 \u2014 38/38 \u901a\u904e\uff09","text":"<p>\u5b9f\u884c\u30b3\u30de\u30f3\u30c9: <pre><code>cd C:/Users/sasai/Documents/BackcastPro\n.venv/Scripts/python -m pytest tests/test_nautilus_adapter.py -v\n# 38 passed in 2.74s\n</code></pre></p> <p><code>tests/test_nautilus_adapter.py</code> \u306b\u5b9f\u88c5\u6e08\u307f:</p> <pre><code>def test_step_execution():\n    bt = NautilusBacktest(data={\"7203\": synthetic_df})\n    assert bt.is_finished == False\n    assert bt.step_index == 0\n    bt.step()\n    assert bt.step_index == 1\n    assert bt.current_time is not None\n\ndef test_current_data_visible_to_strategy():\n    \"\"\"step() \u5185\u3067\u6226\u7565\u304c\u547c\u3070\u308c\u308b\u6642\u70b9\u3067\u73fe\u5728\u30d0\u30fc\u304c bt.data \u306b\u898b\u3048\u308b\u3053\u3068\"\"\"\n    seen_lengths = []\n    def strategy(bt):\n        seen_lengths.append(len(bt.data[\"7203\"]))\n    bt = NautilusBacktest(data={\"7203\": synthetic_df})\n    bt.set_strategy(strategy)\n    bt.step()  # step 1: \u6226\u7565\u304c\u547c\u3070\u308c\u308b\u6642\u70b9\u3067 data \u306b1\u884c\u76ee\u304c\u898b\u3048\u308b\u3053\u3068\n    bt.step()  # step 2: \u6226\u7565\u304c\u547c\u3070\u308c\u308b\u6642\u70b9\u3067 data \u306b2\u884c\u76ee\u304c\u898b\u3048\u308b\u3053\u3068\n    assert seen_lengths == [1, 2], f\"expected [1, 2], got {seen_lengths}\"\n\ndef test_set_data_auto_starts():\n    \"\"\"set_data() \u306e\u5f8c\u306b\u660e\u793a\u7684 start() \u306a\u3057\u3067 step() \u304c\u52d5\u4f5c\u3059\u308b\u3053\u3068\"\"\"\n    bt = NautilusBacktest(cash=100_000)\n    bt.set_data({\"7203\": synthetic_df})  # start() \u304c\u81ea\u52d5\u3067\u547c\u3070\u308c\u308b\n    assert bt.step()  # RuntimeError \u304c\u51fa\u306a\u3044\u3053\u3068\n\ndef test_buy_and_equity():\n    bt = NautilusBacktest(data={\"7203\": synthetic_df})\n    bt.step()  # \u6700\u521d\u306e\u30d0\u30fc\u3092\u9032\u3081\u308b\n    initial_equity = bt.equity\n    bt.buy()\n    bt.step()  # \u6ce8\u6587\u7d04\u5b9a\n    assert bt.equity != initial_equity  # \u30dd\u30b8\u30b7\u30e7\u30f3\u306eMTM\u53cd\u6620\n\ndef test_goto():\n    bt = NautilusBacktest(data={\"7203\": synthetic_df})\n    bt.goto(5)\n    assert bt.step_index == 5\n\ndef test_finalize():\n    bt = NautilusBacktest(data={\"7203\": synthetic_df})\n    while not bt.is_finished:\n        bt.step()\n    result = bt.finalize()\n    assert isinstance(result, pd.Series)\n\ndef test_all_api_methods():\n    \"\"\"\u5168\u30e1\u30bd\u30c3\u30c9/\u30d7\u30ed\u30d1\u30c6\u30a3\u304c\u4f8b\u5916\u306a\u304f\u547c\u3073\u51fa\u305b\u308b\u3053\u3068\"\"\"\n    bt = NautilusBacktest(data={\"7203\": synthetic_df})\n    bt.set_cash(500_000)\n    bt.set_strategy(lambda b: None)\n    bt.start()\n    bt.step()\n    _ = bt.equity\n    _ = bt.cash\n    _ = bt.trades\n    _ = bt.closed_trades\n    _ = bt.orders\n    _ = bt.position\n    _ = bt.position_of(\"7203\")\n    _ = bt.data\n    _ = bt.current_time\n    _ = bt.progress\n    _ = bt.step_index\n    _ = bt.is_finished\n    _ = bt.get_state_snapshot()\n    bt.add_trade_callback(lambda e, t: None)\n    bt.reset()\n    bt.goto(3)\n    bt.finalize()\n</code></pre>"},{"location":"nautilus-migration-plan/#phase-3_1","title":"\u23f3 Phase 3: \u624b\u52d5\u78ba\u8a8d\uff08\u30e6\u30fc\u30b6\u30fc\u306b\u3088\u308b\u30c6\u30b9\u30c8\uff09","text":"<ol> <li>nautilus_trader \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u78ba\u8a8d</li> <li> <p>\u2705 <code>python -c \"import nautilus_trader; print(nautilus_trader.__version__)\"</code> \u2192 <code>1.221.0</code> \u78ba\u8a8d\u6e08\u307f</p> </li> <li> <p>\u30b2\u30fc\u30e0UI\u52d5\u4f5c\u78ba\u8a8d\uff08\u30e6\u30fc\u30b6\u30fc\u306b\u3088\u308b\u30c6\u30b9\u30c8\uff09    <pre><code>pnpm tauri:dev\n</code></pre></p> </li> <li> backcast.py \u30ce\u30fc\u30c8\u30d6\u30c3\u30af\u3092\u958b\u304f</li> <li> <code>bt.chart(\"7203\")</code> \u3067\u30c1\u30e3\u30fc\u30c8\u304c\u8868\u793a\u3055\u308c\u308b</li> <li> <code>bt.buy()</code> \u3067\u6ce8\u6587\u304c\u4f5c\u6210\u3055\u308c\u308b</li> <li> <code>bt.step()</code> \u3067\u65e5\u304c\u9032\u307f\u3001\u6ce8\u6587\u304c\u7d04\u5b9a\u3059\u308b</li> <li> <code>bt.sell()</code> \u3067\u4fdd\u6709\u682a\u3092\u58f2\u5374\u3067\u304d\u308b</li> <li> <p> equity / cash \u304c\u6b63\u3057\u304f\u66f4\u65b0\u3055\u308c\u308b</p> </li> <li> <p>\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u78ba\u8a8d</p> </li> <li> <p> equity &lt;= 0 \u306b\u306a\u3063\u305f\u5834\u5408\u306b <code>BankruptError</code> \u304c\u767a\u751f\u3059\u308b\u3053\u3068</p> </li> <li> <p>\u56de\u5e30\u30c6\u30b9\u30c8 <pre><code>cd C:/Users/sasai/Documents/BackcastPro\n.venv/Scripts/python -m pytest tests/test_nautilus_adapter.py -v\n</code></pre></p> </li> </ol>"},{"location":"privacy/","title":"\u30d7\u30e9\u30a4\u30d0\u30b7\u30fc\u30dd\u30ea\u30b7\u30fc","text":"<p>BackcastPro\uff08\u4ee5\u4e0b\u3001\u300c\u5f53\u793e\u300d\u3068\u3044\u3044\u307e\u3059\u3002\uff09\u306f\u3001\u5f53\u793e\u304c\u63d0\u4f9b\u3059\u308b\u30b5\u30fc\u30d3\u30b9\uff08\u4ee5\u4e0b\u3001\u300c\u672c\u30b5\u30fc\u30d3\u30b9\u300d\u3068\u3044\u3044\u307e\u3059\u3002\uff09\u306b\u304a\u3044\u3066\u53d6\u5f97\u3059\u308b\u5229\u7528\u8005\u306e\u500b\u4eba\u60c5\u5831\u7b49\u306b\u3064\u3044\u3066\u3001\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u30d7\u30e9\u30a4\u30d0\u30b7\u30fc\u30dd\u30ea\u30b7\u30fc\uff08\u4ee5\u4e0b\u3001\u300c\u672c\u30dd\u30ea\u30b7\u30fc\u300d\u3068\u3044\u3044\u307e\u3059\u3002\uff09\u3092\u5b9a\u3081\u307e\u3059\u3002</p>"},{"location":"privacy/#1","title":"1. \u53d6\u5f97\u3059\u308b\u60c5\u5831","text":"<ul> <li>\u5f53\u793e\u304c\u5b9a\u3081\u308b\u30d5\u30a9\u30fc\u30e0\u7b49\u3092\u901a\u3058\u3066\u5229\u7528\u8005\u304b\u3089\u3054\u63d0\u4f9b\u3044\u305f\u3060\u304f\u6c0f\u540d\u3001\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3001\u6240\u5c5e\u3001\u305d\u306e\u4ed6\u304a\u554f\u3044\u5408\u308f\u305b\u5185\u5bb9\u306b\u542b\u307e\u308c\u308b\u60c5\u5831</li> <li>\u30b5\u30fc\u30d3\u30b9\u5229\u7528\u6642\u306b\u81ea\u52d5\u53d6\u5f97\u3059\u308b\u30ed\u30b0\u60c5\u5831\u3001\u7aef\u672b\u60c5\u5831\u3001Cookie \u53ca\u3073\u985e\u4f3c\u6280\u8853\u3092\u7528\u3044\u3066\u53d6\u5f97\u3059\u308b\u60c5\u5831</li> <li>\u5229\u7528\u8005\u304b\u3089\u500b\u5225\u306b\u540c\u610f\u3092\u3044\u305f\u3060\u3044\u305f\u4e0a\u3067\u53d6\u5f97\u3059\u308b\u305d\u306e\u4ed6\u306e\u60c5\u5831</li> </ul>"},{"location":"privacy/#2","title":"2. \u5229\u7528\u76ee\u7684","text":"<p>\u5f53\u793e\u306f\u53d6\u5f97\u3057\u305f\u60c5\u5831\u3092\u3001\u4ee5\u4e0b\u306e\u76ee\u7684\u306e\u305f\u3081\u306b\u5229\u7528\u3057\u307e\u3059\u3002 - \u672c\u30b5\u30fc\u30d3\u30b9\u306b\u95a2\u3059\u308b\u767b\u9332\u3001\u672c\u4eba\u78ba\u8a8d\u3001\u5229\u7528\u8005\u7ba1\u7406\u306e\u305f\u3081 - \u672c\u30b5\u30fc\u30d3\u30b9\u306e\u63d0\u4f9b\u3001\u7dad\u6301\u3001\u4fdd\u8b77\u53ca\u3073\u6539\u5584\u306e\u305f\u3081 - \u5229\u7528\u8005\u304b\u3089\u306e\u304a\u554f\u3044\u5408\u308f\u305b\u3078\u306e\u5bfe\u5fdc\u53ca\u3073\u5fc5\u8981\u306b\u5fdc\u3058\u305f\u9023\u7d61\u306e\u305f\u3081 - \u5f53\u793e\u304c\u63d0\u4f9b\u3059\u308b\u30b5\u30fc\u30d3\u30b9\u7b49\u306b\u95a2\u3059\u308b\u3054\u6848\u5185\u3001\u30ad\u30e3\u30f3\u30da\u30fc\u30f3\u3001\u30a2\u30f3\u30b1\u30fc\u30c8\u306e\u5b9f\u65bd\u306e\u305f\u3081 - \u4e0d\u6b63\u5229\u7528\u9632\u6b62\u3084\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u5411\u4e0a\u3001\u30c8\u30e9\u30d6\u30eb\u5bfe\u5fdc\u306e\u305f\u3081 - \u6cd5\u4ee4\u53c8\u306f\u884c\u653f\u6a5f\u95a2\u306e\u8981\u8acb\u306b\u57fa\u3065\u304f\u5bfe\u5fdc\u306e\u305f\u3081</p>"},{"location":"privacy/#3","title":"3. \u7b2c\u4e09\u8005\u63d0\u4f9b","text":"<p>\u5f53\u793e\u306f\u3001\u4ee5\u4e0b\u306e\u5834\u5408\u3092\u9664\u304d\u3001\u53d6\u5f97\u3057\u305f\u500b\u4eba\u60c5\u5831\u3092\u7b2c\u4e09\u8005\u306b\u63d0\u4f9b\u3057\u307e\u305b\u3093\u3002 - \u5229\u7528\u8005\u3054\u672c\u4eba\u306e\u540c\u610f\u304c\u3042\u308b\u5834\u5408 - \u6cd5\u4ee4\u306b\u57fa\u3065\u304f\u5834\u5408 - \u4eba\u306e\u751f\u547d\u3001\u8eab\u4f53\u53c8\u306f\u8ca1\u7523\u306e\u4fdd\u8b77\u306e\u305f\u3081\u306b\u5fc5\u8981\u304c\u3042\u308b\u5834\u5408\u3067\u3042\u3063\u3066\u3001\u5229\u7528\u8005\u3054\u672c\u4eba\u306e\u540c\u610f\u3092\u5f97\u308b\u3053\u3068\u304c\u56f0\u96e3\u3067\u3042\u308b\u3068\u304d - \u516c\u8846\u885b\u751f\u306e\u5411\u4e0a\u53c8\u306f\u5150\u7ae5\u306e\u5065\u5168\u306a\u80b2\u6210\u306e\u63a8\u9032\u306e\u305f\u3081\u306b\u7279\u306b\u5fc5\u8981\u304c\u3042\u308b\u5834\u5408\u3067\u3042\u3063\u3066\u3001\u5229\u7528\u8005\u3054\u672c\u4eba\u306e\u540c\u610f\u3092\u5f97\u308b\u3053\u3068\u304c\u56f0\u96e3\u3067\u3042\u308b\u3068\u304d - \u56fd\u306e\u6a5f\u95a2\u3001\u5730\u65b9\u516c\u5171\u56e3\u4f53\u53c8\u306f\u305d\u306e\u59d4\u8a17\u3092\u53d7\u3051\u305f\u8005\u304c\u6cd5\u4ee4\u306e\u5b9a\u3081\u308b\u4e8b\u52d9\u3092\u9042\u884c\u3059\u308b\u3053\u3068\u306b\u5bfe\u3057\u3066\u5354\u529b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u5834\u5408\u3067\u3042\u3063\u3066\u3001\u5229\u7528\u8005\u3054\u672c\u4eba\u306e\u540c\u610f\u3092\u5f97\u308b\u3053\u3068\u306b\u3088\u308a\u5f53\u8a72\u4e8b\u52d9\u306e\u9042\u884c\u306b\u652f\u969c\u3092\u53ca\u307c\u3059\u304a\u305d\u308c\u304c\u3042\u308b\u3068\u304d</p>"},{"location":"privacy/#4","title":"4. \u59d4\u8a17\u5148\u306e\u7ba1\u7406","text":"<p>\u5f53\u793e\u306f\u3001\u696d\u52d9\u59d4\u8a17\u5148\u306b\u500b\u4eba\u60c5\u5831\u306e\u53d6\u6271\u3044\u3092\u59d4\u8a17\u3059\u308b\u5834\u5408\u306b\u306f\u3001\u9069\u5207\u306a\u5951\u7d04\u53ca\u3073\u76e3\u7763\u3092\u884c\u3044\u3001\u59d4\u8a17\u5148\u306b\u672c\u30dd\u30ea\u30b7\u30fc\u3068\u540c\u7b49\u4ee5\u4e0a\u306e\u5b89\u5168\u7ba1\u7406\u304c\u56f3\u3089\u308c\u308b\u3088\u3046\u52aa\u3081\u307e\u3059\u3002</p>"},{"location":"privacy/#5","title":"5. \u500b\u4eba\u60c5\u5831\u306e\u5b89\u5168\u7ba1\u7406","text":"<p>\u5f53\u793e\u306f\u3001\u500b\u4eba\u60c5\u5831\u306e\u6f0f\u3048\u3044\u3001\u6ec5\u5931\u53c8\u306f\u304d\u640d\u3092\u9632\u6b62\u3059\u308b\u305f\u3081\u3001\u5fc5\u8981\u304b\u3064\u9069\u5207\u306a\u5b89\u5168\u7ba1\u7406\u63aa\u7f6e\u3092\u8b1b\u3058\u308b\u3068\u3068\u3082\u306b\u3001\u5f93\u696d\u54e1\u53ca\u3073\u59d4\u8a17\u5148\u306b\u5bfe\u3057\u3066\u5fc5\u8981\u306a\u6559\u80b2\u30fb\u76e3\u7763\u3092\u884c\u3044\u307e\u3059\u3002</p>"},{"location":"privacy/#6","title":"6. \u500b\u4eba\u60c5\u5831\u306b\u95a2\u3059\u308b\u6a29\u5229","text":"<p>\u5229\u7528\u8005\u306f\u3001\u5f53\u793e\u304c\u4fdd\u6709\u3059\u308b\u81ea\u5df1\u306e\u500b\u4eba\u60c5\u5831\u306b\u3064\u3044\u3066\u3001\u958b\u793a\u3001\u8a02\u6b63\u3001\u5229\u7528\u505c\u6b62\u3001\u524a\u9664\u7b49\u306e\u8acb\u6c42\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u3053\u308c\u3089\u306e\u8acb\u6c42\u3092\u884c\u3046\u5834\u5408\u306f\u3001\u7b2c9\u6761\u306e\u304a\u554f\u3044\u5408\u308f\u305b\u7a93\u53e3\u307e\u3067\u3054\u9023\u7d61\u304f\u3060\u3055\u3044\u3002</p>"},{"location":"privacy/#7","title":"7. \u672a\u6210\u5e74\u8005\u306e\u500b\u4eba\u60c5\u5831","text":"<p>\u672a\u6210\u5e74\u8005\u304c\u672c\u30b5\u30fc\u30d3\u30b9\u3092\u5229\u7528\u3059\u308b\u5834\u5408\u306f\u3001\u4fdd\u8b77\u8005\u306e\u540c\u610f\u3092\u5f97\u305f\u4e0a\u3067\u3054\u5229\u7528\u304f\u3060\u3055\u3044\u3002\u4fdd\u8b77\u8005\u306e\u540c\u610f\u304c\u306a\u3044\u5834\u5408\u3001\u5f53\u793e\u306f\u500b\u4eba\u60c5\u5831\u306e\u53d6\u5f97\u53c8\u306f\u5229\u7528\u3092\u4e2d\u6b62\u3059\u308b\u3053\u3068\u304c\u3042\u308a\u307e\u3059\u3002</p>"},{"location":"privacy/#8","title":"8. \u30d7\u30e9\u30a4\u30d0\u30b7\u30fc\u30dd\u30ea\u30b7\u30fc\u306e\u6539\u5b9a","text":"<p>\u5f53\u793e\u306f\u3001\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u672c\u30dd\u30ea\u30b7\u30fc\u306e\u5185\u5bb9\u3092\u6539\u5b9a\u3059\u308b\u3053\u3068\u304c\u3042\u308a\u307e\u3059\u3002\u91cd\u8981\u306a\u5909\u66f4\u304c\u3042\u308b\u5834\u5408\u306b\u306f\u3001\u672c\u30b5\u30fc\u30d3\u30b9\u4e0a\u3067\u544a\u77e5\u3059\u308b\u304b\u3001\u5229\u7528\u8005\u306b\u901a\u77e5\u3057\u307e\u3059\u3002</p>"},{"location":"privacy/#9","title":"9. \u304a\u554f\u3044\u5408\u308f\u305b\u7a93\u53e3","text":"<p>\u672c\u30dd\u30ea\u30b7\u30fc\u306b\u95a2\u3059\u308b\u304a\u554f\u3044\u5408\u308f\u305b\u306f\u3001\u4e0b\u8a18\u7a93\u53e3\u307e\u3067\u3054\u9023\u7d61\u304f\u3060\u3055\u3044\u3002</p> <ul> <li>\u9023\u7d61\u5148\uff1aprivacy@backcastpro.example</li> <li>\u6240\u5728\u5730\uff1a\u3012000-0000 \u6771\u4eac\u90fd\u5343\u4ee3\u7530\u533a\u30b5\u30f3\u30d7\u30eb1-2-3 BackcastPro\u5185</li> </ul>"},{"location":"privacy/#10","title":"10. \u5236\u5b9a\u30fb\u6539\u5b9a\u65e5","text":"<ul> <li>\u5236\u5b9a\u65e5\uff1a2025\u5e7411\u670810\u65e5</li> <li>\u6700\u7d42\u6539\u5b9a\u65e5\uff1a2025\u5e7411\u670810\u65e5</li> </ul>"},{"location":"troubleshooting/","title":"\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u30ac\u30a4\u30c9","text":"<p>BackcastPro\u3092\u4f7f\u7528\u3059\u308b\u969b\u306b\u3088\u304f\u767a\u751f\u3059\u308b\u554f\u984c\u3068\u305d\u306e\u89e3\u6c7a\u65b9\u6cd5\u3092\u307e\u3068\u3081\u3066\u3044\u307e\u3059\u3002</p>"},{"location":"troubleshooting/#_2","title":"\u76ee\u6b21","text":"<ul> <li>\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u95a2\u9023\u306e\u554f\u984c</li> <li>\u30c7\u30fc\u30bf\u95a2\u9023\u306e\u554f\u984c</li> <li>\u6226\u7565\u5b9f\u88c5\u306e\u554f\u984c</li> <li>\u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u5b9f\u884c\u306e\u554f\u984c</li> <li>\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u554f\u984c</li> <li>\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u4e00\u89a7</li> </ul>"},{"location":"troubleshooting/#_3","title":"\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u95a2\u9023\u306e\u554f\u984c","text":""},{"location":"troubleshooting/#modulenotfounderror-no-module-named-backcastpro","title":"\u554f\u984c: <code>ModuleNotFoundError: No module named 'BackcastPro'</code>","text":"<p>\u539f\u56e0: BackcastPro\u304c\u6b63\u3057\u304f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u306a\u3044</p> <p>\u89e3\u6c7a\u65b9\u6cd5: <pre><code># PyPI\u304b\u3089\u518d\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\npython -m pip install BackcastPro\n\n# \u307e\u305f\u306f\u958b\u767a\u7528\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\ngit clone &lt;repository-url&gt;\ncd BackcastPro\npython -m venv .venv\n.\\.venv\\Scripts\\Activate.ps1\npython -m pip install -e .\n</code></pre></p>"},{"location":"troubleshooting/#importerror-cannot-import-name-xxx","title":"\u554f\u984c: <code>ImportError: cannot import name 'XXX'</code>","text":"<p>\u539f\u56e0: \u53e4\u3044\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u3001\u307e\u305f\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u4e0d\u5b8c\u5168</p> <p>\u89e3\u6c7a\u65b9\u6cd5: <pre><code># \u65e2\u5b58\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u30a2\u30f3\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\npython -m pip uninstall BackcastPro -y\n\n# \u6700\u65b0\u7248\u3092\u518d\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\npython -m pip install --upgrade BackcastPro\n\n# \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u78ba\u8a8d\npython -c \"from BackcastPro import Backtest, get_stock_daily, get_stock_board, get_stock_info; print('OK')\"\n</code></pre></p>"},{"location":"troubleshooting/#_4","title":"\u554f\u984c: \u4f9d\u5b58\u95a2\u4fc2\u306e\u7af6\u5408","text":"<p>\u539f\u56e0: \u4ed6\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3068\u306e\u4f9d\u5b58\u95a2\u4fc2\u306e\u7af6\u5408</p> <p>\u89e3\u6c7a\u65b9\u6cd5: <pre><code># \u4eee\u60f3\u74b0\u5883\u3092\u4f5c\u6210\uff08Windows\uff09\npython -m venv backcastpro_env\n.\\backcastpro_env\\Scripts\\Activate.ps1\n\n# \u30af\u30ea\u30fc\u30f3\u306a\u74b0\u5883\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\npython -m pip install BackcastPro\n</code></pre></p>"},{"location":"troubleshooting/#_5","title":"\u30c7\u30fc\u30bf\u95a2\u9023\u306e\u554f\u984c","text":""},{"location":"troubleshooting/#typeerror-dataxxx-must-be-a-pandasdataframe-with-columns","title":"\u554f\u984c: <code>TypeError: data[XXX] must be a pandas.DataFrame with columns</code>","text":"<p>\u539f\u56e0: \u30c7\u30fc\u30bf\u304c\u8f9e\u66f8\u5f62\u5f0f\u3067\u306a\u3044\u3001\u307e\u305f\u306fDataFrame\u3067\u306a\u3044</p> <p>\u89e3\u6c7a\u65b9\u6cd5: <pre><code># \u6b63\u3057\u3044\u5f62\u5f0f: \u8f9e\u66f8\u3067\u9298\u67c4\u30b3\u30fc\u30c9\u3092\u30ad\u30fc\u3068\u3057\u3066DataFrame\u3092\u6e21\u3059\nbt = Backtest(\n    data={\n        '7203.T': toyota_data,\n        '6758.T': sony_data\n    },\n    cash=10000\n)\n\n# \u5358\u4e00\u9298\u67c4\u306e\u5834\u5408\u3082\u8f9e\u66f8\u5f62\u5f0f\u3067\u6e21\u3059\nbt = Backtest(data={'7203.T': toyota_data}, cash=10000)\n</code></pre></p>"},{"location":"troubleshooting/#valueerror-data-must-be-a-pandasdataframe-with-columns","title":"\u554f\u984c: <code>ValueError: data must be a pandas.DataFrame with columns</code>","text":"<p>\u539f\u56e0: DataFrame\u306b\u5fc5\u8981\u306a\u5217\u304c\u306a\u3044</p> <p>\u89e3\u6c7a\u65b9\u6cd5: <pre><code>import pandas as pd\n\n# \u5fc5\u8981\u306a\u5217\u3092\u78ba\u8a8d\nrequired_columns = ['Open', 'High', 'Low', 'Close']\nif not all(col in data.columns for col in required_columns):\n    print(\"\u4e0d\u8db3\u3057\u3066\u3044\u308b\u5217:\", [col for col in required_columns if col not in data.columns])\n    # \u4e0d\u8db3\u3057\u3066\u3044\u308b\u5217\u3092\u8ffd\u52a0\n    for col in required_columns:\n        if col not in data.columns:\n            data[col] = data['Close']  # \u7d42\u5024\u3067\u88dc\u5b8c\n</code></pre></p>"},{"location":"troubleshooting/#valueerror-some-ohlc-values-are-missing-nan","title":"\u554f\u984c: <code>ValueError: Some OHLC values are missing (NaN)</code>","text":"<p>\u539f\u56e0: OHLC\u30c7\u30fc\u30bf\u306b\u6b20\u640d\u5024\u304c\u3042\u308b</p> <p>\u89e3\u6c7a\u65b9\u6cd5: <pre><code># \u6b20\u640d\u5024\u3092\u78ba\u8a8d\nprint(data.isnull().sum())\n\n# \u6b20\u640d\u5024\u3092\u524a\u9664\ndata = data.dropna()\n\n# \u307e\u305f\u306f\u88dc\u9593\ndata = data.interpolate()\n\n# \u307e\u305f\u306f\u524d\u306e\u5024\u3067\u57cb\u3081\u308b\ndata = data.fillna(method='ffill')\n</code></pre></p>"},{"location":"troubleshooting/#requestsrequestexception-failed-to-fetch-data-from-api","title":"\u554f\u984c: <code>requests.RequestException: Failed to fetch data from API</code>","text":"<p>\u539f\u56e0: API\u63a5\u7d9a\u306e\u554f\u984c</p> <p>\u89e3\u6c7a\u65b9\u6cd5: <pre><code># 1. \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u63a5\u7d9a\u3092\u78ba\u8a8d\nimport requests\ntry:\n    response = requests.get('https://httpbin.org/get', timeout=5)\n    print(\"\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u63a5\u7d9a: OK\")\nexcept:\n    print(\"\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u63a5\u7d9a: NG\")\n\n# 2. \u74b0\u5883\u5909\u6570\u3092\u78ba\u8a8d\nimport os\nprint(\"API URL:\", os.getenv('BACKCASTPRO_API_URL'))\nprint(\"NAS Proxy URL:\", os.getenv('BACKCASTPRO_NAS_PROXY_URL'))\n\n# 3. \u624b\u52d5\u3067\u30c7\u30fc\u30bf\u3092\u8a2d\u5b9a\ncustom_data = pd.DataFrame({\n    'Open': [100, 101, 102],\n    'High': [105, 106, 107],\n    'Low': [99, 100, 101],\n    'Close': [104, 105, 106],\n    'Volume': [1000, 1100, 1200]\n}, index=pd.date_range('2023-01-01', periods=3))\n</code></pre></p>"},{"location":"troubleshooting/#cloud-run-api","title":"\u554f\u984c: Cloud Run API\u7d4c\u7531\u306e\u30c7\u30fc\u30bf\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u5931\u6557","text":"<p>\u539f\u56e0: Cloud Run API\u306eURL\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u306a\u3044\u3001\u307e\u305f\u306f\u30b5\u30fc\u30d3\u30b9\u304c\u505c\u6b62\u3057\u3066\u3044\u308b\u3002</p> <p>\u89e3\u6c7a\u65b9\u6cd5: 1. <code>.env</code> \u30d5\u30a1\u30a4\u30eb\u3067 <code>BACKCASTPRO_NAS_PROXY_URL</code>\uff08Cloud Run \u30d5\u30a1\u30a4\u30eb\u30b5\u30fc\u30d0\u30fc\u306eURL\uff09\u304c\u6b63\u3057\u304f\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002 2. API\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u304b\u30d6\u30e9\u30a6\u30b6\u3067\u30a2\u30af\u30bb\u30b9\u3057\u3066\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\uff08<code>https://.../</code>\u3067<code>OK</code>\u304c\u8fd4\u308b\u3053\u3068\uff09\u3002 3. Cloud Run \u306b\u30c7\u30fc\u30bf\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u6b63\u3057\u304f\u30de\u30a6\u30f3\u30c8\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p>"},{"location":"troubleshooting/#_6","title":"\u554f\u984c: \u30c7\u30fc\u30bf\u304c\u7a7a\u307e\u305f\u306f\u53d6\u5f97\u3067\u304d\u306a\u3044","text":"<p>\u539f\u56e0: \u9298\u67c4\u30b3\u30fc\u30c9\u304c\u9593\u9055\u3063\u3066\u3044\u308b\u3001\u307e\u305f\u306f\u671f\u9593\u304c\u7121\u52b9</p> <p>\u89e3\u6c7a\u65b9\u6cd5: <pre><code>import yfinance as yf\n\n# 1. \u671f\u9593\u3092\u78ba\u8a8d\nfrom datetime import datetime, timedelta\nend_date = datetime.now()\nstart_date = end_date - timedelta(days=365)\nprint(f\"\u671f\u9593: {start_date} \u304b\u3089 {end_date}\")\n\n# 2. \u7570\u306a\u308b\u9298\u67c4\u3067\u8a66\u3059\ndata = yf.download('7203.T', period='1y')  # \u30c8\u30e8\u30bf\nif data is None or len(data) == 0:\n    print(\"\u30c7\u30fc\u30bf\u304c\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\")\n</code></pre></p>"},{"location":"troubleshooting/#_7","title":"\u6226\u7565\u5b9f\u88c5\u306e\u554f\u984c","text":""},{"location":"troubleshooting/#_8","title":"\u554f\u984c: \u6226\u7565\u95a2\u6570\u304c\u547c\u3070\u308c\u306a\u3044","text":"<p>\u539f\u56e0: <code>set_strategy()</code> \u3092\u547c\u3093\u3067\u3044\u306a\u3044\u3001\u307e\u305f\u306f\u6226\u7565\u95a2\u6570\u306e\u30b7\u30b0\u30cd\u30c1\u30e3\u304c\u9593\u9055\u3063\u3066\u3044\u308b</p> <p>\u89e3\u6c7a\u65b9\u6cd5: <pre><code>from BackcastPro import Backtest\n\n# \u6b63\u3057\u3044\u5b9f\u88c5: \u95a2\u6570\u30d9\u30fc\u30b9\u306e\u6226\u7565\ndef my_strategy(bt):\n    \"\"\"\u6226\u7565\u95a2\u6570\u306f (bt) \u3092\u5f15\u6570\u306b\u53d6\u308b\"\"\"\n    for code, df in bt.data.items():\n        if len(df) &lt; 2:\n            continue\n\n        pos = bt.position_of(code)\n        if pos == 0:\n            bt.buy(code=code, tag=\"entry\")\n\n# \u65b9\u6cd51: set_strategy + run\nbt = Backtest(data={'TEST': df}, cash=10000)\nbt.set_strategy(my_strategy)\nresults = bt.run()\n\n# \u65b9\u6cd52: \u624b\u52d5\u30eb\u30fc\u30d7\nbt = Backtest(data={'TEST': df}, cash=10000)\nwhile not bt.is_finished:\n    my_strategy(bt)\n    bt.step()\nresults = bt.finalize()\n</code></pre></p>"},{"location":"troubleshooting/#attributeerror-backtest-object-has-no-attribute-xxx","title":"\u554f\u984c: <code>AttributeError: 'Backtest' object has no attribute 'XXX'</code>","text":"<p>\u539f\u56e0: \u5b58\u5728\u3057\u306a\u3044\u30d7\u30ed\u30d1\u30c6\u30a3\u3084\u30e1\u30bd\u30c3\u30c9\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3044\u308b</p> <p>\u89e3\u6c7a\u65b9\u6cd5: <pre><code>def my_strategy(bt):\n    # \u5229\u7528\u53ef\u80fd\u306a\u30d7\u30ed\u30d1\u30c6\u30a3\n    bt.data             # \u73fe\u5728\u6642\u70b9\u307e\u3067\u306e\u30c7\u30fc\u30bf (dict)\n    bt.equity           # \u73fe\u5728\u306e\u8cc7\u7523\n    bt.cash             # \u73fe\u5728\u306e\u73fe\u91d1\n    bt.current_time     # \u73fe\u5728\u306e\u65e5\u6642\n    bt.progress         # \u9032\u6357\u7387\uff080.0\u301c1.0\uff09\n    bt.step_index       # \u73fe\u5728\u306e\u30b9\u30c6\u30c3\u30d7\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\n    bt.is_finished      # \u5b8c\u4e86\u30d5\u30e9\u30b0\n    bt.position         # \u5168\u9298\u67c4\u5408\u8a08\u30dd\u30b8\u30b7\u30e7\u30f3\n    bt.trades           # \u30a2\u30af\u30c6\u30a3\u30d6\u306a\u53d6\u5f15\n    bt.closed_trades    # \u6c7a\u6e08\u6e08\u307f\u53d6\u5f15\n    bt.orders           # \u672a\u7d04\u5b9a\u306e\u6ce8\u6587\n\n    for code, df in bt.data.items():\n        # \u500b\u5225\u9298\u67c4\u306e\u30dd\u30b8\u30b7\u30e7\u30f3\u53d6\u5f97\n        pos = bt.position_of(code)\n\n        if pos == 0:\n            bt.buy(code=code, tag=\"entry\")\n        elif pos &gt; 0:\n            bt.sell(code=code, tag=\"exit\")\n</code></pre></p>"},{"location":"troubleshooting/#_9","title":"\u554f\u984c: \u6226\u7565\u304c\u52d5\u4f5c\u3057\u306a\u3044","text":"<p>\u539f\u56e0: \u30ed\u30b8\u30c3\u30af\u30a8\u30e9\u30fc\u307e\u305f\u306f\u30c7\u30fc\u30bf\u30a2\u30af\u30bb\u30b9\u306e\u554f\u984c</p> <p>\u89e3\u6c7a\u65b9\u6cd5: <pre><code>def debug_strategy(bt):\n    \"\"\"\u30c7\u30d0\u30c3\u30b0\u7528\u306e\u6226\u7565\"\"\"\n    for code, df in bt.data.items():\n        print(f\"\u9298\u67c4: {code}\")\n        print(f\"\u30c7\u30fc\u30bf\u884c\u6570: {len(df)}\")\n        print(f\"\u6700\u65b0\u7d42\u5024: {df['Close'].iloc[-1] if len(df) &gt; 0 else 'N/A'}\")\n        print(f\"\u30dd\u30b8\u30b7\u30e7\u30f3: {bt.position_of(code)}\")\n        print(f\"\u8cc7\u7523: {bt.equity:,.0f}\")\n        print(\"---\")\n\n        if len(df) &gt;= 2:\n            c0 = df['Close'].iloc[-2]\n            c1 = df['Close'].iloc[-1]\n\n            if bt.position_of(code) == 0 and c1 &lt; c0:\n                print(f\"\u8cb7\u3044\u6ce8\u6587: {code}\")\n                bt.buy(code=code, tag=\"dip\")\n\nbt = Backtest(data={'TEST': df}, cash=10000)\nbt.set_strategy(debug_strategy)\n\n# \u6700\u521d\u306e10\u30b9\u30c6\u30c3\u30d7\u3060\u3051\u5b9f\u884c\u3057\u3066\u30c7\u30d0\u30c3\u30b0\nbt.start()\nfor i in range(min(10, len(bt.index))):\n    bt.step()\n    print(f\"\u30b9\u30c6\u30c3\u30d7 {i+1} \u5b8c\u4e86\\n\")\n</code></pre></p>"},{"location":"troubleshooting/#_10","title":"\u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u5b9f\u884c\u306e\u554f\u984c","text":""},{"location":"troubleshooting/#valueerror-size","title":"\u554f\u984c: <code>ValueError: size\u306f\u6b63\u306e\u8cc7\u7523\u5272\u5408\u307e\u305f\u306f\u6b63\u306e\u6574\u6570\u5358\u4f4d\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059</code>","text":"<p>\u539f\u56e0: \u53d6\u5f15\u30b5\u30a4\u30ba\u304c\u7121\u52b9</p> <p>\u89e3\u6c7a\u65b9\u6cd5: <pre><code>def my_strategy(bt):\n    # \u6b63\u3057\u3044: \u8cc7\u7523\u5272\u5408\uff080-1\u306e\u9593\uff09\n    bt.buy(size=0.1)  # 10%\u306e\u8cc7\u7523\u3092\u4f7f\u7528\n\n    # \u6b63\u3057\u3044: \u6574\u6570\u5358\u4f4d\n    bt.buy(size=100)  # 100\u682a\n\n    # \u9593\u9055\u3063\u305f: \u8ca0\u306e\u5024\n    # bt.buy(size=-100)  # \u30a8\u30e9\u30fc\n\n    # \u9593\u9055\u3063\u305f: 1\u3088\u308a\u5927\u304d\u3044\u5272\u5408\n    # bt.buy(size=1.5)  # \u30a8\u30e9\u30fc\n</code></pre></p>"},{"location":"troubleshooting/#_11","title":"\u554f\u984c: \u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u304c\u7d42\u4e86\u3057\u306a\u3044","text":"<p>\u539f\u56e0: \u7121\u9650\u30eb\u30fc\u30d7\u307e\u305f\u306f\u975e\u5e38\u306b\u9577\u3044\u51e6\u7406\u6642\u9593</p> <p>\u89e3\u6c7a\u65b9\u6cd5: <pre><code># 1. \u30c7\u30fc\u30bf\u30b5\u30a4\u30ba\u3092\u78ba\u8a8d\nprint(f\"\u30c7\u30fc\u30bf\u30b5\u30a4\u30ba: {len(data)}\")\n\n# 2. \u6226\u7565\u306e\u30ed\u30b8\u30c3\u30af\u3092\u7c21\u7d20\u5316\u3057\u3066\u5207\u308a\u5206\u3051\ndef simple_strategy(bt):\n    for code, df in bt.data.items():\n        if len(df) == 1 and bt.position_of(code) == 0:\n            bt.buy(code=code)\n\n# 3. \u30c7\u30fc\u30bf\u671f\u9593\u3092\u77ed\u304f\u3059\u308b\nshort_data = data.tail(100)\n\nbt = Backtest(data={'TEST': short_data}, cash=10000)\nbt.set_strategy(simple_strategy)\nresults = bt.run()\n</code></pre></p>"},{"location":"troubleshooting/#_12","title":"\u554f\u984c: \u7d50\u679c\u304c\u671f\u5f85\u3068\u7570\u306a\u308b","text":"<p>\u539f\u56e0: \u6226\u7565\u30ed\u30b8\u30c3\u30af\u3001\u30c7\u30fc\u30bf\u3001\u307e\u305f\u306f\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u554f\u984c</p> <p>\u89e3\u6c7a\u65b9\u6cd5: <pre><code># 1. \u30c7\u30fc\u30bf\u3092\u78ba\u8a8d\nprint(\"\u30c7\u30fc\u30bf\u306e\u6700\u521d\u306e5\u884c:\")\nprint(data.head())\nprint(\"\u30c7\u30fc\u30bf\u306e\u6700\u5f8c\u306e5\u884c:\")\nprint(data.tail())\n\n# 2. \u6226\u7565\u306e\u52d5\u4f5c\u3092\u78ba\u8a8d\ndef logging_strategy(bt):\n    \"\"\"\u30ed\u30ae\u30f3\u30b0\u4ed8\u304d\u6226\u7565\"\"\"\n    for code, df in bt.data.items():\n        if len(df) == 1 and bt.position_of(code) == 0:\n            price = df['Close'].iloc[-1]\n            bt.buy(code=code, tag=\"entry\")\n            print(f\"\u8cb7\u3044\u6ce8\u6587: {code} @ {price}\")\n\n        if len(df) % 100 == 0:\n            print(f\"\u30d0\u30fc {len(df)}: \u8cc7\u7523 {bt.equity:,.0f}, \u73fe\u91d1 {bt.cash:,.0f}\")\n\nbt = Backtest(data={'TEST': data}, cash=10000, commission=0.001)\nbt.set_strategy(logging_strategy)\nresults = bt.run()\n\n# 3. \u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u78ba\u8a8d\nprint(\"\u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u30d1\u30e9\u30e1\u30fc\u30bf:\")\nprint(f\"\u73fe\u91d1\u6b8b\u9ad8: {bt.cash}\")\nprint(f\"\u624b\u6570\u6599: {bt.commission}\")\n</code></pre></p>"},{"location":"troubleshooting/#_13","title":"\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u554f\u984c","text":""},{"location":"troubleshooting/#_14","title":"\u554f\u984c: \u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u304c\u9045\u3044","text":"<p>\u539f\u56e0: \u975e\u52b9\u7387\u306a\u8a08\u7b97\u3084\u5927\u91cf\u306e\u30c7\u30fc\u30bf</p> <p>\u89e3\u6c7a\u65b9\u6cd5: <pre><code># 1. \u30c7\u30fc\u30bf\u30b5\u30a4\u30ba\u3092\u524a\u6e1b\nshort_data = data.tail(1000)  # \u6700\u65b01000\u30d0\u30fc\u306e\u307f\u4f7f\u7528\n\n# 2. \u4e8b\u524d\u8a08\u7b97\u3067\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3092\u5411\u4e0a\ndata['SMA_20'] = data['Close'].rolling(20).mean()\ndata['SMA_50'] = data['Close'].rolling(50).mean()\n\nbt = Backtest(data={'TEST': data}, cash=10000)\n\ndef optimized_strategy(bt):\n    \"\"\"\u4e8b\u524d\u8a08\u7b97\u3055\u308c\u305f\u5024\u3092\u53c2\u7167\"\"\"\n    for code, df in bt.data.items():\n        if len(df) &lt; 50:\n            continue\n\n        sma20 = df['SMA_20'].iloc[-1]\n        sma50 = df['SMA_50'].iloc[-1]\n\n        if bt.position_of(code) == 0 and sma20 &gt; sma50:\n            bt.buy(code=code, tag=\"golden_cross\")\n\nbt.set_strategy(optimized_strategy)\nresults = bt.run()\n</code></pre></p>"},{"location":"troubleshooting/#_15","title":"\u554f\u984c: \u30e1\u30e2\u30ea\u4f7f\u7528\u91cf\u304c\u5927\u304d\u3044","text":"<p>\u539f\u56e0: \u5927\u91cf\u306e\u30c7\u30fc\u30bf\u307e\u305f\u306f\u975e\u52b9\u7387\u306a\u30c7\u30fc\u30bf\u69cb\u9020</p> <p>\u89e3\u6c7a\u65b9\u6cd5: <pre><code># 1. \u30c7\u30fc\u30bf\u578b\u3092\u6700\u9069\u5316\ndata = data.astype({\n    'Open': 'float32',\n    'High': 'float32',\n    'Low': 'float32',\n    'Close': 'float32',\n    'Volume': 'int32'\n})\n\n# 2. \u4e0d\u8981\u306a\u5217\u3092\u524a\u9664\ndata = data[['Open', 'High', 'Low', 'Close', 'Volume']]\n</code></pre></p>"},{"location":"troubleshooting/#_16","title":"\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u4e00\u89a7","text":""},{"location":"troubleshooting/#_17","title":"\u3088\u304f\u3042\u308b\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u3068\u89e3\u6c7a\u65b9\u6cd5","text":"\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8 \u539f\u56e0 \u89e3\u6c7a\u65b9\u6cd5 <code>ModuleNotFoundError: No module named 'BackcastPro'</code> \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u306a\u3044 <code>pip install BackcastPro</code> <code>TypeError: data[XXX] must be a pandas.DataFrame</code> \u30c7\u30fc\u30bf\u304cDataFrame\u3067\u306a\u3044 <code>pd.DataFrame(data)</code> <code>ValueError: Some OHLC values are missing</code> \u6b20\u640d\u5024\u304c\u3042\u308b <code>data.dropna()</code> <code>ValueError: size\u306f\u6b63\u306e\u8cc7\u7523\u5272\u5408\u307e\u305f\u306f...</code> \u53d6\u5f15\u30b5\u30a4\u30ba\u304c\u7121\u52b9 <code>size=0.1</code> \u307e\u305f\u306f <code>size=100</code> <code>RuntimeError: start() \u3092\u547c\u3073\u51fa\u3057\u3066\u304f\u3060\u3055\u3044</code> \u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u672a\u958b\u59cb <code>bt.start()</code> \u307e\u305f\u306f <code>Backtest(data=...)</code> <code>ValueError: \u8907\u6570\u9298\u67c4\u304c\u3042\u308b\u5834\u5408\u306fcode\u3092\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044</code> \u8907\u6570\u9298\u67c4\u3067code\u672a\u6307\u5b9a <code>bt.buy(code='7203.T')</code> <code>requests.RequestException: Failed to fetch data</code> API\u63a5\u7d9a\u30a8\u30e9\u30fc \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u63a5\u7d9a\u3092\u78ba\u8a8d"},{"location":"troubleshooting/#_18","title":"\u30c7\u30d0\u30c3\u30b0\u306e\u30d2\u30f3\u30c8","text":"<ol> <li> <p>\u30ed\u30b0\u3092\u6709\u52b9\u306b\u3059\u308b <pre><code>import logging\nlogging.basicConfig(level=logging.DEBUG)\n</code></pre></p> </li> <li> <p>\u30c7\u30fc\u30bf\u3092\u78ba\u8a8d\u3059\u308b <pre><code>print(\"\u30c7\u30fc\u30bf\u5f62\u72b6:\", data.shape)\nprint(\"\u30c7\u30fc\u30bf\u5217:\", data.columns.tolist())\nprint(\"\u6b20\u640d\u5024:\", data.isnull().sum())\n</code></pre></p> </li> <li> <p>\u72b6\u614b\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u3092\u78ba\u8a8d\u3059\u308b <pre><code>bt = Backtest(data={'TEST': data}, cash=10000)\nbt.set_strategy(my_strategy)\n\n# 10\u30b9\u30c6\u30c3\u30d7\u9032\u3081\u308b\nbt.goto(10, strategy=my_strategy)\n\n# \u72b6\u614b\u3092\u78ba\u8a8d\nstate = bt.get_state_snapshot()\nprint(state)\n</code></pre></p> </li> <li> <p>\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u3092\u8ffd\u52a0\u3059\u308b <pre><code>try:\n    bt = Backtest(data={'TEST': data}, cash=10000)\n    bt.set_strategy(my_strategy)\n    results = bt.run()\nexcept Exception as e:\n    print(f\"\u30a8\u30e9\u30fc: {e}\")\n    print(f\"\u30a8\u30e9\u30fc\u30bf\u30a4\u30d7: {type(e).__name__}\")\n    import traceback\n    traceback.print_exc()\n</code></pre></p> </li> </ol>"},{"location":"troubleshooting/#_19","title":"\u30b5\u30dd\u30fc\u30c8","text":"<p>\u554f\u984c\u304c\u89e3\u6c7a\u3057\u306a\u3044\u5834\u5408\u306f\u3001\u4ee5\u4e0b\u306e\u65b9\u6cd5\u3067\u30b5\u30dd\u30fc\u30c8\u3092\u53d7\u3051\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\uff1a</p> <ol> <li>GitHub Issues: \u30d0\u30b0\u5831\u544a\u3084\u6a5f\u80fd\u8981\u6c42</li> <li>Discord: \u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u3067\u306e\u8cea\u554f</li> <li>\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8: \u8a73\u7d30\u306a\u4f7f\u7528\u65b9\u6cd5\u306e\u78ba\u8a8d</li> </ol>"},{"location":"troubleshooting/#_20","title":"\u307e\u3068\u3081","text":"<p>\u3053\u306e\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u30ac\u30a4\u30c9\u3067\u306f\u3001BackcastPro\u3092\u4f7f\u7528\u3059\u308b\u969b\u306b\u3088\u304f\u767a\u751f\u3059\u308b\u554f\u984c\u3068\u305d\u306e\u89e3\u6c7a\u65b9\u6cd5\u3092\u8aac\u660e\u3057\u307e\u3057\u305f\u3002\u554f\u984c\u304c\u767a\u751f\u3057\u305f\u5834\u5408\u306f\u3001\u307e\u305a\u3053\u306e\u30ac\u30a4\u30c9\u3092\u78ba\u8a8d\u3057\u3001\u9069\u5207\u306a\u89e3\u6c7a\u65b9\u6cd5\u3092\u8a66\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p>"},{"location":"tutorial/","title":"\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb","text":"<p>BackcastPro\u3092\u4f7f\u3063\u305f\u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u306e\u57fa\u672c\u7684\u306a\u4f7f\u3044\u65b9\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"tutorial/#_2","title":"\u76ee\u6b21","text":"<ol> <li>\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb</li> <li>\u57fa\u672c\u7684\u306a\u4f7f\u3044\u65b9</li> <li>\u6700\u521d\u306e\u6226\u7565</li> <li>\u30c7\u30fc\u30bf\u306e\u53d6\u5f97</li> <li>\u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u306e\u5b9f\u884c</li> <li>\u30ea\u30d7\u30ec\u30a4\u578b\u30b7\u30df\u30e5\u30ec\u30fc\u30bf\u30fc</li> <li>\u7d50\u679c\u306e\u89e3\u91c8</li> <li>marimo\u9023\u643a</li> <li>\u6b21\u306e\u30b9\u30c6\u30c3\u30d7</li> </ol>"},{"location":"tutorial/#windows","title":"\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\uff08Windows\uff09","text":"<pre><code>python -m pip install BackcastPro\n</code></pre>"},{"location":"tutorial/#_3","title":"\u57fa\u672c\u7684\u306a\u4f7f\u3044\u65b9","text":"<p>BackcastPro\u306f**\u30ea\u30d7\u30ec\u30a4\u578b\u30b7\u30df\u30e5\u30ec\u30fc\u30bf\u30fc**\u3067\u3059\u30021\u30d0\u30fc\u305a\u3064\u6642\u9593\u3092\u9032\u3081\u306a\u304c\u3089\u3001\u6226\u7565\u3092\u5b9f\u884c\u3057\u3066\u30c1\u30e3\u30fc\u30c8\u3068\u58f2\u8cb7\u3092\u53ef\u8996\u5316\u3067\u304d\u307e\u3059\u3002</p> <pre><code>sequenceDiagram\n    participant U as User\n    participant D as DataReader\n    participant B as Backtest\n    participant S as Strategy Function\n    participant R as Results\n    U-&gt;&gt;D: yf.download('7203.T', period='1y')\n    D--&gt;&gt;U: OHLCV DataFrame\n    U-&gt;&gt;B: Backtest(data={code: df})\n    loop \u5404\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\n        U-&gt;&gt;S: my_strategy(bt)\n        S-&gt;&gt;B: buy()/sell()\n        U-&gt;&gt;B: step()\n    end\n    U-&gt;&gt;B: finalize()\n    B--&gt;&gt;R: pd.Series\uff08\u7d71\u8a08\u542b\u3080\uff09</code></pre>"},{"location":"tutorial/#1","title":"1. \u5fc5\u8981\u306a\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u30a4\u30f3\u30dd\u30fc\u30c8","text":"<pre><code>from BackcastPro import Backtest\nimport pandas as pd\n</code></pre>"},{"location":"tutorial/#2","title":"2. \u30c7\u30fc\u30bf\u306e\u6e96\u5099","text":"<pre><code>import yfinance as yf\n\n# \u30c8\u30e8\u30bf\u306e\u682a\u4fa1\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\ncode = '7203.T'  # \u6771\u8a3c\u306e\u9298\u67c4\u30b3\u30fc\u30c9\ndf = yf.download(code, period='1y')\nprint(df.head())\n</code></pre>"},{"location":"tutorial/#_4","title":"\u6700\u521d\u306e\u6226\u7565","text":""},{"location":"tutorial/#_5","title":"\u30b7\u30f3\u30d7\u30eb\u306a\u8cb7\u3044\u6301\u3061\u6226\u7565","text":"<p>\u6700\u521d\u306b\u3001\u4e00\u5ea6\u3060\u3051\u8cb7\u3046\u300c\u8cb7\u3044\u6301\u3061\u300d\u6226\u7565\u3092\u4f5c\u6210\u3057\u3066\u307f\u307e\u3057\u3087\u3046\uff1a</p> <pre><code>def buy_and_hold(bt):\n    \"\"\"\u6700\u521d\u306e\u30d0\u30fc\u3067\u4e00\u5ea6\u3060\u3051\u8cb7\u3046\"\"\"\n    if bt.position == 0:\n        bt.buy(tag=\"initial_buy\")\n</code></pre>"},{"location":"tutorial/#_6","title":"\u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u306e\u5b9f\u884c","text":"<pre><code># \u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u3092\u521d\u671f\u5316\nbt = Backtest(data={code: df}, cash=10000, commission=0.001)\n\n# \u4e00\u62ec\u5b9f\u884c\nbt.set_strategy(buy_and_hold)\nresults = bt.run()\nprint(results)\n</code></pre>"},{"location":"tutorial/#_7","title":"\u30c7\u30fc\u30bf\u306e\u53d6\u5f97","text":""},{"location":"tutorial/#_8","title":"\u65e5\u672c\u682a\u30c7\u30fc\u30bf\u306e\u53d6\u5f97","text":"<pre><code>import yfinance as yf\n\n# \u7279\u5b9a\u306e\u9298\u67c4\u306e\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\ntoyota_data = yf.download('7203.T', period='1y')  # \u30c8\u30e8\u30bf\nsony_data = yf.download('6758.T', period='1y')    # \u30bd\u30cb\u30fc\n\n# \u671f\u9593\u3092\u6307\u5b9a\u3057\u3066\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\nfrom datetime import datetime, timedelta\n\nend_date = datetime.now()\nstart_date = end_date - timedelta(days=365)  # 1\u5e74\u524d\n\ndata = yf.download('7203.T', start=start_date, end=end_date)\n</code></pre> <p>[!NOTE] BackcastPro\u306f\u3001\u30ed\u30fc\u30ab\u30eb\u30ad\u30e3\u30c3\u30b7\u30e5\u306b\u30c7\u30fc\u30bf\u304c\u5b58\u5728\u3057\u306a\u3044\u5834\u5408\u3001\u81ea\u52d5\u7684\u306bCloud Run API\u7d4c\u7531\u3067\u30c7\u30fc\u30bf\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002 \u3053\u308c\u306b\u3088\u308a\u3001\u624b\u52d5\u3067\u306e\u30c7\u30fc\u30bf\u6e96\u5099\u306a\u3057\u306b\u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u3092\u958b\u59cb\u3067\u304d\u308b\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002</p>"},{"location":"tutorial/#_9","title":"\u30ab\u30b9\u30bf\u30e0\u30c7\u30fc\u30bf\u306e\u4f7f\u7528","text":"<pre><code>import pandas as pd\n\n# \u30ab\u30b9\u30bf\u30e0\u30c7\u30fc\u30bf\u3092\u4f5c\u6210\ncustom_data = pd.DataFrame({\n    'Open': [100, 101, 102, 103, 104],\n    'High': [105, 106, 107, 108, 109],\n    'Low': [99, 100, 101, 102, 103],\n    'Close': [104, 105, 106, 107, 108],\n    'Volume': [1000, 1100, 1200, 1300, 1400]\n}, index=pd.date_range('2023-01-01', periods=5))\n\n# \u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u3067\u4f7f\u7528\nbt = Backtest(data={'CUSTOM': custom_data}, cash=10000)\nbt.set_strategy(buy_and_hold)\nresults = bt.run()\n</code></pre>"},{"location":"tutorial/#_10","title":"\u8907\u6570\u9298\u67c4\u306e\u540c\u6642\u30d0\u30c3\u30af\u30c6\u30b9\u30c8","text":"<pre><code># \u8907\u6570\u306e\u9298\u67c4\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\ntoyota_data = yf.download('7203.T', period='1y')\nsony_data = yf.download('6758.T', period='1y')\n\n# \u8907\u6570\u9298\u67c4\u3067\u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u3092\u521d\u671f\u5316\nbt = Backtest(\n    data={\n        '7203.T': toyota_data,\n        '6758.T': sony_data\n    },\n    cash=10000\n)\n\n# \u8907\u6570\u9298\u67c4\u5bfe\u5fdc\u306e\u6226\u7565\ndef multi_stock_strategy(bt):\n    for code in bt.data.keys():\n        pos = bt.position_of(code)  # \u26a0\ufe0f \u8907\u6570\u9298\u67c4\u6642\u306f position_of \u3092\u4f7f\u7528\n        if pos == 0:\n            bt.buy(code=code, tag=\"buy\")\n\nbt.set_strategy(multi_stock_strategy)\nresults = bt.run()\n</code></pre>"},{"location":"tutorial/#_11","title":"\u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u306e\u5b9f\u884c","text":""},{"location":"tutorial/#1_1","title":"\u65b9\u6cd51: \u4e00\u62ec\u5b9f\u884c\uff08\u63a8\u5968\uff09","text":"<pre><code>bt = Backtest(\n    data={code: df},\n    cash=10000,\n    commission=0.001,\n    finalize_trades=True,\n)\nbt.set_strategy(my_strategy)\nresults = bt.run()\n</code></pre>"},{"location":"tutorial/#2_1","title":"\u65b9\u6cd52: \u30b9\u30c6\u30c3\u30d7\u5b9f\u884c","text":"<pre><code>bt = Backtest(data={code: df}, cash=10000)\n\nwhile not bt.is_finished:\n    my_strategy(bt)\n    bt.step()\n\nresults = bt.finalize()\n</code></pre>"},{"location":"tutorial/#_12","title":"\u30ea\u30d7\u30ec\u30a4\u578b\u30b7\u30df\u30e5\u30ec\u30fc\u30bf\u30fc","text":"<p>BackcastPro\u306e\u7279\u5fb4\u306f\u3001**1\u30d0\u30fc\u305a\u3064\u6642\u9593\u3092\u9032\u3081\u306a\u304c\u3089\u53ef\u8996\u5316**\u3067\u304d\u308b\u3053\u3068\u3067\u3059\u3002</p>"},{"location":"tutorial/#_13","title":"\u30b9\u30c6\u30c3\u30d7\u5b9f\u884c\u306e\u57fa\u672c","text":"<pre><code>bt = Backtest(data={code: df}, cash=10000)\n\n# 10\u30d0\u30fc\u9032\u3081\u308b\nfor _ in range(10):\n    my_strategy(bt)\n    bt.step()\n\n    # \u73fe\u5728\u306e\u72b6\u614b\u3092\u78ba\u8a8d\n    print(f\"\u6642\u9593: {bt.current_time}\")\n    print(f\"\u9032\u6357: {bt.progress * 100:.1f}%\")\n    print(f\"\u8cc7\u7523: ${bt.equity:,.2f}\")\n    print(f\"\u30dd\u30b8\u30b7\u30e7\u30f3: {bt.position}\")\n    print(\"---\")\n</code></pre>"},{"location":"tutorial/#goto","title":"goto() \u3067\u4efb\u610f\u306e\u4f4d\u7f6e\u3078\u30b8\u30e3\u30f3\u30d7","text":"<pre><code># 100\u30d0\u30fc\u76ee\u307e\u3067\u9032\u3081\u308b\uff08\u6226\u7565\u3092\u9069\u7528\u3057\u306a\u304c\u3089\uff09\nbt.goto(100, strategy=my_strategy)\n\n# \u72b6\u614b\u3092\u78ba\u8a8d\nprint(f\"\u6642\u9593: {bt.current_time}\")\nprint(f\"\u8cc7\u7523: {bt.equity:,.0f}\")\nprint(f\"\u30dd\u30b8\u30b7\u30e7\u30f3: {bt.position}\")\n</code></pre>"},{"location":"tutorial/#reset","title":"reset() \u3067\u6700\u521d\u304b\u3089\u3084\u308a\u76f4\u3057","text":"<pre><code>bt.reset()\n# \u518d\u5ea6\u5b9f\u884c\u53ef\u80fd\n</code></pre>"},{"location":"tutorial/#_14","title":"\u7d50\u679c\u306e\u89e3\u91c8","text":""},{"location":"tutorial/#_15","title":"\u57fa\u672c\u7684\u306a\u7d71\u8a08\u60c5\u5831","text":"<pre><code>results = bt.finalize()\n\n# \u4e3b\u8981\u306a\u7d71\u8a08\u60c5\u5831\u3092\u8868\u793a\nprint(f\"\u7dcf\u30ea\u30bf\u30fc\u30f3: {results['Return [%]']:.2f}%\")\nprint(f\"\u5e74\u7387\u30ea\u30bf\u30fc\u30f3: {results['Return (Ann.) [%]']:.2f}%\")\nprint(f\"\u30b7\u30e3\u30fc\u30d7\u30ec\u30b7\u30aa: {results['Sharpe Ratio']:.2f}\")\nprint(f\"\u6700\u5927\u30c9\u30ed\u30fc\u30c0\u30a6\u30f3: {results['Max. Drawdown [%]']:.2f}%\")\nprint(f\"\u53d6\u5f15\u56de\u6570: {results['# Trades']}\")\nprint(f\"\u52dd\u7387: {results['Win Rate [%]']:.2f}%\")\n</code></pre>"},{"location":"tutorial/#_16","title":"\u30a8\u30af\u30a4\u30c6\u30a3\u30ab\u30fc\u30d6\u306e\u78ba\u8a8d","text":"<pre><code># \u30a8\u30af\u30a4\u30c6\u30a3\u30ab\u30fc\u30d6\u3092\u53d6\u5f97\nequity_curve = results['_equity_curve']\nprint(equity_curve.head())\n\n# \u30c9\u30ed\u30fc\u30c0\u30a6\u30f3\u3092\u78ba\u8a8d\ndrawdown = equity_curve['DrawdownPct']\nprint(f\"\u6700\u5927\u30c9\u30ed\u30fc\u30c0\u30a6\u30f3: {drawdown.min():.2f}%\")\n</code></pre>"},{"location":"tutorial/#_17","title":"\u30c8\u30ec\u30fc\u30c9\u5c65\u6b74\u306e\u78ba\u8a8d","text":"<pre><code># \u30c8\u30ec\u30fc\u30c9\u5c65\u6b74\u3092\u53d6\u5f97\ntrades = results['_trades']\nprint(trades.head())\n\n# \u52dd\u3061\u30c8\u30ec\u30fc\u30c9\u3068\u8ca0\u3051\u30c8\u30ec\u30fc\u30c9\u3092\u5206\u6790\nwinning_trades = trades[trades['PnL'] &gt; 0]\nlosing_trades = trades[trades['PnL'] &lt; 0]\n\nprint(f\"\u52dd\u3061\u30c8\u30ec\u30fc\u30c9\u6570: {len(winning_trades)}\")\nprint(f\"\u8ca0\u3051\u30c8\u30ec\u30fc\u30c9\u6570: {len(losing_trades)}\")\n</code></pre>"},{"location":"tutorial/#marimo","title":"marimo\u9023\u643a","text":"<p>marimo\u3068\u9023\u643a\u3057\u3066\u3001\u30b9\u30e9\u30a4\u30c0\u30fc\u3067\u6642\u9593\u3092\u64cd\u4f5c\u3057\u306a\u304c\u3089\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u3067\u53ef\u8996\u5316\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"tutorial/#marimo_1","title":"\u57fa\u672c\u7684\u306amarimo\u9023\u643a","text":"<pre><code>import marimo as mo\nfrom BackcastPro import Backtest\n\n# \u30c7\u30fc\u30bf\u6e96\u5099\nbt = Backtest(data={\"AAPL\": df_aapl}, cash=100000)\n\n# \u6226\u7565\u5b9a\u7fa9\ndef my_strategy(bt):\n    df = bt.data.get(\"AAPL\")\n    if df is None or len(df) &lt; 2:\n        return\n\n    c0 = df[\"Close\"].iloc[-2]\n    c1 = df[\"Close\"].iloc[-1]\n\n    if bt.position == 0 and c1 &lt; c0:\n        bt.buy(tag=\"dip_buy\")\n    elif bt.position &gt; 0 and c1 &gt; c0:\n        bt.sell(tag=\"profit_take\")\n</code></pre>"},{"location":"tutorial/#ui","title":"UI\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb","text":"<pre><code># \u6642\u9593\u30b9\u30e9\u30a4\u30c0\u30fc\nslider = mo.ui.slider(\n    start=1,\n    stop=len(bt.index),\n    value=1,\n    label=\"\ud83d\udcc5 \u6642\u9593\",\n    show_value=True\n)\n\n# \u30b9\u30e9\u30a4\u30c0\u30fc\u4f4d\u7f6e\u307e\u3067\u9032\u3081\u308b\nbt.goto(slider.value, strategy=my_strategy)\n\n# \u60c5\u5831\u30d1\u30cd\u30eb\nstate = bt.get_state_snapshot()\ninfo = mo.md(f\"\"\"\n### \u72b6\u6cc1\n| \u9805\u76ee | \u5024 |\n|------|-----|\n| \u65e5\u6642 | {state['current_time']} |\n| \u9032\u6357 | {state['progress'] * 100:.1f}% |\n| \u8cc7\u7523 | \u00a5{state['equity']:,.0f} |\n| \u73fe\u91d1 | \u00a5{state['cash']:,.0f} |\n| \u6c7a\u6e08\u6e08\u53d6\u5f15 | {state['closed_trades']} \u4ef6 |\n\"\"\")\n\nmo.vstack([slider, info])\n</code></pre>"},{"location":"tutorial/#_18","title":"\u30a4\u30f3\u30b8\u30b1\u30fc\u30bf\u30fc\u306e\u6d3b\u7528","text":"<p>\u30c7\u30fc\u30bf\u306b\u30a4\u30f3\u30b8\u30b1\u30fc\u30bf\u30fc\u5217\u3092\u8ffd\u52a0\u3057\u3001\u6226\u7565\u5185\u3067\u53c2\u7167\u3067\u304d\u307e\u3059\u3002</p> <pre><code># \u30c7\u30fc\u30bf\u306b\u30a4\u30f3\u30b8\u30b1\u30fc\u30bf\u30fc\u3092\u8ffd\u52a0\ndf['SMA_20'] = df['Close'].rolling(20).mean()\ndf['SMA_50'] = df['Close'].rolling(50).mean()\n\nbt = Backtest(data={code: df}, cash=10000)\n\n# \u6226\u7565\u5185\u3067\u30a4\u30f3\u30b8\u30b1\u30fc\u30bf\u30fc\u3092\u53c2\u7167\ndef sma_cross_strategy(bt):\n    for code, df in bt.data.items():\n        if len(df) &lt; 50:\n            continue\n\n        sma20 = df['SMA_20'].iloc[-1]\n        sma50 = df['SMA_50'].iloc[-1]\n\n        if bt.position_of(code) == 0 and sma20 &gt; sma50:\n            bt.buy(code=code, tag=\"golden_cross\")\n        elif bt.position_of(code) &gt; 0 and sma20 &lt; sma50:\n            bt.sell(code=code, tag=\"dead_cross\")\n\nbt.set_strategy(sma_cross_strategy)\nresults = bt.run()\n</code></pre>"},{"location":"tutorial/#_19","title":"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7","text":""},{"location":"tutorial/#1_2","title":"1. \u3088\u308a\u8907\u96d1\u306a\u6226\u7565\u306e\u5b9f\u88c5","text":"<pre><code>def moving_average_cross(bt):\n    \"\"\"\u79fb\u52d5\u5e73\u5747\u30af\u30ed\u30b9\u6226\u7565\"\"\"\n    df = bt.data.get(\"AAPL\")\n    if df is None or len(df) &lt; 20:\n        return\n\n    sma_short = df[\"Close\"].rolling(10).mean().iloc[-1]\n    sma_long = df[\"Close\"].rolling(20).mean().iloc[-1]\n    sma_short_prev = df[\"Close\"].rolling(10).mean().iloc[-2]\n    sma_long_prev = df[\"Close\"].rolling(20).mean().iloc[-2]\n\n    # \u30b4\u30fc\u30eb\u30c7\u30f3\u30af\u30ed\u30b9\u3067\u8cb7\u3044\n    if bt.position == 0 and sma_short &gt; sma_long and sma_short_prev &lt;= sma_long_prev:\n        bt.buy(tag=\"golden_cross\")\n\n    # \u30c7\u30c3\u30c9\u30af\u30ed\u30b9\u3067\u58f2\u308a\n    elif bt.position &gt; 0 and sma_short &lt; sma_long and sma_short_prev &gt;= sma_long_prev:\n        bt.sell(tag=\"dead_cross\")\n</code></pre>"},{"location":"tutorial/#2_2","title":"2. \u30ea\u30b9\u30af\u7ba1\u7406\u306e\u8ffd\u52a0","text":"<pre><code>def strategy_with_risk_management(bt):\n    if bt.position == 0:\n        price = bt.data[\"AAPL\"][\"Close\"].iloc[-1]\n        bt.buy(\n            sl=price * 0.95,  # 5%\u4e0b\u843d\u3067\u30b9\u30c8\u30c3\u30d7\u30ed\u30b9\n            tp=price * 1.10,  # 10%\u4e0a\u6607\u3067\u30c6\u30a4\u30af\u30d7\u30ed\u30d5\u30a3\u30c3\u30c8\n            tag=\"entry_with_sl_tp\"\n        )\n</code></pre>"},{"location":"tutorial/#3","title":"3. \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u53ef\u8996\u5316","text":"<pre><code>import matplotlib.pyplot as plt\n\n# \u30a8\u30af\u30a4\u30c6\u30a3\u30ab\u30fc\u30d6\u3092\u30d7\u30ed\u30c3\u30c8\nequity_curve = results['_equity_curve']\nplt.figure(figsize=(12, 6))\n\nplt.subplot(2, 1, 1)\nplt.plot(equity_curve.index, equity_curve['Equity'])\nplt.title('\u30a8\u30af\u30a4\u30c6\u30a3\u30ab\u30fc\u30d6')\nplt.ylabel('\u8cc7\u7523')\n\nplt.subplot(2, 1, 2)\nplt.plot(equity_curve.index, equity_curve['DrawdownPct'])\nplt.title('\u30c9\u30ed\u30fc\u30c0\u30a6\u30f3')\nplt.ylabel('\u30c9\u30ed\u30fc\u30c0\u30a6\u30f3 (%)')\n\nplt.tight_layout()\nplt.show()\n</code></pre>"},{"location":"tutorial/#_20","title":"\u3088\u304f\u3042\u308b\u8cea\u554f","text":""},{"location":"tutorial/#q","title":"Q: \u30c7\u30fc\u30bf\u304c\u53d6\u5f97\u3067\u304d\u306a\u3044\u5834\u5408\u306f\u3069\u3046\u3059\u308c\u3070\u3044\u3044\u3067\u3059\u304b\uff1f","text":"<p>A: \u4ee5\u4e0b\u306e\u70b9\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\uff1a 1. \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u63a5\u7d9a 2. \u9298\u67c4\u30b3\u30fc\u30c9\u306e\u6b63\u78ba\u6027 3. \u65e5\u4ed8\u7bc4\u56f2\u306e\u59a5\u5f53\u6027</p>"},{"location":"tutorial/#q_1","title":"Q: \u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u304c\u9045\u3044\u5834\u5408\u306f\u3069\u3046\u3059\u308c\u3070\u3044\u3044\u3067\u3059\u304b\uff1f","text":"<p>A: \u4ee5\u4e0b\u306e\u65b9\u6cd5\u3092\u8a66\u3057\u3066\u304f\u3060\u3055\u3044\uff1a 1. \u30c7\u30fc\u30bf\u671f\u9593\u3092\u77ed\u304f\u3059\u308b 2. \u8907\u96d1\u306a\u8a08\u7b97\u3092\u4e8b\u524d\u306b\u884c\u3063\u3066\u304a\u304f 3. \u4e0d\u8981\u306a\u30c7\u30fc\u30bf\u3092\u524a\u9664\u3059\u308b</p>"},{"location":"tutorial/#q-position","title":"Q: \u8907\u6570\u9298\u67c4\u3067 position \u304c\u304a\u304b\u3057\u3044","text":"<p>A: \u8907\u6570\u9298\u67c4\u3092\u6271\u3046\u5834\u5408\u306f <code>bt.position</code> \u3067\u306f\u306a\u304f <code>bt.position_of(code)</code> \u3092\u4f7f\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002 <code>position</code> \u306f\u5168\u9298\u67c4\u5408\u8a08\u306e\u305f\u3081\u3001\u500b\u5225\u9298\u67c4\u306e\u30dd\u30b8\u30b7\u30e7\u30f3\u3092\u6b63\u78ba\u306b\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093\u3002</p>"},{"location":"tutorial/#q-size","title":"Q: size \u3092\u7701\u7565\u3057\u305f\u6642\u306e\u52d5\u4f5c\u306f\uff1f","text":"<p>A: \u53cd\u5bfe\u30dd\u30b8\u30b7\u30e7\u30f3\u304c\u3042\u308b\u5834\u5408\u306f\u5168\u30af\u30ed\u30fc\u30ba\u3001\u306a\u3044\u5834\u5408\u306f\u5168\u529b\u3067\u65b0\u898f\u30dd\u30b8\u30b7\u30e7\u30f3\u3092\u53d6\u308a\u307e\u3059\u3002</p> \u6761\u4ef6 \u52d5\u4f5c <code>bt.sell()</code> \u3067\u30ed\u30f3\u30b0\u4fdd\u6709\u4e2d \u5168\u30ed\u30f3\u30b0\u3092\u30af\u30ed\u30fc\u30ba <code>bt.buy()</code> \u3067\u30b7\u30e7\u30fc\u30c8\u4fdd\u6709\u4e2d \u5168\u30b7\u30e7\u30fc\u30c8\u3092\u30af\u30ed\u30fc\u30ba \u30dd\u30b8\u30b7\u30e7\u30f3\u306a\u3057 \u5168\u8cc7\u7523\u3067\u65b0\u898f\u30dd\u30b8\u30b7\u30e7\u30f3 \u540c\u65b9\u5411\u30dd\u30b8\u30b7\u30e7\u30f3\u4fdd\u6709\u4e2d <code>margin_available</code> \u3067\u8cb7\u3044\u5897\u3057 <p>\u660e\u793a\u7684\u306b\u30b5\u30a4\u30ba\u3092\u6307\u5b9a\u3057\u305f\u3044\u5834\u5408\u306f <code>bt.buy(size=100)</code> \u306e\u3088\u3046\u306b\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p>"},{"location":"tutorial/#_21","title":"\u307e\u3068\u3081","text":"<ul> <li>\u30c7\u30fc\u30bf\u6e96\u5099 \u2192 Backtest\u521d\u671f\u5316 \u2192 \u6226\u7565\u95a2\u6570\u5b9a\u7fa9 \u2192 \u5b9f\u884c \u2192 \u5206\u6790 \u306e\u9806\u306b\u9032\u3081\u307e\u3059</li> <li><code>set_strategy()</code> + <code>run()</code> \u3067\u4e00\u62ec\u5b9f\u884c\u3001\u307e\u305f\u306f <code>step()</code> \u3067\u30b9\u30c6\u30c3\u30d7\u5b9f\u884c</li> <li>marimo\u9023\u643a\u3067\u30a4\u30f3\u30bf\u30e9\u30af\u30c6\u30a3\u30d6\u306a\u30ea\u30d7\u30ec\u30a4\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u304c\u53ef\u80fd</li> </ul>"}]}